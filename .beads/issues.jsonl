{"id":"ghostreplay-0ga","title":"Define deployment architecture","description":"No deployment strategy is specified.\n\n## Components to Deploy\n\n1. **Frontend** - Static React app\n2. **Backend** - Python FastAPI server\n3. **Database** - PostgreSQL\n\n## Options\n\n### Option A: Simple VPS (MVP)\n- Single DigitalOcean/Linode droplet\n- Docker Compose for all services\n- Nginx reverse proxy\n- Let's Encrypt SSL\n\n```yaml\n# docker-compose.yml\nservices:\n  frontend:\n    build: ./frontend\n    ports: ['3000:3000']\n  \n  backend:\n    build: ./backend\n    ports: ['8000:8000']\n    environment:\n      DATABASE_URL: postgres://...\n  \n  db:\n    image: postgres:15\n    volumes:\n      - pgdata:/var/lib/postgresql/data\n  \n  nginx:\n    image: nginx\n    ports: ['80:80', '443:443']\n```\n\n- Pros: Simple, cheap (~$10/mo), full control\n- Cons: Manual scaling, single point of failure\n\n### Option B: Platform as a Service\n- **Frontend**: Vercel or Netlify (free tier)\n- **Backend**: Railway, Render, or Fly.io\n- **Database**: Managed Postgres (Supabase, Neon, Railway)\n\n- Pros: No ops, auto-scaling, easy deploys\n- Cons: Can get expensive, less control\n\n### Option C: Cloud Native (Future)\n- AWS/GCP with Terraform\n- ECS or Cloud Run for backend\n- RDS for database\n- CloudFront for frontend\n\n- Pros: Production-grade, scalable\n- Cons: Complex, expensive, overkill for MVP\n\n## Recommendation\n**Option B for MVP**:\n- Vercel for frontend (free, great DX)\n- Railway or Fly.io for backend\n- Neon or Supabase for Postgres\n\n## CI/CD Pipeline\n```yaml\n# GitHub Actions\non:\n  push:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - run: npm test\n      - run: pytest\n  \n  deploy-frontend:\n    needs: test\n    # Vercel auto-deploys from GitHub\n  \n  deploy-backend:\n    needs: test\n    steps:\n      - uses: railway/deploy-action\n```\n\n## Environment Management\n- Development: Local Docker Compose\n- Staging: Separate deployment (optional for MVP)\n- Production: Main deployment\n\n## Secrets Management\n- Use platform's env var management\n- Never commit secrets\n- Document required env vars","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:57.232208-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.708273-08:00","closed_at":"2026-02-01T17:37:08.708273-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-15y","title":"[IMPL] Choose frontend state management solution","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until SPEC.md is finalized.\n\n## Decision Needed\n- Zustand (minimal, ~1KB)\n- Redux Toolkit (full-featured, ~10KB)\n- React Context + useReducer (built-in)\n\n## Recommendation\nZustand for local state + TanStack Query for server state.\n\n## Depends On\n- Finalized API spec to know what server state to manage\n- Game lifecycle design to know local state shape","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:10.032766-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:10.032766-08:00"}
{"id":"ghostreplay-4ap","title":"[SPEC] Define FEN normalization for position hashing","description":"**Category: SPEC.md Update Required**\n\nSchema uses 'SHA256 of Normalized FEN' but doesn't define normalization.\n\n## FEN Fields\n`rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1`\n\n1. Piece placement ✓\n2. Active color ✓\n3. Castling rights ✓\n4. En passant square ✓\n5. Halfmove clock (for 50-move rule)\n6. Fullmove number\n\n## Proposed SPEC.md Addition\n\n### Section 5.1.1: FEN Normalization\nNormalized FEN = fields 1-4 only (piece placement, active color, castling, en passant).\n\nFields 5-6 (move clocks) are stripped because:\n- Same position via different move order should match\n- Irrelevant for blunder identification\n\n```python\ndef normalize_fen(fen: str) -\u003e str:\n    parts = fen.split(' ')\n    return ' '.join(parts[:4])\n```\n\n## Decision Needed\n- Keep en passant square? (Only relevant immediately after pawn push)\n- Any edge cases to consider?","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:44.468507-08:00","created_by":"miguel","updated_at":"2026-02-01T21:55:39.893482-08:00","closed_at":"2026-02-01T21:55:39.893482-08:00","close_reason":"Added Section 5.1.1 FEN Normalization - fields 1-4 kept (including en passant for tactical significance), fields 5-6 stripped"}
{"id":"ghostreplay-4w1","title":"Define testing strategy","description":"No testing approach is mentioned in the spec.\n\n## Testing Pyramid\n\n### Unit Tests\n**Frontend:**\n- Chess logic utilities (FEN normalization, move validation)\n- SRS algorithm calculations\n- State store reducers\n- Component logic (not rendering)\n\n**Backend:**\n- Graph traversal algorithms\n- SRS update logic\n- FEN hashing/normalization\n- API input validation\n\n### Integration Tests\n**Frontend:**\n- Component rendering with mocked stores\n- Form submissions\n- Worker communication\n\n**Backend:**\n- API endpoint testing\n- Database queries\n- Auth flow\n\n### E2E Tests\n- Full game flow: start -\u003e play -\u003e blunder -\u003e review\n- Ghost mode activation\n- SRS scheduling verification\n\n## Tools\n\n### Frontend\n- **Vitest** - Unit tests (Vite-native, fast)\n- **React Testing Library** - Component tests\n- **Playwright** - E2E tests\n- **MSW** - API mocking\n\n### Backend\n- **pytest** - All Python tests\n- **pytest-asyncio** - Async test support\n- **httpx** - API testing\n- **factory_boy** - Test data factories\n\n## Test Organization\n```\nfrontend/\n  src/\n    utils/\n      fen.ts\n      fen.test.ts\n    components/\n      Board/\n        Board.tsx\n        Board.test.tsx\n  e2e/\n    game-flow.spec.ts\n\nbackend/\n  tests/\n    unit/\n      test_srs.py\n      test_graph.py\n    integration/\n      test_api.py\n    conftest.py\n```\n\n## Coverage Targets\n- Unit tests: 80%+\n- Integration: Key paths covered\n- E2E: Critical user journeys\n\n## CI Integration\n- Run tests on every PR\n- Block merge on failure\n- Coverage reporting","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:46.392465-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.704402-08:00","closed_at":"2026-02-01T17:37:08.704402-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-4wy","title":"[IMPL] Address graph scalability and pruning","description":"**Category: Implementation Task - Future Enhancement**\n\nMonitor before optimizing. May not be needed for MVP scale.\n\n## If Needed\n- Orphan position cleanup job\n- Index optimization\n- Position table partitioning\n- Query performance monitoring","status":"open","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:29.811017-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:29.811017-08:00"}
{"id":"ghostreplay-558","title":"Add chessboard gameplay with react-chessboard + chess.js","description":"Install react-chessboard and chess.js, then build a ChessGame component that lets a single user play both sides locally. Use chess.js to drive game state, validate moves, and reject illegal drops. Show lightweight UI chrome (title, turn indicator, reset button) so QA can tell the app is alive. Update README with dependency install instructions plus a short verification checklist.","acceptance_criteria":"- Dependencies react-chessboard and chess.js are added and locked\n- Dropping a piece on the board mirrors real chess: illegal moves snap back, legal moves update state\n- Board orientation can be flipped or rotates automatically so both sides are playable\n- Reset/New Game control wipes history and returns to starting position\n- README documents how to launch the dev server and confirm a legal game can be completed","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T23:43:22.9549-08:00","created_by":"miguel","updated_at":"2026-02-02T00:06:49.724931-08:00","closed_at":"2026-02-02T00:06:49.724931-08:00","close_reason":"Closed","labels":["milestone-1"],"dependencies":[{"issue_id":"ghostreplay-558","depends_on_id":"ghostreplay-9fy","type":"parent-child","created_at":"2026-02-01T23:43:40.668944-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-5a8","title":"[IMPL] Add OAuth login (Lichess/Chess.com)","status":"open","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:53:25.627733-08:00","created_by":"miguel","updated_at":"2026-02-01T17:53:25.627733-08:00"}
{"id":"ghostreplay-5bk","title":"[SPEC] Document complete API endpoint specification","description":"**Category: SPEC.md Update Required**\n\nOnly POST /blunder is mentioned. Need complete API design.\n\n## Proposed SPEC.md Addition\n\n### Section 7: API Specification\n\n#### Authentication\n- POST /api/auth/register - Create account\n- POST /api/auth/login - Get token\n- POST /api/auth/logout - Invalidate token\n\n#### Game Flow\n- POST /api/game/start - Start new game session\n  - Request: { engine_elo: number }\n  - Response: { session_id: uuid }\n\n- GET /api/game/ghost-move - Get ghost's next move\n  - Request: { session_id, fen }\n  - Response: { mode: 'ghost'|'engine', move?: string }\n\n- POST /api/game/end - End game session\n  - Request: { session_id, result }\n\n#### Blunders\n- POST /api/blunder - Record blunder\n  - Request: { session_id, fen, user_move, best_move, eval_delta }\n\n- GET /api/blunders - List user's blunders\n  - Query: ?due=true\u0026limit=50\n\n#### SRS\n- POST /api/srs/review - Record review result\n  - Request: { blunder_id, passed: boolean }\n  - Response: { next_due_date }\n\n## Design Decisions\n- REST vs GraphQL?\n- Pagination strategy?\n- Error response format?","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:59.572547-08:00","created_by":"miguel","updated_at":"2026-02-01T19:31:09.187172-08:00","closed_at":"2026-02-01T19:31:09.187172-08:00","close_reason":"Added complete API specification as Section 9 covering auth, game flow, blunders, and SRS endpoints","dependencies":[{"issue_id":"ghostreplay-5bk","depends_on_id":"ghostreplay-j0k","type":"blocks","created_at":"2026-02-01T17:40:52.160473-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-5vd","title":"[SPEC] Define acceptable move criteria for SRS pass","description":"**Category: SPEC.md Update Required**\n\nSection 2.3 says 'engine's top move (or a specific safe alternative)' without defining what's acceptable.\n\n## Problem\nMultiple moves might be nearly equal. Should all count as 'passing'?\n\n## Options\n\n1. **Exact match only** - Only best move = pass\n2. **Eval threshold** - Any move within 30cp of best = pass  \n3. **Top N moves** - Any of top 3 engine moves = pass\n\n## Proposed SPEC.md Addition\n\n### Section 6.3.2: Pass Criteria\nA review is marked PASS if the user plays a move that:\n- Is the engine's #1 move, OR\n- Evaluates within [THRESHOLD] centipawns of the best move\n\nDefault threshold: 30cp (configurable)\n\n## Decision Needed\n- Which approach for MVP?\n- Should threshold vary by position type (tactical vs quiet)?","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:38.494642-08:00","created_by":"miguel","updated_at":"2026-02-01T21:54:27.460922-08:00","closed_at":"2026-02-01T21:54:27.460922-08:00","close_reason":"Updated SPEC.md with explicit thresholds: 50cp for SRS pass, 150cp for blunder detection"}
{"id":"ghostreplay-7w1","title":"[IMPL] Define testing strategy","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until SPEC.md is finalized.\n\n## Approach\n- Unit: Vitest (frontend), pytest (backend)\n- Integration: React Testing Library, httpx\n- E2E: Playwright\n\n## Key Test Cases\n- SRS algorithm calculations\n- Graph traversal queries\n- Ghost mode transitions\n- Blunder detection accuracy","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:14.178531-08:00","created_by":"miguel","updated_at":"2026-02-02T01:21:57.17122-08:00","closed_at":"2026-02-02T01:21:57.17122-08:00","close_reason":"Closed"}
{"id":"ghostreplay-86k","title":"Choose and document SRS algorithm (SM-2 vs Leitner)","description":"The spec mentions 'modified SM-2 or Leitner system' but doesn't specify which one will be used.\n\n## Algorithm Comparison\n\n### SM-2 (SuperMemo 2)\nUsed by Anki. More sophisticated.\n\n```python\n# After each review:\nif quality \u003e= 3:  # Pass\n    if repetitions == 0:\n        interval = 1\n    elif repetitions == 1:\n        interval = 6\n    else:\n        interval = round(interval * ease_factor)\n    repetitions += 1\n    ease_factor = ease_factor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))\nelse:  # Fail\n    repetitions = 0\n    interval = 1\n\n# ease_factor minimum = 1.3\n```\n\n- Pros: Adapts to item difficulty, well-researched\n- Cons: More complex, ease factor can spiral down\n\n### Leitner System\nSimpler box-based system.\n\n```python\nboxes = [1, 3, 7, 14, 30]  # days\n\nif pass:\n    box = min(box + 1, len(boxes) - 1)\nelse:\n    box = 0\n\ninterval = boxes[box]\n```\n\n- Pros: Simple, predictable\n- Cons: Less adaptive to individual items\n\n### FSRS (Free Spaced Repetition Scheduler)\nNewer algorithm, used by recent Anki versions.\n- Pros: More accurate predictions\n- Cons: More complex, less battle-tested\n\n## Recommendation\n**SM-2 for MVP** with these modifications:\n- Binary quality (pass=4, fail=1) instead of 0-5 scale\n- Minimum ease factor = 1.5 (prevent death spiral)\n- Cap interval at 180 days\n\n## Implementation\n```python\ndef update_srs(blunder: Blunder, passed: bool) -\u003e Blunder:\n    quality = 4 if passed else 1\n    \n    if quality \u003e= 3:\n        if blunder.repetitions == 0:\n            blunder.interval = 1\n        elif blunder.repetitions == 1:\n            blunder.interval = 6\n        else:\n            blunder.interval = min(round(blunder.interval * blunder.ease_factor), 180)\n        blunder.repetitions += 1\n        blunder.ease_factor = max(1.5, blunder.ease_factor + 0.1)\n    else:\n        blunder.repetitions = 0\n        blunder.interval = 1\n        blunder.ease_factor = max(1.5, blunder.ease_factor - 0.2)\n    \n    blunder.due_date = now() + timedelta(days=blunder.interval)\n    return blunder\n```","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:06.800059-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.688015-08:00","closed_at":"2026-02-01T17:37:08.688015-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-9fy","title":"Milestone 1: Self-play chessboard","description":"Track the first app milestone described in SPEC.md: prove the Ghost Replay UI stack is wired up by delivering a browser experience where a user can play a legal chess game against themselves. This milestone covers bootstrapping the React+Vite workspace plus wiring react-chessboard with chess.js so the board enforces legal moves. This epic coordinates that scope and stays open until a user can move pieces end-to-end on localhost.","acceptance_criteria":"- All Milestone 1 child tasks are complete and verified\n- `npm run dev` renders a chessboard backed by chess.js where both sides can play legal moves\n- README documents how to run and verify the experience\n- Demo clip or screenshots captured in issue notes for future reference","status":"closed","priority":1,"issue_type":"epic","owner":"unroar@gmail.com","created_at":"2026-02-01T23:43:12.021249-08:00","created_by":"miguel","updated_at":"2026-02-02T00:29:45.62223-08:00","closed_at":"2026-02-02T00:29:45.62223-08:00","close_reason":"Milestone 1 complete: chess game is fully functional with legal move validation, README documents usage, and all child tasks are closed. Demo clips/screenshots waived for this epic.","labels":["milestone-1"]}
{"id":"ghostreplay-9gy","title":"[SPEC] Define game history view","description":"## Overview\nUsers need a way to view their past games and access the analysis for any completed game.\n\n## Entry Points\n- From dashboard/main menu\n- After completing a game (\"View History\" option)\n\n## Key Features\n- List of completed games with metadata (date, result, opponent Elo, blunders count)\n- Sortable/filterable by date, result, etc.\n- Click any game to open the analysis view (Section 10)\n\n## Questions to Answer\n- Pagination strategy for users with many games\n- What summary stats to show in the list view\n- Filter options (by date range, result, number of blunders)\n\n## Dependencies\n- Requires after-game analysis display (ghostreplay-d2d)","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T22:03:27.461469-08:00","created_by":"miguel","updated_at":"2026-02-01T22:11:30.729821-08:00","closed_at":"2026-02-01T22:11:30.729821-08:00","close_reason":"Added Section 11 to SPEC.md defining game history view with entry points, screen layout, game card data, interaction flow, API endpoint, and empty state. Kept MVP-simple: no sorting/filtering/pagination.","dependencies":[{"issue_id":"ghostreplay-9gy","depends_on_id":"ghostreplay-d2d","type":"blocks","created_at":"2026-02-01T22:03:33.794086-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-9zf","title":"Store full path to blunder positions in graph","description":"**Problem:** The spec describes Ghost traversing from the current position to downstream blunders, but the blunder capture logic only stores a single position + edge. Without intermediate positions, the scent query finds no paths.\n\n**Gap identified:**\n- Section 6.2 (Blunder Capture) only inserts the blunder node and one edge\n- POST /api/blunder lacks parent FEN, ply index, or PGN prefix\n- Section 6.1 (Scent Logic) assumes a connected graph from start to blunder\n\n**Impact:** Ghost mode would always return 'engine' because no paths exist.\n\n**Proposed fix:** Store positions incrementally during gameplay (option 2):\n- Add POST /api/position endpoint called after each move\n- Blunder capture then marks an existing node rather than creating isolated one\n- Supports re-hooking (transposition detection) which already needs mid-game position lookups","status":"closed","priority":1,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-01T22:48:57.351426-08:00","created_by":"miguel","updated_at":"2026-02-01T22:58:41.038621-08:00","closed_at":"2026-02-01T22:58:41.038621-08:00","close_reason":"Updated SPEC.md: Section 6.2 now stores full path via PGN replay, Section 9.4 API updated to accept pgn field"}
{"id":"ghostreplay-9zt","title":"[IMPL] Add user stats dashboard","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until core features working.\n\n## Features\n- Blunders due today / overdue\n- Pass rate over time\n- Blunders by interval (mastered vs learning)\n- Review history\n\n## Depends On\n- User model\n- Blunder schema with SRS fields\n- API endpoints for stats","status":"open","priority":4,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:18.748254-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:18.748254-08:00","dependencies":[{"issue_id":"ghostreplay-9zt","depends_on_id":"ghostreplay-j0k","type":"blocks","created_at":"2026-02-01T17:40:52.548445-08:00","created_by":"miguel"},{"issue_id":"ghostreplay-9zt","depends_on_id":"ghostreplay-o5b","type":"blocks","created_at":"2026-02-01T17:40:52.729303-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-abl","title":"[SPEC] Choose and document SRS algorithm","description":"**Category: SPEC.md Update Required**\n\nSection 2.3 mentions 'modified SM-2 or Leitner system' but doesn't specify which.\n\n## Options\n\n### SM-2 (SuperMemo 2)\n- interval = interval * ease_factor\n- ease_factor adjusts per item\n- More adaptive, used by Anki\n\n### Leitner\n- Fixed box intervals: [1, 3, 7, 14, 30] days\n- Simpler, more predictable\n\n## Proposed SPEC.md Addition\n\n### Section 6.3.1: SRS Algorithm (SM-2 Modified)\n```\nOn PASS: interval = max(1, interval * ease_factor), ease_factor += 0.1\nOn FAIL: interval = 1, ease_factor = max(1.5, ease_factor - 0.2)\nInitial: interval=0, ease_factor=2.5\nCap: interval \u003c= 180 days\n```\n\n## Decision Needed\n- SM-2 vs Leitner for MVP?\n- Should pass/fail be binary or graded (easy/good/hard)?\n- Maximum interval cap?","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:33.257533-08:00","created_by":"miguel","updated_at":"2026-02-01T18:46:12.927273-08:00","closed_at":"2026-02-01T18:46:12.927273-08:00","close_reason":"Added probability-based SRS algorithm to SPEC.md with exponential backoff"}
{"id":"ghostreplay-bp5","title":"Design error handling and recovery strategy","description":"No error handling strategy is specified for various failure modes.\n\n## Failure Scenarios\n\n### 1. Web Worker Crash\n- Stockfish WASM worker dies mid-game\n- **Detection**: Worker stops responding, timeout on postMessage\n- **Recovery**: \n  - Attempt worker restart\n  - Show 'Engine restarting...' message\n  - Resume game if possible\n  - If repeated failures, offer to save game state and retry later\n\n### 2. Network Disconnection\n- API calls fail mid-game\n- **Detection**: fetch() rejects, navigator.onLine\n- **Recovery**:\n  - Queue failed requests (blunder submissions)\n  - Show offline indicator\n  - Retry with exponential backoff\n  - Sync queued blunders when back online\n\n### 3. Database Unavailable\n- Postgres down or slow\n- **Detection**: API returns 503, timeouts\n- **Recovery**:\n  - API returns cached data where possible\n  - Ghost mode degrades to engine-only mode\n  - Blunder submissions queued for retry\n  - Health check endpoint for monitoring\n\n### 4. Invalid Game State\n- FEN becomes corrupted, impossible position\n- **Detection**: chess.js validation fails\n- **Recovery**:\n  - Log error with full context\n  - Offer to restart game\n  - Don't record blunders from corrupted state\n\n## Implementation Requirements\n\n1. **Frontend**\n   - Global error boundary (React)\n   - Toast/notification system for user feedback\n   - Offline detection and indicator\n   - Request retry logic with queue\n\n2. **Backend**\n   - Consistent error response format: { error: string, code: string, details?: any }\n   - Request logging for debugging\n   - Health check endpoint\n   - Graceful degradation patterns\n\n3. **Monitoring**\n   - Error tracking (Sentry or similar)\n   - API latency metrics\n   - Worker crash rate tracking","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:31.747809-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.67725-08:00","closed_at":"2026-02-01T17:37:08.67725-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-c41","title":"Bootstrap React+Vite workspace","description":"Create a new Vite + React (TypeScript) project that will host the Ghost Replay client. Keep the template lean (remove demo counter), set package metadata, and check in npm lockfiles so the rest of the milestone can install dependencies quickly. Document npm install/run steps in README so follow-on work knows how to boot the UI.","acceptance_criteria":"- Running `npm install` followed by `npm run dev` serves the starter page without runtime errors\n- README lists prerequisites plus dev/build commands\n- Default page renders Ghost Replay placeholder copy so we know the right app is running","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T23:41:05.250167-08:00","created_by":"miguel","updated_at":"2026-02-01T23:52:35.706382-08:00","closed_at":"2026-02-01T23:52:35.706382-08:00","close_reason":"Closed","labels":["milestone-1"],"dependencies":[{"issue_id":"ghostreplay-c41","depends_on_id":"ghostreplay-9fy","type":"parent-child","created_at":"2026-02-01T23:43:32.031433-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-cfy","title":"Play against Stockfish","description":"Implement the first playable loop where the local board hands moves to a Stockfish worker and applies the replies.","status":"closed","priority":2,"issue_type":"epic","owner":"unroar@gmail.com","created_at":"2026-02-02T00:12:58.662199-08:00","created_by":"miguel","updated_at":"2026-02-02T01:09:54.294758-08:00","closed_at":"2026-02-02T01:09:54.294758-08:00","close_reason":"Closed"}
{"id":"ghostreplay-cfy.1","title":"Set up Stockfish worker runtime","description":"Add stockfish.js WASM to the client build, configure a dedicated Web Worker, and prove it accepts go commands and returns best moves via postMessage.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T00:13:05.692987-08:00","created_by":"miguel","updated_at":"2026-02-02T01:13:52.962577-08:00","closed_at":"2026-02-02T01:13:52.962577-08:00","close_reason":"Closed","dependencies":[{"issue_id":"ghostreplay-cfy.1","depends_on_id":"ghostreplay-cfy","type":"parent-child","created_at":"2026-02-02T00:13:05.69476-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-cfy.2","title":"Connect ChessGame to the worker","description":"After each player move, send the latest FEN to the worker, show thinking state, and apply the engine's reply move back onto the board with error handling.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T00:13:10.424533-08:00","created_by":"miguel","updated_at":"2026-02-02T01:13:52.967156-08:00","closed_at":"2026-02-02T01:13:52.967156-08:00","close_reason":"Closed","dependencies":[{"issue_id":"ghostreplay-cfy.2","depends_on_id":"ghostreplay-cfy","type":"parent-child","created_at":"2026-02-02T00:13:10.426069-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-csy","title":"[IMPL] Define deployment architecture","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until implementation begins.\n\n## MVP Recommendation\n- Frontend: Vercel (free tier)\n- Backend: Railway or Fly.io\n- Database: Neon or Supabase (managed Postgres)\n\n## Later Considerations\n- CI/CD pipeline (GitHub Actions)\n- Environment management\n- Secrets handling","status":"open","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:16.398251-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:16.398251-08:00"}
{"id":"ghostreplay-d2d","title":"[SPEC] Define after-game analysis display","description":"## Overview\nAfter a game ends, users should be able to review the game with engine evaluations displayed for each position.\n\n## Key Points\n- **No extra computation needed**: Frontend already runs Worker B (Analyst) during the game at max strength\n- Analysis data is captured in real-time as the game progresses\n- After-game view displays this pre-computed analysis\n\n## Data to Display\n- Engine evaluation (centipawns) for each position\n- Visual eval bar/graph showing advantage over time\n- Highlight blunders, mistakes, inaccuracies (color-coded)\n- Best move suggestions at key moments\n\n## Questions to Answer\n- How is per-move analysis data stored? (In game_sessions or separate table?)\n- What evaluation thresholds for mistake/inaccuracy classification?\n- Should analysis be stored server-side or kept in browser memory until game end?\n\n## Dependencies\n- Requires game session PGN storage (ghostreplay-ujl adds this)","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T19:23:46.852134-08:00","created_by":"miguel","updated_at":"2026-02-01T22:05:18.079612-08:00","closed_at":"2026-02-01T22:05:18.079612-08:00","close_reason":"Added Section 10 to SPEC.md defining analysis screen layout, components (chessboard, eval graph, eval bar, navigation, move list, position panel), data source, API endpoint, and entry points (post-game + game history)","dependencies":[{"issue_id":"ghostreplay-d2d","depends_on_id":"ghostreplay-ujl","type":"blocks","created_at":"2026-02-01T19:24:16.058306-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-d3b","title":"Define FEN normalization strategy","description":"The schema uses `fen_hash = SHA256(Normalized FEN)` but doesn't define what normalization means.\n\n## Problem\nA standard FEN has 6 fields:\n`rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1`\n\n1. Piece placement\n2. Active color\n3. Castling availability\n4. En passant target square\n5. Halfmove clock (moves since pawn move/capture)\n6. Fullmove number\n\nFields 5 and 6 change every move but don't affect the position for blunder purposes.\n\n## Options\n\n### Option A: Strip fields 5 and 6\nNormalize to: `position color castling en_passant`\n- Pros: Same position = same hash\n- Cons: Loses move timing info\n\n### Option B: Keep all fields\n- Pros: Exact position match\n- Cons: Same position reached via different move order = different hash\n\n### Option C: Strip only field 6 (fullmove number)\n- Keep halfmove clock (relevant for 50-move rule)\n- Pros: Balanced approach\n- Cons: Still some duplication possible\n\n## Recommendation\nOption A for MVP. Chess positions are defined by pieces + castling rights + en passant. The move counters are metadata.\n\n## Implementation\n- Create a `normalize_fen()` utility function\n- Document the normalization clearly\n- Use consistently in both frontend and backend","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:07.921074-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.665226-08:00","closed_at":"2026-02-01T17:37:08.665226-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-e62","title":"Store blunder context (wrong move, best move, eval delta)","description":"Currently the schema only marks `is_blunder=TRUE` on positions but doesn't store the context needed to explain the mistake to the user.\n\n## Problem\nWhen reviewing a blunder, we need to show:\n- 'You played Qxd4' (the mistake)\n- 'Nf3 was better' (the correction)\n- 'This lost 3.5 pawns of advantage' (the severity)\n\n## Schema Changes\n\n```sql\nCREATE TABLE blunders (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    position_id BIGINT REFERENCES positions(id),\n    \n    -- The mistake\n    user_move_san VARCHAR(10) NOT NULL,    -- e.g., 'Qxd4'\n    user_move_eval INTEGER,                 -- centipawns after user move\n    \n    -- The correction\n    best_move_san VARCHAR(10) NOT NULL,    -- e.g., 'Nf3'\n    best_move_eval INTEGER,                 -- centipawns after best move\n    \n    -- Derived\n    eval_delta INTEGER,                     -- best - user (positive = blunder)\n    \n    -- SRS (move from positions table)\n    srs_due_date TIMESTAMP,\n    srs_interval INTEGER DEFAULT 0,\n    srs_ease_factor FLOAT DEFAULT 2.5,\n    \n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n## Benefits\n- SRS data is now per-user (same position, different users)\n- Can show detailed feedback during review\n- Can track severity trends over time","status":"closed","priority":1,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:25.647445-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.645081-08:00","closed_at":"2026-02-01T17:37:08.645081-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"ghostreplay-e62","depends_on_id":"ghostreplay-ou7","type":"blocks","created_at":"2026-02-01T17:35:19.590381-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-em8","title":"Handle concurrent sessions (multi-tab play)","description":"What happens if a user opens multiple browser tabs and plays simultaneous games?\n\n## Scenarios\n\n1. **Tab A and Tab B both playing**\n   - Both legitimate games\n   - Both should track blunders independently\n   - Each has own session_id\n\n2. **Tab A playing, Tab B opens same game**\n   - User refreshes or duplicates tab\n   - Should resume same session, not create new one\n\n3. **Ghost mode conflicts**\n   - Tab A triggers ghost mode for blunder X\n   - Tab B independently reaches blunder X\n   - Both valid, no conflict\n\n## Implementation Options\n\n### Option A: Allow freely\n- Each tab = independent session\n- No special handling needed\n- Pros: Simple\n- Cons: User could 'cheat' by practicing same blunder in parallel\n\n### Option B: Single active session\n- Only one game allowed at a time\n- New tab shows 'Game in progress in another tab'\n- Pros: Cleaner UX, no cheating\n- Cons: More complex, needs websocket or polling\n\n### Option C: Session recovery\n- Store session_id in localStorage\n- New tab checks for active session\n- Option to 'resume' or 'abandon and start new'\n\n## Recommendation\nOption A for MVP (simplest). Revisit if cheating becomes a concern.\n\n## Notes\n- Document expected behavior\n- Consider adding session metadata to blunder records for debugging","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:22.007657-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.673089-08:00","closed_at":"2026-02-01T17:37:08.673089-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-f3a","title":"Define game lifecycle (start, end, persistence)","description":"The spec doesn't address how games are started, ended, or whether they're persisted.\n\n## Questions to Answer\n\n### Starting a Game\n- What UI initiates a new game?\n- What options are presented?\n  - Color (White only for MVP, but UI should exist)\n  - Engine strength (Elo 800-2500)\n  - Time control (if any)\n- Does the system show 'You have N blunders due for review' before starting?\n\n### During the Game\n- Can user resign?\n- Can user offer/accept draw?\n- Can user request takeback? (probably not, defeats purpose)\n- What happens on browser close/refresh mid-game?\n\n### Ending the Game\n- How is checkmate/stalemate detected and displayed?\n- Is the completed game stored?\n- Post-game analysis screen?\n\n## Schema Consideration\n\n```sql\nCREATE TABLE games (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    started_at TIMESTAMP DEFAULT NOW(),\n    ended_at TIMESTAMP,\n    result VARCHAR(10),  -- '1-0', '0-1', '1/2-1/2', 'abandoned'\n    pgn TEXT,            -- Full game record\n    engine_elo INTEGER,\n    blunders_encountered INTEGER DEFAULT 0,\n    blunders_passed INTEGER DEFAULT 0\n);\n```\n\n## Benefits of Storing Games\n- Can replay past games\n- Can see 'you faced this blunder in game X'\n- Analytics on performance vs engine level","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:50.771116-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.657342-08:00","closed_at":"2026-02-01T17:37:08.657342-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-gm8","title":"Define acceptable move criteria for SRS pass/fail","description":"Section 2.3 mentions 'engine's top move (or a specific safe alternative)' but doesn't define what counts as acceptable.\n\n## Problem\nIf the engine's top 3 moves are all within 10cp of each other, should playing any of them count as 'passing' the review?\n\n## Options to Consider\n\n1. **Exact Match Only**\n   - Only the single best move counts as correct\n   - Pros: Simple, deterministic\n   - Cons: May be too strict; alternative winning moves rejected\n\n2. **Evaluation Threshold**\n   - Any move within N centipawns of best is acceptable\n   - e.g., if best=+150cp, accept moves \u003e= +130cp (20cp tolerance)\n   - Pros: More forgiving, recognizes alternative good moves\n   - Cons: Need to define threshold\n\n3. **Top N Moves**\n   - Accept any of engine's top 3 moves\n   - Pros: Simple to implement\n   - Cons: 3rd best might be significantly worse\n\n4. **Hybrid**\n   - Accept top N moves that are within X centipawns of best\n   - Most flexible but most complex\n\n## Decision Needed\n- Which approach for MVP?\n- Should this be configurable per user?\n- Different thresholds for different skill levels?\n\n## Implementation\n- Document the chosen algorithm in code comments\n- Make threshold a config constant for easy tuning","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:32.759354-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.648846-08:00","closed_at":"2026-02-01T17:37:08.648846-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-gms","title":"Add time control options for games","description":"The spec doesn't mention time controls for games.\n\n## Questions\n\n### Is Time Control Needed for MVP?\nArguments for:\n- More realistic game experience\n- Prevents endless thinking\n- Adds pressure (blunders more likely under time)\n\nArguments against:\n- Adds complexity\n- Training app, not competitive\n- Users might want unlimited time to think\n\n### Options\n\n1. **No time control (MVP)**\n   - Unlimited thinking time\n   - Simplest implementation\n   - Focus on learning, not speed\n\n2. **Optional time control**\n   - User chooses: None, 5+0, 10+0, 15+10, etc.\n   - Engine also plays on clock\n   - Clock UI component needed\n\n3. **Per-move time limit**\n   - Not a full clock, but max time per move\n   - e.g., 60 seconds per move\n   - Simpler than full clock\n\n## Implementation (if adding)\n\n### Frontend\n- Clock component (two clocks, user + engine)\n- Time selector in game setup\n- Visual/audio warning when low on time\n- Game ends on timeout\n\n### Backend\n- Store time control in game session\n- Track time used per move\n- Validate move timestamps\n\n### Engine Consideration\n- Stockfish needs time management\n- `go wtime X btime Y` command\n- Different from unlimited `go depth 20`\n\n## Recommendation\n**No time control for MVP**. Add as enhancement later if users request it.\n\n## Future Enhancement\n- Track 'thinking time' per move even without clock\n- Analytics: 'You blunder more when thinking \u003e 30 seconds'","status":"closed","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:16.192734-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.692643-08:00","closed_at":"2026-02-01T17:37:08.692643-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-i4f","title":"Address graph scalability and pruning strategy","description":"The position graph could grow very large. Common opening positions (e4, d4, Nf3) will be traversed constantly.\n\n## Scale Concerns\n\n### Position Growth\n- Every unique position = new row\n- Opening positions shared across all users (if not per-user)\n- Endgame positions less likely to repeat\n\n### Query Performance\n- Recursive CTE for path finding\n- Worse as graph grows\n- Need indexes on fen_hash, is_blunder, srs_due_date\n\n## Architecture Questions\n\n### Per-User vs Shared Positions?\n\n**Option A: Shared positions table**\n```sql\n-- positions table is global\n-- blunders table is per-user, references positions\n```\n- Pros: Deduplication, smaller DB\n- Cons: Queries need user filter\n\n**Option B: Per-user positions**\n```sql\n-- Each user has their own position nodes\n-- No sharing between users\n```\n- Pros: Simpler queries, user isolation\n- Cons: Massive duplication of common positions\n\n**Recommendation**: Shared positions, per-user blunders\n\n### Pruning Strategies\n\n1. **Orphan cleanup**\n   - Positions with no blunders and no edges = delete\n   - Run as scheduled job\n\n2. **Old position archival**\n   - Positions not accessed in 1 year -\u003e cold storage\n   - Unlikely for active blunders\n\n3. **Graph compaction**\n   - Merge linear chains of positions (no branches)\n   - Complex, maybe not worth it\n\n## Index Strategy\n```sql\nCREATE INDEX idx_positions_fen_hash ON positions(fen_hash);\nCREATE INDEX idx_blunders_user_due ON blunders(user_id, srs_due_date) WHERE srs_due_date IS NOT NULL;\nCREATE INDEX idx_moves_from ON moves(from_position_id);\n```\n\n## Monitoring\n- Track table sizes over time\n- Monitor query latency for path-finding\n- Alert if growth exceeds projections","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:42.226854-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.680932-08:00","closed_at":"2026-02-01T17:37:08.680932-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-inn","title":"[IMPL] Add time control options","description":"**Category: Implementation Task - Future Enhancement**\n\nNot needed for MVP. Training app, unlimited thinking time is fine.\n\n## If Added Later\n- Clock component UI\n- Time presets (5+0, 10+0, etc.)\n- Engine time management\n- Timeout handling","status":"open","priority":4,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:26.548716-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:26.548716-08:00"}
{"id":"ghostreplay-j0k","title":"[SPEC] Add user model and authentication design","description":"**Category: SPEC.md Update Required**\n\nAdd a new section to SPEC.md defining user identity.\n\n## Decisions Needed\n\n1. **Authentication method**: JWT tokens vs session cookies?\n2. **User schema fields**: What data do we store? (email, username, preferences)\n3. **Password requirements**: Minimum complexity?\n4. **OAuth support**: Lichess/Chess.com integration for MVP or later?\n\n## Proposed SPEC.md Addition\n\n### Section 5.3: `users` Table\n```sql\nCREATE TABLE users (\n    id BIGSERIAL PRIMARY KEY,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Schema Impact\n- Add `user_id` to positions or create separate user-scoped blunders table\n- Define whether positions are shared globally or per-user\n\n## Questions for Product Owner\n- Is email/password sufficient for MVP?\n- Should we support anonymous play (no account)?\n- Rate limiting requirements?","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:21.955657-08:00","created_by":"miguel","updated_at":"2026-02-01T17:54:56.46722-08:00","closed_at":"2026-02-01T17:54:56.46722-08:00","close_reason":"Added sections 5.3-5.5 to SPEC.md: users table, JWT auth, user-scoped data"}
{"id":"ghostreplay-k58","title":"Add engine skill level selection UI","description":"The spec mentions Elo 800-2500 range but no UI for selection.\n\n## Requirements\n\n### Skill Level Mapping\nStockfish uses 'Skill Level' 0-20, not Elo directly.\n\nApproximate mapping:\n| Skill Level | Approximate Elo |\n|-------------|-----------------|\n| 0           | 800             |\n| 5           | 1200            |\n| 10          | 1600            |\n| 15          | 2000            |\n| 20          | 2500+           |\n\n### UI Design\n\n**Option A: Elo Slider**\n```\nEngine Strength: [====|=====] 1400\n```\n- User-friendly, familiar concept\n- Map internally to Skill Level\n\n**Option B: Named Levels**\n```\n[ ] Beginner (800)\n[ ] Casual (1200)\n[x] Intermediate (1600)\n[ ] Advanced (2000)\n[ ] Expert (2500)\n```\n- Clearer for non-chess players\n- Less granularity\n\n**Option C: Both**\n- Presets + custom slider\n- Most flexible\n\n### Persistence\n- Store user's preferred level\n- Use as default for new games\n- Allow override per game\n\n### Implementation\n\n**Frontend:**\n```typescript\ninterface GameSettings {\n  engineElo: number;  // 800-2500\n}\n\nfunction eloToSkillLevel(elo: number): number {\n  // Linear interpolation\n  return Math.round((elo - 800) / 85);\n}\n```\n\n**Stockfish Configuration:**\n```\nsetoption name Skill Level value 10\nsetoption name UCI_LimitStrength value true\nsetoption name UCI_Elo value 1600\n```\n\nNote: UCI_Elo is more accurate if supported by the WASM build.\n\n### Considerations\n- Should blunders against weak engine count the same as against strong?\n- Maybe store engine Elo with blunder for context\n- Adaptive difficulty? (auto-adjust based on win rate)","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:27.195571-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.696753-08:00","closed_at":"2026-02-01T17:37:08.696753-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-k9g","title":"[IMPL] Handle multi-tab concurrent sessions","description":"**Category: Implementation Task - Future Enhancement**\n\nLow priority for MVP. Allow multiple tabs freely.\n\n## If Issues Arise\n- Single active session enforcement\n- Session recovery from localStorage\n- WebSocket for cross-tab communication","status":"open","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:28.114364-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:28.114364-08:00"}
{"id":"ghostreplay-lc6","title":"Add session/game tracking for first-blunder-only rule","description":"The spec says 'only the first blunder of any single game session is recorded' but there's no mechanism to track sessions.\n\n## Problem\nWithout session tracking, we can't enforce the first-blunder-only rule.\n\n## Requirements\n\n1. **Session Definition**\n   - A session = one game from start to finish\n   - Starts when user clicks 'New Game'\n   - Ends on checkmate, resignation, draw, or abandonment\n\n2. **Tracking Mechanism**\n   - Generate session_id when game starts\n   - Frontend includes session_id in POST /blunder requests\n   - Backend checks: 'Has this session already recorded a blunder?'\n   - If yes, reject/ignore new blunder submission\n\n3. **Schema**\n```sql\nCREATE TABLE game_sessions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id BIGINT REFERENCES users(id),\n    started_at TIMESTAMP DEFAULT NOW(),\n    ended_at TIMESTAMP,\n    blunder_recorded BOOLEAN DEFAULT FALSE\n);\n```\n\n4. **API Changes**\n   - POST /api/game/start returns session_id\n   - POST /api/blunder requires session_id\n   - Backend validates session_id and checks blunder_recorded flag\n\n## Edge Cases\n- Browser refresh mid-game: session_id in localStorage?\n- Multiple tabs: each tab = different session\n- Abandoned games: cleanup job to mark old sessions as ended?","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:14.84774-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.669036-08:00","closed_at":"2026-02-01T17:37:08.669036-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"ghostreplay-lc6","depends_on_id":"ghostreplay-f3a","type":"blocks","created_at":"2026-02-01T17:35:19.780974-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-n9j","title":"[SPEC] Clarify transposition detection and ghost re-hooking","description":"**Category: SPEC.md Update Required**\n\nSection 2.1 mentions 'Re-Hooking' when user transposes into a known position, but the mechanism isn't specified.\n\n## The Scenario\n1. Move 5: User deviates from ghost path\n2. Engine mode takes over\n3. Move 12: Position happens to match a blunder path\n4. Ghost should reactivate\n\n## Questions\n\n### When to Check?\n- Every move? (more API calls)\n- Only on 'significant' moves?\n\n### What Triggers Re-Hook?\n- Any position in the graph?\n- Only positions with due blunders downstream?\n\n## Proposed SPEC.md Addition\n\n### Section 6.1.1: Re-Hooking Logic\nAfter every user move, frontend calls GET /api/game/ghost-move with current FEN.\n\nBackend logic:\n1. Look up position by normalized FEN hash\n2. If not found → return { mode: 'engine' }\n3. If found, run downstream blunder query\n4. If due blunder reachable → return { mode: 'ghost', move: ... }\n5. Otherwise → return { mode: 'engine' }\n\n### Performance Note\nThis check happens every move. Response time target: \u003c100ms.\nConsider caching position lookups.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:07.039926-08:00","created_by":"miguel","updated_at":"2026-02-01T22:00:06.865097-08:00","closed_at":"2026-02-01T22:00:06.865097-08:00","close_reason":"Added section 6.1.1 Re-Hooking Logic to SPEC.md clarifying transposition detection mechanism"}
{"id":"ghostreplay-nzk","title":"Choose frontend state management solution","description":"The spec says 'React + Vite' but doesn't specify state management.\n\n## State to Manage\n\n### Game State\n- Current FEN position\n- Move history\n- Game mode (ghost vs engine)\n- Clock times (if implemented)\n- Whose turn\n\n### UI State\n- Selected square\n- Legal moves highlighting\n- Promotion dialog\n- Analysis panel open/closed\n\n### User State\n- Auth token\n- User profile\n- Preferences (engine level, board theme)\n\n### Server State\n- Blunder list\n- Stats data\n- Due reviews count\n\n## Options\n\n### 1. React Context + useReducer\n- Built-in, no dependencies\n- Good for simple apps\n- Pros: No extra bundle size, familiar\n- Cons: Can get messy at scale, no devtools\n\n### 2. Zustand\n- Minimal, hooks-based\n- ~1KB bundle\n- Pros: Simple API, good devtools, no boilerplate\n- Cons: Less structure than Redux\n\n### 3. Redux Toolkit\n- Full-featured, battle-tested\n- ~10KB bundle\n- Pros: Great devtools, middleware, time-travel debugging\n- Cons: More boilerplate, overkill for MVP?\n\n### 4. Jotai / Recoil\n- Atomic state model\n- Good for granular updates\n- Pros: Fine-grained reactivity\n- Cons: Different mental model, smaller community\n\n### 5. TanStack Query (React Query)\n- Server state management\n- Not for local state\n- Pros: Caching, refetching, loading states\n- Cons: Only for async data\n\n## Recommendation\n\n**Zustand for local/game state + TanStack Query for server state**\n\n```typescript\n// Game store (Zustand)\nconst useGameStore = create((set) =\u003e ({\n  fen: STARTING_FEN,\n  mode: 'engine',\n  makeMove: (move) =\u003e set((state) =\u003e ({ fen: applyMove(state.fen, move) })),\n}));\n\n// Server data (TanStack Query)\nconst { data: stats } = useQuery({\n  queryKey: ['stats'],\n  queryFn: fetchStats,\n});\n```\n\n## Implementation\n- Create /src/stores/ directory\n- Separate stores by domain: gameStore, uiStore, authStore\n- Use TanStack Query for all API calls\n- Document state shape and actions","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:38.254065-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.700304-08:00","closed_at":"2026-02-01T17:37:08.700304-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-o5b","title":"[SPEC] Define blunder context storage schema","description":"**Category: SPEC.md Update Required**\n\nThe current schema marks positions as blunders but doesn't store what the mistake was.\n\n## Problem\nTo show 'You played Qxd4, but Nf3 was better' we need:\n- The user's move\n- The engine's best move  \n- The evaluation difference\n\n## Proposed SPEC.md Addition\n\n### Section 5.3: `blunders` Table\n```sql\nCREATE TABLE blunders (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    position_id BIGINT REFERENCES positions(id),\n    user_move_san VARCHAR(10) NOT NULL,\n    best_move_san VARCHAR(10) NOT NULL,\n    eval_delta INTEGER NOT NULL,  -- centipawns lost\n    -- SRS fields (moved from positions)\n    srs_due_date TIMESTAMP,\n    srs_interval INTEGER DEFAULT 0,\n    srs_ease_factor FLOAT DEFAULT 2.5,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n## Design Decision\nThis separates the graph structure (positions/moves) from user-specific blunder tracking. Same position can be a blunder for multiple users with different SRS schedules.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:28.002039-08:00","created_by":"miguel","updated_at":"2026-02-01T18:48:04.735117-08:00","closed_at":"2026-02-01T18:48:04.735117-08:00","close_reason":"Updated SPEC.md with blunder context storage: added blunder_move_san for display, clarified that pass/fail uses real-time eval (not stored moves), any blunder at position = fail","dependencies":[{"issue_id":"ghostreplay-o5b","depends_on_id":"ghostreplay-j0k","type":"blocks","created_at":"2026-02-01T17:40:52.351827-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-ou7","title":"Add user model and authentication","description":"The spec describes a 'personal Chess Graph' but lacks any user identity layer.\n\n## Required Components\n\n1. **Database Schema**\n   - Add `users` table with id, email, password_hash, created_at\n   - Add `user_id` foreign key to `positions` table\n   - Add `user_id` foreign key to any session/game tracking tables\n\n2. **Authentication Flow**\n   - Registration (email + password)\n   - Login with JWT or session tokens\n   - Password reset flow\n   - Optional: OAuth (Google, Lichess, Chess.com)\n\n3. **API Changes**\n   - All endpoints must be authenticated\n   - User context must be passed to all graph queries\n   - Rate limiting per user\n\n4. **Frontend**\n   - Login/Register pages\n   - Auth state management\n   - Protected routes\n\n## Security Considerations\n- Password hashing (bcrypt/argon2)\n- HTTPS only\n- Token expiration and refresh\n- CSRF protection","status":"closed","priority":0,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:25.16987-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.639304-08:00","closed_at":"2026-02-01T17:37:08.639304-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-pq2","title":"Add user progress and statistics dashboard","description":"Users need visibility into their training progress. Currently no stats view is specified.\n\n## Required Metrics\n\n### Blunder Queue\n- Total blunders tracked\n- Due for review today\n- Overdue items\n- Upcoming (next 7 days)\n\n### Performance\n- Pass rate (% of reviews where user played correct move)\n- Average interval (mastery indicator)\n- Blunders 'graduated' (interval \u003e 30 days)\n- Blunders 'lapsed' (reset to 0 recently)\n\n### Trends\n- Blunders added per week\n- Pass rate over time\n- Most common blunder types (tactical themes if we tag them)\n\n## UI Components\n\n1. **Dashboard Page**\n   - Summary cards (due today, pass rate, streak)\n   - Chart: reviews over time\n   - Chart: pass rate trend\n\n2. **Blunder List View**\n   - Sortable/filterable table\n   - Click to see position + moves\n   - Manual 'practice now' button\n\n3. **Individual Blunder Detail**\n   - Board showing position\n   - Your move vs best move\n   - Review history (dates, pass/fail)\n\n## API Endpoints\n- GET /api/stats/summary\n- GET /api/stats/trends?range=30d\n- GET /api/blunders?status=due\u0026limit=50","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:41.988668-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.652821-08:00","closed_at":"2026-02-01T17:37:08.652821-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"ghostreplay-pq2","depends_on_id":"ghostreplay-ou7","type":"blocks","created_at":"2026-02-01T17:35:19.402711-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-sq8","title":"[IMPL] Design error handling and recovery strategy","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until SPEC.md is finalized.\n\n## Scenarios to Handle\n- Web Worker crash (Stockfish dies)\n- Network disconnection mid-game\n- Database unavailable\n- Invalid game state\n\n## Deliverables\n- Error response format standard\n- Retry/recovery logic\n- User feedback patterns\n- Monitoring/alerting approach","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:12.523447-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:12.523447-08:00"}
{"id":"ghostreplay-u1b","title":"Design complete API endpoint specification","description":"Only POST /blunder is mentioned in the spec. A complete API is needed.\n\n## Required Endpoints\n\n### Authentication\n- POST /api/auth/register\n- POST /api/auth/login\n- POST /api/auth/logout\n- POST /api/auth/refresh\n- POST /api/auth/forgot-password\n- POST /api/auth/reset-password\n\n### Game Flow\n- POST /api/game/start - Initialize new game, returns game_id\n- GET /api/game/:id/ghost-move - Get next ghost move for position\n  - Input: { fen: string }\n  - Output: { mode: 'ghost'|'engine', move?: string, blunder_id?: number }\n- POST /api/game/:id/end - Record game completion\n\n### Blunder Management\n- POST /api/blunder - Record new blunder (existing)\n  - Input: { fen, user_move, best_move, eval_delta, game_id }\n- GET /api/blunders - List user's blunders\n  - Query params: status, due_before, limit, offset\n- GET /api/blunder/:id - Get blunder details\n\n### SRS\n- POST /api/srs/review - Record review result\n  - Input: { blunder_id, result: 'pass'|'fail' }\n  - Output: { next_due_date, new_interval }\n\n### Stats\n- GET /api/stats/summary - Dashboard summary\n- GET /api/stats/trends - Historical data\n\n## Design Considerations\n- RESTful conventions\n- Consistent error response format\n- Pagination for list endpoints\n- OpenAPI/Swagger documentation","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:58.027171-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.661595-08:00","closed_at":"2026-02-01T17:37:08.661595-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"ghostreplay-u1b","depends_on_id":"ghostreplay-ou7","type":"blocks","created_at":"2026-02-01T17:35:19.208918-08:00","created_by":"miguel"}]}
{"id":"ghostreplay-ujl","title":"[SPEC] Define game lifecycle and session tracking","description":"**Category: SPEC.md Update Required**\n\nThe spec says 'first blunder only per session' but doesn't define sessions or game lifecycle.\n\n## Questions to Answer\n\n### What is a Session?\n- One game from 'New Game' to termination\n- Needs unique identifier\n\n### Game States\n- Starting (user clicks New Game)\n- In Progress (playing)\n- Ended (checkmate, resign, draw, abandon)\n\n## Proposed SPEC.md Addition\n\n### Section 2.4: Game Sessions\n```sql\nCREATE TABLE game_sessions (\n    id UUID PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    started_at TIMESTAMP DEFAULT NOW(),\n    ended_at TIMESTAMP,\n    result VARCHAR(20),  -- 'checkmate', 'resign', 'draw', 'abandon'\n    engine_elo INTEGER,\n    blunder_recorded BOOLEAN DEFAULT FALSE\n);\n```\n\n### First-Blunder Rule\nWhen POST /blunder is called:\n1. Check session's blunder_recorded flag\n2. If FALSE, record blunder and set flag TRUE\n3. If TRUE, ignore (already recorded one this game)\n\n## Also Define\n- How does resignation work?\n- Are games persisted (PGN storage) or ephemeral?\n- Browser refresh mid-game recovery?","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:50.743959-08:00","created_by":"miguel","updated_at":"2026-02-01T19:25:31.080232-08:00","closed_at":"2026-02-01T19:25:31.080232-08:00","close_reason":"Added Section 7 to SPEC.md defining game sessions, lifecycle states, session schema with PGN, move analysis storage with classification thresholds, and first-blunder rule enforcement"}
{"id":"ghostreplay-vmu","title":"[IMPL] Add engine skill level selection","description":"**Category: Implementation Task (Post-Spec)**\n\n## Requirements\n- UI to select Elo 800-2500\n- Map to Stockfish Skill Level 0-20\n- Persist user preference\n- Pass to Stockfish worker\n\n## Nice to Have\n- Named presets (Beginner, Intermediate, etc.)\n- Adaptive difficulty based on win rate","status":"open","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:21.206938-08:00","created_by":"miguel","updated_at":"2026-02-01T17:38:21.206938-08:00"}
{"id":"ghostreplay-w0h","title":"Clarify transposition detection and ghost re-hooking","description":"The spec mentions 'Re-Hooking' when a user transposes into a known blunder path, but the mechanism isn't clear.\n\n## The Scenario\n1. User deviates from ghost path at move 5\n2. Engine mode takes over\n3. At move 12, position happens to match a known blunder path\n4. Ghost should 'reactivate'\n\n## Questions\n\n### When to Check for Re-Hook?\n- After every user move? (frequent API calls)\n- Only after significant position changes?\n- Only when entering certain position types?\n\n### What Defines a 'Known Position'?\n- Any position in the graph? (too broad)\n- Only positions that are N moves from a due blunder?\n- Only positions on the direct path to a due blunder?\n\n## Proposed Implementation\n\n### Frontend Flow\n1. User makes move\n2. Frontend sends FEN to GET /api/ghost/check\n3. API response:\n   - `{ mode: 'ghost', next_move: 'Nf3', blunder_distance: 3 }`\n   - `{ mode: 'engine' }` (no blunder path found)\n4. Frontend switches mode accordingly\n\n### Backend Logic\n```python\ndef check_ghost_path(user_id: int, fen: str) -\u003e GhostCheck:\n    # Normalize FEN\n    fen_hash = hash_fen(normalize(fen))\n    \n    # Check if this position exists in graph\n    position = get_position_by_hash(fen_hash)\n    if not position:\n        return GhostCheck(mode='engine')\n    \n    # Check for downstream due blunders\n    path = find_path_to_nearest_due_blunder(position.id, user_id)\n    if not path:\n        return GhostCheck(mode='engine')\n    \n    return GhostCheck(\n        mode='ghost',\n        next_move=path[0].move_san,\n        blunder_distance=len(path)\n    )\n```\n\n### Performance Consideration\n- This check happens every move\n- Must be fast (\u003c 100ms)\n- Cache position lookups\n- Optimize recursive CTE with proper indexes","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:52.187308-08:00","created_by":"miguel","updated_at":"2026-02-01T17:37:08.684346-08:00","closed_at":"2026-02-01T17:37:08.684346-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"ghostreplay-zwv","title":"Graph model claimed as DAG but chess graphs have cycles","description":"## Problem\n\nThe spec explicitly calls the graph model a **Directed Acyclic Graph (DAG)**, but chess graphs naturally have cycles.\n\nIn real chess, repetition is common (threefolds, perpetual checks, transpositions that revisit positions), so cycles can appear as soon as the same normalized FEN is re-reached.\n\nWhile a standard chess game moves forward in time (making it seem acyclic), the database stores **Positions (FENs)**. In chess, it is perfectly valid to reach the same position twice (e.g., 1. Nf3 Nf6 2. Ng1 Ng8). If a user has ever practiced a \"draw by repetition\" line, the graph will contain a physical loop (Node A → Node B → Node A).\n\n## Spec Correction Needed\n\nUpdate SPEC.md to:\n1. Clarify the graph is a **directed graph with potential cycles**, not a true DAG\n2. Document that recursive queries require depth bounds and cycle detection\n3. Include the recommended query pattern below\n\n## Recommended Query Pattern (for spec)\n\nPostgreSQL 14+ has a built-in CYCLE detection feature. For older versions, use depth counter + path tracking:\n\n```sql\nWITH RECURSIVE scent_path AS (\n    -- BASE CASE: Starting moves from current position\n    SELECT \n        m.from_position_id,\n        m.to_position_id,\n        m.move_san AS root_move,\n        1 AS depth,\n        ARRAY[m.from_position_id] as path_history\n    FROM moves m\n    JOIN positions p ON p.id = m.from_position_id\n    WHERE p.fen_hash = :current_fen_hash\n\n    UNION ALL\n\n    -- RECURSIVE STEP\n    SELECT \n        child.from_position_id,\n        child.to_position_id,\n        parent.root_move,\n        parent.depth + 1,\n        parent.path_history || child.from_position_id\n    FROM moves child\n    JOIN scent_path parent ON parent.to_position_id = child.from_position_id\n    WHERE \n        parent.depth \u003c 15                                          -- Depth limit\n        AND NOT (child.to_position_id = ANY(parent.path_history))  -- Cycle detection\n)\nSELECT \n    root_move, \n    COUNT(*) as distinct_blunders,\n    MIN(depth) as closest_blunder_distance,\n    SUM(CASE WHEN p.srs_due_date \u003c= NOW() THEN 10 ELSE 1 END) as urgency_score\nFROM scent_path sp\nJOIN positions p ON p.id = sp.to_position_id\nWHERE p.is_blunder = TRUE\nGROUP BY root_move\nORDER BY urgency_score DESC, closest_blunder_distance ASC\nLIMIT 1;\n```\n\n**Key safeguards:**\n- `depth \u003c 15`: Hard cap prevents runaway recursion (blunders 20+ moves away have \"faint scent\" anyway)\n- `path_history` array + `NOT ... = ANY(...)`: Prevents infinite loops from 3-fold repetition patterns","status":"closed","priority":1,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-01T22:37:13.44046-08:00","created_by":"miguel","updated_at":"2026-02-01T22:42:22.823168-08:00","closed_at":"2026-02-01T22:42:22.823168-08:00","close_reason":"Updated SPEC.md: corrected DAG terminology to 'directed graph with potential cycles', added cycle detection and depth bound requirements, included reference SQL implementation with safeguards"}
