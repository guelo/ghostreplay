{"id":"g-05i","title":"Frontend: Build unified game history list + selected-game analysis shell","description":"Build the combined History+Analysis page shell. Render a scrollable game card list and maintain selected session_id state. Selecting a card should drive the analysis pane for that game. Default selection: latest game when arriving from post-game flow; otherwise newest available game.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:18.947188-08:00","created_by":"miguel","updated_at":"2026-02-07T18:55:33.592565-08:00","closed_at":"2026-02-07T18:55:33.592565-08:00","close_reason":"Built unified history page with game card list, selected-game state, and analysis shell","dependencies":[{"issue_id":"g-05i","depends_on_id":"g-0iz","type":"blocks","created_at":"2026-02-02T14:02:33.978357-08:00","created_by":"miguel"},{"issue_id":"g-05i","depends_on_id":"g-817","type":"parent-child","created_at":"2026-02-02T14:06:33.41637-08:00","created_by":"miguel"}]}
{"id":"g-07f","title":"Frontend: Build evaluation bar component","description":"Vertical/horizontal bar showing advantage. Fill based on eval. Display numerical value (+1.2 or M3). White/black color coding.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:08.910819-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.004211-08:00","dependencies":[{"issue_id":"g-07f","depends_on_id":"g-vp6","type":"blocks","created_at":"2026-02-02T14:02:24.989678-08:00","created_by":"miguel"},{"issue_id":"g-07f","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:25.692077-08:00","created_by":"miguel"}]}
{"id":"g-0ga","title":"Define deployment architecture","description":"No deployment strategy is specified.\n\n## Components to Deploy\n\n1. **Frontend** - Static React app\n2. **Backend** - Python FastAPI server\n3. **Database** - PostgreSQL\n\n## Options\n\n### Option A: Simple VPS (MVP)\n- Single DigitalOcean/Linode droplet\n- Docker Compose for all services\n- Nginx reverse proxy\n- Let's Encrypt SSL\n\n```yaml\n# docker-compose.yml\nservices:\n  frontend:\n    build: ./frontend\n    ports: ['3000:3000']\n  \n  backend:\n    build: ./backend\n    ports: ['8000:8000']\n    environment:\n      DATABASE_URL: postgres://...\n  \n  db:\n    image: postgres:15\n    volumes:\n      - pgdata:/var/lib/postgresql/data\n  \n  nginx:\n    image: nginx\n    ports: ['80:80', '443:443']\n```\n\n- Pros: Simple, cheap (~$10/mo), full control\n- Cons: Manual scaling, single point of failure\n\n### Option B: Platform as a Service\n- **Frontend**: Vercel or Netlify (free tier)\n- **Backend**: Railway, Render, or Fly.io\n- **Database**: Managed Postgres (Supabase, Neon, Railway)\n\n- Pros: No ops, auto-scaling, easy deploys\n- Cons: Can get expensive, less control\n\n### Option C: Cloud Native (Future)\n- AWS/GCP with Terraform\n- ECS or Cloud Run for backend\n- RDS for database\n- CloudFront for frontend\n\n- Pros: Production-grade, scalable\n- Cons: Complex, expensive, overkill for MVP\n\n## Recommendation\n**Option B for MVP**:\n- Vercel for frontend (free, great DX)\n- Railway or Fly.io for backend\n- Neon or Supabase for Postgres\n\n## CI/CD Pipeline\n```yaml\n# GitHub Actions\non:\n  push:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - run: npm test\n      - run: pytest\n  \n  deploy-frontend:\n    needs: test\n    # Vercel auto-deploys from GitHub\n  \n  deploy-backend:\n    needs: test\n    steps:\n      - uses: railway/deploy-action\n```\n\n## Environment Management\n- Development: Local Docker Compose\n- Staging: Separate deployment (optional for MVP)\n- Production: Main deployment\n\n## Secrets Management\n- Use platform's env var management\n- Never commit secrets\n- Document required env vars","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:57.232208-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.100086-08:00","closed_at":"2026-02-01T17:37:08.708273-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-0ho","title":"Frontend: Show pass feedback","description":"On pass: show brief toast/notification 'Correct\\! You avoided your past mistake.' Auto-dismiss after 3 seconds. Game continues.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:48.007151-08:00","created_by":"miguel","updated_at":"2026-02-07T04:26:14.958255-08:00","closed_at":"2026-02-07T04:26:14.958255-08:00","close_reason":"Added pass toast UI: green-themed review-pass-toast with 'Correct\\! You avoided your past mistake.' message, 3s auto-dismiss, click-to-dismiss, resets on new game/reset. Trigger (setShowPassToast) ready for g-1pl to wire up.","dependencies":[{"issue_id":"g-0ho","depends_on_id":"g-1pl","type":"blocks","created_at":"2026-02-02T14:02:13.857453-08:00","created_by":"miguel"},{"issue_id":"g-0ho","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:15.931086-08:00","created_by":"miguel"}]}
{"id":"g-0i1","title":"Login doesnt persist","description":"After logging in a refresh wipes away the username and shows the Register and Login buttons in the header again.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-06T13:23:25.292219-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.978526-08:00","closed_at":"2026-02-06T13:53:11.938471-08:00","close_reason":"Restore auth state from stored JWT on refresh instead of re-calling login API"}
{"id":"g-0id","title":"DB: Create blunder_reviews table migration","description":"Migration for blunder_reviews: id, blunder_id, session_id, reviewed_at, passed, move_played_san, eval_delta_cp. FK to blunders and game_sessions. Index on (blunder_id, reviewed_at DESC).","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:46.770828-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.923575-08:00","dependencies":[{"issue_id":"g-0id","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:14.726065-08:00","created_by":"miguel"}]}
{"id":"g-0iz","title":"Backend: GET /api/history endpoint","description":"Return user's completed games (status=ended), newest first. Include session metadata + summary stats from session_moves. Support ?limit param (default 50, max 100).","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:18.697782-08:00","created_by":"miguel","updated_at":"2026-02-07T18:37:19.969883-08:00","closed_at":"2026-02-07T18:37:19.969883-08:00","close_reason":"Implemented GET /api/history endpoint with ?limit param, session metadata, and summary stats from session_moves","dependencies":[{"issue_id":"g-0iz","depends_on_id":"g-817","type":"parent-child","created_at":"2026-02-02T14:06:33.142847-08:00","created_by":"miguel"},{"issue_id":"g-0iz","depends_on_id":"g-z5y","type":"blocks","created_at":"2026-02-07T00:44:06.87045-08:00","created_by":"miguel"}]}
{"id":"g-0v6","title":"Frontend: Implement ghost/engine mode switching","description":"If mode=ghost, use returned move instead of Worker A calculation. If mode=engine, request move from Worker A (Stockfish). Show indicator of current mode.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:31.659435-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.926959-08:00","closed_at":"2026-02-03T17:34:46.937928-08:00","close_reason":"Implemented ghost/engine mode switching. Ghost moves are applied when available, otherwise Stockfish is used. Mode indicator shown in UI.","dependencies":[{"issue_id":"g-0v6","depends_on_id":"g-gbh","type":"blocks","created_at":"2026-02-02T14:02:02.281523-08:00","created_by":"miguel"},{"issue_id":"g-0v6","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:06.416775-08:00","created_by":"miguel"}]}
{"id":"g-0vl","title":"Backend: Implement JWT token generation/validation","description":"Create functions to generate JWT with user_id/username/exp claims. Add middleware to validate Bearer tokens.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:36.378432-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.860945-08:00","closed_at":"2026-02-02T18:48:31.701523-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-0vl","depends_on_id":"g-8c1","type":"blocks","created_at":"2026-02-02T14:01:29.104907-08:00","created_by":"miguel"},{"issue_id":"g-0vl","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:21.866705-08:00","created_by":"miguel"}]}
{"id":"g-14w","title":"E2E: Setup Playwright and test database","description":"Configure Playwright, create test DB seeding scripts. Setup fixtures for user accounts with blunder data.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:37.962489-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.08251-08:00"}
{"id":"g-15y","title":"[IMPL] Choose frontend state management solution","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until SPEC.md is finalized.\n\n## Decision Needed\n- Zustand (minimal, ~1KB)\n- Redux Toolkit (full-featured, ~10KB)\n- React Context + useReducer (built-in)\n\n## Recommendation\nZustand for local state + TanStack Query for server state.\n\n## Depends On\n- Finalized API spec to know what server state to manage\n- Game lifecycle design to know local state shape","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:10.032766-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.099111-08:00","closed_at":"2026-02-05T16:57:28.109975-08:00","close_reason":"Closed"}
{"id":"g-1ix","title":"DevOps: Create Dockerfile for FastAPI backend","description":"Multi-stage build: dependencies layer + app layer. Include python-chess, FastAPI, uvicorn. Expose port 8000.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:49.342545-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.080014-08:00","dependencies":[{"issue_id":"g-1ix","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:00.007101-08:00","created_by":"miguel"}]}
{"id":"g-1pl","title":"Frontend: Evaluate user move at blunder position (≥50cp = fail)","description":"After user moves from blunder position, Worker B evaluates. If eval_delta ≥ 50cp → fail. If \u003c 50cp → pass. Call POST /api/srs/review with result.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:47.506119-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.919661-08:00","dependencies":[{"issue_id":"g-1pl","depends_on_id":"g-kt9","type":"blocks","created_at":"2026-02-02T14:02:13.128631-08:00","created_by":"miguel"},{"issue_id":"g-1pl","depends_on_id":"g-766","type":"blocks","created_at":"2026-02-02T14:02:13.366914-08:00","created_by":"miguel"},{"issue_id":"g-1pl","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:15.445534-08:00","created_by":"miguel"}]}
{"id":"g-1qb","title":"Frontend: Setup Vitest and React Testing Library","description":"Configure Vitest, RTL. Create test utilities for rendering components with auth/game context.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:37.207477-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.085917-08:00","closed_at":"2026-02-02T15:36:36.610127-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-1qb","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:22:21.72036-08:00","created_by":"miguel"}]}
{"id":"g-1wk","title":"Create positions and blunders tables","description":"Define DB schema/migrations for positions and blunders tables. Include user_id column; hardcode user_id=1 in access paths. Skip auth/registration.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:29:22.191919-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.03255-08:00","closed_at":"2026-02-02T02:23:26.18213-08:00","close_reason":"Closed"}
{"id":"g-26v","title":"Backend: GET /api/game/ghost-move endpoint","description":"Accept session_id, fen. Normalize FEN, lookup position. Run downstream blunder query. Return mode=ghost + move if found, mode=engine if not. Include target_blunder_id.","notes":"SPEC update: include session.player_color filter (positions.active_color) when selecting target blunders for ghost-move.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:31.145054-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.929747-08:00","closed_at":"2026-02-04T02:52:31.497854-08:00","close_reason":"Updated ghost-move endpoint to return mode/move/target_blunder_id per SPEC. Updated frontend to consume new response format. All tests pass.","dependencies":[{"issue_id":"g-26v","depends_on_id":"g-axp","type":"blocks","created_at":"2026-02-02T14:02:01.812535-08:00","created_by":"miguel"},{"issue_id":"g-26v","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:05.916749-08:00","created_by":"miguel"},{"issue_id":"g-26v","depends_on_id":"g-hhh.1","type":"blocks","created_at":"2026-02-02T20:35:26.317892-08:00","created_by":"miguel"},{"issue_id":"g-26v","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:35:30.944036-08:00","created_by":"miguel"},{"issue_id":"g-26v","depends_on_id":"g-49g","type":"blocks","created_at":"2026-02-03T03:06:41.533442-08:00","created_by":"miguel"}]}
{"id":"g-29c","title":"Feature: Continuous Maia-2 difficulty slider across full Elo range","description":"## Summary\nBuild a continuous difficulty slider for Maia-2 that feels like a real Elo continuum (targeting roughly \u003c500 to \u003e3000), despite Maia-2's discrete internal skill buckets.\n\n## Context From Research Conversations\n- Maia-2 only exposes two pretrained checkpoint variants (`rapid`, `blitz`), and skill is conditioned via `elo_self`/`elo_oppo` inputs.\n- Observed behavior indicates Elo is bucketed, not truly continuous (e.g., identical move probabilities from 500-1000, sharp change at ~1100; likely another boundary around 2000).\n- Therefore, Maia-2 alone cannot provide fine-grained low-Elo differentiation or true superhuman scaling.\n- Stockfish \"weakening\" techniques show the practical pattern: use a wrapper/controller to choose from candidates, control error size/frequency, and avoid alien-only engine lines.\n\n## Problem\nCurrent Maia-2 usage can only \"choose a bucket,\" not provide a smooth slider. We need one continuous control that:\n- Preserves human-like style.\n- Produces believable weakness below Maia's lowest bucket.\n- Scales above Maia's highest bucket toward engine strength.\n- Is calibratable to measurable Elo behavior.\n\n## Proposed Design\nUse a 3-part architecture: **Prior + Judge + Controller**.\n\n### 1) Prior (Maia-2)\n- Generate move probabilities from Maia-2 (`rapid`/`blitz`) using `elo_self`/`elo_oppo`.\n- Treat Maia as the human-style prior, not as final move chooser.\n\n### 2) Judge (Stockfish or lc0)\n- Evaluate candidate moves with bounded compute (`MultiPV`, depth/nodes/movetime caps).\n- Compute per-move quality signals:\n  - `loss_cp = eval(best) - eval(move)`\n  - only-move pressure (gap between best and second-best)\n  - tactical complexity proxy (PV forcing length / eval volatility)\n\n### 3) Controller (continuous slider)\nGiven `target_elo`, select a move by balancing:\n- Maia plausibility (`-log P_maia(move)` / surprisal)\n- target centipawn-loss distribution\n- blunder frequency\n- anti-inhuman penalties (only-move pressure, extreme forcing lines)\n\nRecommended first strategy:\n- Sample desired `target_loss_cp` from an Elo-dependent heavy-tailed distribution.\n- Pick candidate closest to target loss, subject to Maia plausibility floor.\n\n## Candidate Pooling\nPer position:\n- Maia top-K candidates (+ optional tail samples for lower Elo).\n- Stockfish `MultiPV` candidates for objective alternatives.\n- Optional \"safe nonsense\" pool for very low Elo modes.\n\n## Elo Range Strategy\n- **Below ~1100**: Maia bucket is flat; add controller-driven weakening (temperature/sampling + explicit blunder/perception-failure probabilities).\n- **1100-2200**: Primarily Maia style + controlled error distribution.\n- **Above ~2200**: Progressively blend toward near-best engine play; use Maia as tie-breaker among near-equal moves to reduce robotic repetition.\n- **\u003e3000 target**: tighten loss tolerance toward 0 and increase judge resources.\n\n## Calibration Plan\nFit mapping `target_elo -\u003e controller parameters` by measurement, not guesswork:\n- Run mini tournaments against fixed baselines (e.g., Stockfish limited-strength settings and/or stable bots).\n- Measure achieved Elo, blunder rate, mean CP loss, and style metrics.\n- Iteratively tune parameter curves until slider is monotonic and empirically aligned.\n\n## Milestones\n1. Implement `choose_move(position, target_elo, time_control)` wrapper using Maia + Stockfish metrics.\n2. Add parameterized controller curves (loss, blunder rate, temperature, Maia floor).\n3. Add low-Elo perception-failure layer (missed threats/hanging piece handling probabilities).\n4. Add high-Elo blend logic for \u003e2200 targets.\n5. Build calibration harness and produce initial mapping table.\n6. Expose as product-facing continuous slider API/config.\n\n## Acceptance Criteria\n- Single numeric difficulty input (continuous slider) is exposed and wired end-to-end.\n- Behavior changes smoothly across slider values (no large unintended flat zones except where intentionally compensated by controller).\n- Distinguishable play profiles for 500 vs 800 vs 1000 targets despite Maia bucket collapse.\n- Strong-side behavior increases above 2200 and approaches near-best engine play by upper targets.\n- Per-move telemetry logs: Maia probability, CP loss, chosen reason/path, and target-vs-actual error bucket.\n- Calibration report exists with achieved Elo estimates across at least 8 ladder points.\n- Documentation explains limits (Maia buckets), architecture, and tuning knobs.\n\n## Non-Goals\n- Retraining Maia-2 weights.\n- Claiming exact official Elo equivalence without calibration evidence.\n\n## Risks\n- Overfitting to Stockfish-centric metrics may degrade human-like feel.\n- Low-Elo weakening may look random without perception-model constraints.\n- Throughput cost from per-move MultiPV evaluation.\n\n## Notes\nSource conversations synthesized from:\n- `docs/continuos maya slider`\n- `docs/stockfish lowering techniques`\n","status":"open","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-06T03:03:40.817645-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.983506-08:00","dependencies":[{"issue_id":"g-29c","depends_on_id":"g-29c.2","type":"blocks","created_at":"2026-02-06T13:10:56.38664-08:00","created_by":"miguel"}]}
{"id":"g-29c.1","title":"Spike: Maia-2 runtime feasibility (browser vs backend engine service)","description":"## Summary\nInvestigate and decide where Maia-2 inference should run for Ghost Replay.\n\nPrimary question:\nCan we run Maia-2 directly in-browser (similar to current Stockfish WASM workers), or should we re-architect to run Maia-2 on the backend and expose an engine API?\n\n## Why This Child Issue Exists\nParent issue `ghostreplay-29c` defines a continuous Maia-2 difficulty slider. That work is blocked until we resolve runtime placement (browser vs backend), because the integration surface, latency budget, and infra costs differ significantly.\n\n## Current Findings (as of 2026-02-06)\n### Upstream Maia-2 implementation reality\nFrom `CSSLab/maia2` (HEAD `16c138306339b87215abc8de45ac47c50ec603b1`, 2025-07-23):\n- Official package is Python-first (`pip install maia2`), with examples in Python only.\n- Dependencies include `torch==2.4.0`, `gdown`, `numpy`, `pandas`, etc. (not a JS/browser runtime stack).\n- `model.from_pretrained(type, device)` downloads `.pt` checkpoints via Google Drive URLs and loads via `torch.load(...)`.\n- API supports only `type in {\"rapid\", \"blitz\"}` checkpoints.\n- Elo input is bucketized in code (`\u003c1100`, 100-point bins 1100-1999, `\u003e=2000`), not truly continuous.\n\n### Implication\nThere is no official browser/WASM/JS inference path in `maia2` today; direct frontend drop-in appears non-trivial and likely requires model export + runtime porting work.\n\n## Ghost Replay Architectural Context\n- Current app runs engine logic in browser workers via `stockfish.wasm` (`src/workers/stockfishWorker.ts`, `src/workers/analysisWorker.ts`).\n- Backend currently coordinates session/ghost data and does not run chess engine inference (`backend/app/api/game.py`).\n- If Maia-2 cannot be made practical client-side, engine responsibility must move server-side (or hybrid), which changes API boundaries and operational requirements.\n\n## Scope of This Spike\n1. Validate browser feasibility concretely\n- Determine whether a realistic browser path exists without training a new model:\n  - export/conversion requirements (e.g., ONNX/TorchScript/WebGPU runtime),\n  - expected model size/load time,\n  - browser memory/compute viability on target devices,\n  - dependency/licensing constraints for shipping weights.\n\n2. Produce backend fallback design (if browser is not viable)\n- Define API contract for engine inference endpoint(s), including request/response schema.\n- Define move-selection contract needed by parent continuous-slider work (Maia probs + judge metrics + chosen move).\n- Define execution model: sync request, async queue, or streaming.\n- Define caching strategy for model load and prepared inference artifacts.\n- Define deployment assumptions (CPU baseline, optional GPU), throughput targets, and cost risks.\n\n3. Recommend architecture decision\n- Provide explicit go/no-go for browser runtime.\n- If no-go: provide phased migration plan for backend engine integration.\n\n## Deliverables\n- Decision memo in repo docs (`docs/maia2-runtime-feasibility.md`) with evidence and recommendation.\n- Proposed API spec for engine inference endpoint(s).\n- Initial implementation plan (milestones + estimates) for selected architecture.\n\n## Acceptance Criteria\n- Browser feasibility is tested and documented with concrete technical blockers or validated path.\n- A clear architectural decision is recorded: `browser`, `backend`, or `hybrid`, with rationale.\n- If decision is backend/hybrid, a concrete API contract and migration plan are documented.\n- Parent issue `ghostreplay-29c` is updated with dependency outcome and next actionable tasks.\n\n## Non-Goals\n- Implementing full Maia-2 production inference in this issue.\n- Full Elo calibration or continuous-slider tuning logic (covered by parent and follow-on tasks).\n\n## References\n- Upstream repo: https://github.com/CSSLab/maia2\n- Parent: `ghostreplay-29c`\n","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T03:19:16.95571-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.889665-08:00","closed_at":"2026-02-06T13:16:29.742426-08:00","close_reason":"Closed"}
{"id":"g-29c.2","title":"[IMPL] Unified backend opponent move pipeline (ghost + maia)","description":"## Summary\nImplement the post-spike architecture where backend is the single decision-maker for opponent moves.\n\nThis epic replaces frontend split orchestration (ghost endpoint + local engine fallback) with one backend endpoint that returns exactly one next opponent move.\n\n## Scope\n- Backend endpoint: POST /api/game/next-opponent-move\n- Ghost-first path traversal + backend engine fallback\n- Maia runtime/bootstrap and model caching in backend\n- Frontend integration to consume one endpoint\n- Test coverage, observability, and rollout guardrails\n\n## Out of Scope\n- Full Elo calibration science for the continuous slider (tracked in parent strategy work)\n- Replacing browser-side analysis worker for blunder detection in this epic\n\n## References\n- docs/maia2-runtime-feasibility.md\n- SPEC.md updates for unified architecture","acceptance_criteria":"Single backend endpoint drives opponent move selection end-to-end; frontend no longer does normal-path local opponent-engine selection; legacy ghost-only endpoint is removed or deprecated with migration notes; tests and perf guardrails are in place.","status":"open","priority":1,"issue_type":"epic","owner":"unroar@gmail.com","created_at":"2026-02-06T13:09:12.155239-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.887454-08:00","dependencies":[{"issue_id":"g-29c.2","depends_on_id":"g-29c.1","type":"blocks","created_at":"2026-02-06T13:10:41.0932-08:00","created_by":"miguel"}]}
{"id":"g-29c.2.1","title":"Backend API contract for next-opponent-move","description":"## Summary\nDefine and implement request/response schemas for POST /api/game/next-opponent-move.\n\n## Scope\n- Add FastAPI route and Pydantic models\n- Validate session ownership and FEN input\n- Return unified payload: mode, move {uci,san}, target_blunder_id, decision_source\n- Normalize error semantics to existing API envelope\n\n## Notes\nThis issue is contract-first and does not include full Maia runtime implementation details (handled separately).","acceptance_criteria":"Endpoint exists and validates input; response schema matches SPEC; includes decision_source and both SAN/UCI move forms; auth/ownership checks pass; API docs reflect new contract.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T13:09:39.248508-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.885315-08:00","labels":["api","backend","maia2"],"dependencies":[{"issue_id":"g-29c.2.1","depends_on_id":"g-29c.2","type":"parent-child","created_at":"2026-02-06T13:09:39.251447-08:00","created_by":"miguel"}]}
{"id":"g-29c.2.2","title":"Ghost-first decision engine in backend endpoint","description":"## Summary\nImplement orchestration logic for next-opponent-move: ghost path traversal first, backend engine fallback second.\n\n## Scope\n- Reuse/port existing ghost traversal query logic from /api/game/ghost-move\n- Enforce opponent-turn validation for provided FEN\n- Convert selected move to both UCI and SAN for response payload\n- Return decision_source = ghost_path or backend_engine\n\n## Excludes\n- Maia model runtime bootstrap details (tracked in sibling issue).","acceptance_criteria":"Given a position with reachable due blunder, endpoint returns mode=ghost and target_blunder_id; when no ghost path exists, endpoint returns mode=engine with backend-generated move; move legality is guaranteed for both branches.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T13:09:46.905644-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.882856-08:00","labels":["api","backend","ghost"],"dependencies":[{"issue_id":"g-29c.2.2","depends_on_id":"g-29c.2","type":"parent-child","created_at":"2026-02-06T13:09:46.909487-08:00","created_by":"miguel"},{"issue_id":"g-29c.2.2","depends_on_id":"g-29c.2.1","type":"blocks","created_at":"2026-02-06T13:10:27.319344-08:00","created_by":"miguel"},{"issue_id":"g-29c.2.2","depends_on_id":"g-29c.2.3","type":"blocks","created_at":"2026-02-06T13:10:27.571559-08:00","created_by":"miguel"}]}
{"id":"g-29c.2.3","title":"Maia runtime bootstrap and model cache in backend","description":"## Summary\nEnable reliable Maia inference runtime in backend service with process-level caching.\n\n## Scope\n- Add/pin runtime dependencies required for Maia inference\n- Implement lazy model load (rapid first) and prepared artifact cache\n- Define failure behavior when model unavailable (explicit 503 path)\n- Add warmup/health check hooks as needed for deploy readiness\n\n## Risks\n- Memory footprint per worker\n- Cold-start latency\n- Python/Torch compatibility","acceptance_criteria":"Backend can serve inference without per-request model reload; runtime dependencies are pinned/documented; unavailable-model path is explicit and test-covered; startup/warm path is documented.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T13:09:57.398227-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.880905-08:00","labels":["backend","infra","maia2"],"dependencies":[{"issue_id":"g-29c.2.3","depends_on_id":"g-29c.2","type":"parent-child","created_at":"2026-02-06T13:09:57.401085-08:00","created_by":"miguel"}]}
{"id":"g-29c.2.4","title":"Frontend integration: replace split opponent flow","description":"## Summary\nUpdate frontend to consume only POST /api/game/next-opponent-move for opponent turns.\n\n## Scope\n- Replace getGhostMove + local opponent-engine branch in useOpponentMove/ChessGame flow\n- Add typed API client for unified endpoint response\n- Apply returned move uniformly (SAN/UCI handling)\n- Keep network-error fallback behavior explicit\n\n## Notes\nBrowser-side analysis worker remains unchanged for blunder detection.","acceptance_criteria":"Opponent move selection in normal path uses only backend endpoint; frontend no longer performs ghost-then-local-engine branching logic; game flow remains functional for both ghost and engine modes.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T13:10:02.398647-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.878194-08:00","labels":["api","frontend","integration"],"dependencies":[{"issue_id":"g-29c.2.4","depends_on_id":"g-29c.2","type":"parent-child","created_at":"2026-02-06T13:10:02.400848-08:00","created_by":"miguel"},{"issue_id":"g-29c.2.4","depends_on_id":"g-29c.2.2","type":"blocks","created_at":"2026-02-06T13:10:27.838016-08:00","created_by":"miguel"}]}
{"id":"g-29c.2.5","title":"Deprecate /api/game/ghost-move and complete contract migration","description":"## Summary\nRetire or deprecate legacy ghost-only endpoint after unified endpoint adoption.\n\n## Scope\n- Decide deprecation vs immediate removal strategy\n- Update backend route surface accordingly\n- Update client references/tests/docs to remove ghost-only contract\n- Add migration note/changelog entry for API consumers\n\n## Notes\nThis should land after frontend/backend unified endpoint wiring is validated.","acceptance_criteria":"No active code path depends on /api/game/ghost-move; migration/deprecation path is documented; tests reflect the new single-endpoint architecture.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T13:10:08.134758-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.98099-08:00","labels":["api","backend","cleanup"],"dependencies":[{"issue_id":"g-29c.2.5","depends_on_id":"g-29c.2","type":"parent-child","created_at":"2026-02-06T13:10:08.1374-08:00","created_by":"miguel"},{"issue_id":"g-29c.2.5","depends_on_id":"g-29c.2.4","type":"blocks","created_at":"2026-02-06T13:10:28.094562-08:00","created_by":"miguel"}]}
{"id":"g-29c.2.6","title":"Test, perf, and observability hardening for unified endpoint","description":"## Summary\nAdd reliability coverage and baseline performance telemetry for next-opponent-move.\n\n## Scope\n- Backend integration tests: ghost branch, engine branch, invalid FEN, auth/session errors\n- Frontend tests for opponent mode transitions using unified response\n- Timing instrumentation (lookup vs inference components)\n- Define and document p50/p95 latency expectations for MVP\n\n## Deliverables\n- Test cases in CI\n- Basic latency/memory benchmark notes for deploy target","acceptance_criteria":"Critical branch behavior is test-covered; endpoint exposes actionable timing/log data; baseline latency expectations are documented and reviewed.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T13:10:16.235245-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.979576-08:00","labels":["observability","performance","testing"],"dependencies":[{"issue_id":"g-29c.2.6","depends_on_id":"g-29c.2","type":"parent-child","created_at":"2026-02-06T13:10:16.238378-08:00","created_by":"miguel"},{"issue_id":"g-29c.2.6","depends_on_id":"g-29c.2.2","type":"blocks","created_at":"2026-02-06T13:10:28.333796-08:00","created_by":"miguel"},{"issue_id":"g-29c.2.6","depends_on_id":"g-29c.2.4","type":"blocks","created_at":"2026-02-06T13:10:28.583707-08:00","created_by":"miguel"}]}
{"id":"g-2kyc","title":"Add eval bar","description":"Add a vertical eval bar","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T23:19:46.372583-08:00","created_by":"miguel","updated_at":"2026-02-06T23:19:46.372583-08:00"}
{"id":"g-2qx","title":"[IMPL] Add user Elo over time graph","description":"**Category: Implementation Task (Post-Spec)**\n\n## Requirements\n- Add a time-series graph of the user’s Elo-like rating in the user stats dashboard.\n- Plot rating points from persisted rating history/rating events with timestamped data.\n- Support common ranges (e.g., 7d, 30d, 90d, all-time).\n- Clearly indicate provisional/low-confidence periods (e.g., shading or marker style).\n- Handle sparse data gracefully (empty state and low-game-count messaging).\n- Ensure graph rendering works on desktop and mobile layouts.","acceptance_criteria":"1) Stats dashboard includes an Elo-over-time graph fed by stored rating history. 2) Graph supports at least 7d/30d/90d/all-time filters. 3) Provisional/low-confidence rating periods are visually distinguishable. 4) Empty-state UX is shown when insufficient rating data exists. 5) Add tests for data transformation/filtering and API response shape for graph input.","status":"open","priority":4,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-05T14:01:56.44262-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.103663-08:00","dependencies":[{"issue_id":"g-2qx","depends_on_id":"g-9zt","type":"blocks","created_at":"2026-02-05T14:02:15.854153-08:00","created_by":"miguel"},{"issue_id":"g-2qx","depends_on_id":"g-d44p","type":"blocks","created_at":"2026-02-07T15:01:39.148147-08:00","created_by":"miguel"}]}
{"id":"g-2tl","title":"Backend: POST /blunder endpoint","description":"Implement POST /blunder to accept PGN/FEN/move, parse with python-chess, and insert into blunders table.","notes":"SPEC update: blunder insertion must respect session.player_color. Record blunder only when it's user's turn; store positions.active_color on insert.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:34:43.811446-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.030519-08:00","closed_at":"2026-02-05T12:23:28.289933-08:00","close_reason":"Already fully implemented in backend/app/api/blunder.py","dependencies":[{"issue_id":"g-2tl","depends_on_id":"g-hhh.1","type":"blocks","created_at":"2026-02-02T20:35:40.649108-08:00","created_by":"miguel"},{"issue_id":"g-2tl","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:35:43.469115-08:00","created_by":"miguel"}]}
{"id":"g-2wb","title":"Backend: POST /api/game/start endpoint","description":"Create new game session with engine_elo. Return session_id. Require auth.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:52.94155-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.844266-08:00","closed_at":"2026-02-02T16:35:56.876697-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-2wb","depends_on_id":"g-om9","type":"blocks","created_at":"2026-02-02T14:01:39.771514-08:00","created_by":"miguel"},{"issue_id":"g-2wb","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:32.095735-08:00","created_by":"miguel"}]}
{"id":"g-33c","title":"Backend: POST /api/blunder endpoint - parse PGN and build graph","description":"Accept session_id, pgn, fen, user_move, best_move, evals. Replay PGN to get all positions. Verify pre-move FEN matches. Upsert positions, moves, blunder. Check blunder_recorded flag.","notes":"SPEC update: ensure positions.active_color stored for each position; only record blunder when side-to-move matches session.player_color.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:14.46538-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.938489-08:00","closed_at":"2026-02-03T00:16:53.170866-08:00","close_reason":"Implemented POST /api/blunder endpoint with PGN replay, position/move graph upserts, FEN validation, player color check, and blunder_recorded flag handling. Added 13 comprehensive tests.","dependencies":[{"issue_id":"g-33c","depends_on_id":"g-8fl","type":"blocks","created_at":"2026-02-02T14:01:52.102539-08:00","created_by":"miguel"},{"issue_id":"g-33c","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:51.398132-08:00","created_by":"miguel"},{"issue_id":"g-33c","depends_on_id":"g-hhh.1","type":"blocks","created_at":"2026-02-02T20:35:46.90721-08:00","created_by":"miguel"},{"issue_id":"g-33c","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:35:49.451063-08:00","created_by":"miguel"}]}
{"id":"g-3ax","title":"DB: Create blunders table migration","description":"Migration for blunders: id, user_id, position_id, bad_move_san, best_move_san, eval_loss_cp, pass_streak, last_reviewed_at, created_at. Unique (user_id, position_id).","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:13.971251-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.94137-08:00","closed_at":"2026-02-02T14:29:51.738756-08:00","close_reason":"Already implemented in initial scaffolding","dependencies":[{"issue_id":"g-3ax","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:50.922576-08:00","created_by":"miguel"}]}
{"id":"g-3bw","title":"Frontend new game/reset forces board orientation to White","description":"Board orientation is reset to 'white' on new game and reset, which assumes user is White. Should derive from player_color. Locations: src/components/ChessGame.tsx:251-254 and src/components/ChessGame.tsx:280-284.","status":"closed","priority":3,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-02T20:41:55.222653-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.061689-08:00","closed_at":"2026-02-03T02:26:35.02668-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-3bw","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:42:27.293877-08:00","created_by":"miguel"},{"issue_id":"g-3bw","depends_on_id":"g-hhh.3","type":"blocks","created_at":"2026-02-02T20:42:46.283147-08:00","created_by":"miguel"}]}
{"id":"g-3c0","title":"Frontend: Add offer draw button","description":"Add an 'Offer draw' button to the game controls. Calls /api/game/end with result 'draw'. Button should be disabled when no game is active or when game is over. Split from ghostreplay-znp.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T18:10:03.214848-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.998171-08:00"}
{"id":"g-3g2","title":"Frontend: Handle mate score conversion (±9990cp)","description":"Parse 'score mate N' from Stockfish. Convert to centipawns: MATE_BASE (10000) - abs(N) * MATE_DECAY (10). Use for threshold comparison.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:15.447139-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.933648-08:00","closed_at":"2026-02-03T00:38:11.0756-08:00","close_reason":"Already implemented in analysisWorker.ts:90-95 mateToCp()","dependencies":[{"issue_id":"g-3g2","depends_on_id":"g-jp0","type":"blocks","created_at":"2026-02-02T14:01:53.046687-08:00","created_by":"miguel"},{"issue_id":"g-3g2","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:52.419131-08:00","created_by":"miguel"}]}
{"id":"g-3lc","title":"Epic: Production deployment setup","notes":"Polish: Containerization, DB migrations, environment config, hosting setup.","status":"open","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:21.884073-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.0931-08:00"}
{"id":"g-3qbb","title":"rename blunders to ghost move library","description":"change the spec","status":"in_progress","priority":2,"issue_type":"task","assignee":"miguel","owner":"unroar@gmail.com","created_at":"2026-02-06T17:30:38.831475-08:00","created_by":"miguel","updated_at":"2026-02-07T14:25:04.442905-08:00"}
{"id":"g-49g","title":"Backend: GET /api/game/ghost-move endpoint","description":"Implement dumb ghost-move lookup: query blunders by FEN; if exists, return any connected blunder move. Skip scent logic (CTEs/priority scoring).","notes":"SPEC update: support player_color (user can be White or Black). Ghost-move must scope blunders to session.player_color by filtering positions.active_color and using session_id.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:37:13.23898-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.026895-08:00","closed_at":"2026-02-03T17:12:40.154125-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-49g","depends_on_id":"g-hhh.1","type":"blocks","created_at":"2026-02-02T20:35:20.233978-08:00","created_by":"miguel"},{"issue_id":"g-49g","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:35:23.36089-08:00","created_by":"miguel"},{"issue_id":"g-49g","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-03T03:06:45.44621-08:00","created_by":"miguel"}]}
{"id":"g-4ap","title":"[SPEC] Define FEN normalization for position hashing","description":"**Category: SPEC.md Update Required**\n\nSchema uses 'SHA256 of Normalized FEN' but doesn't define normalization.\n\n## FEN Fields\n`rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1`\n\n1. Piece placement ✓\n2. Active color ✓\n3. Castling rights ✓\n4. En passant square ✓\n5. Halfmove clock (for 50-move rule)\n6. Fullmove number\n\n## Proposed SPEC.md Addition\n\n### Section 5.1.1: FEN Normalization\nNormalized FEN = fields 1-4 only (piece placement, active color, castling, en passant).\n\nFields 5-6 (move clocks) are stripped because:\n- Same position via different move order should match\n- Irrelevant for blunder identification\n\n```python\ndef normalize_fen(fen: str) -\u003e str:\n    parts = fen.split(' ')\n    return ' '.join(parts[:4])\n```\n\n## Decision Needed\n- Keep en passant square? (Only relevant immediately after pawn push)\n- Any edge cases to consider?","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:44.468507-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.045668-08:00","closed_at":"2026-02-01T21:55:39.893482-08:00","close_reason":"Added Section 5.1.1 FEN Normalization - fields 1-4 kept (including en passant for tactical significance), fields 5-6 stripped"}
{"id":"g-4kk","title":"Display opening name during live game","description":"Epic: Show the current opening name while a game is in progress. Decisions: use a full ECO opening book; opening detection should be transposition-aware (position/FEN based); display only for the live position (not historical move view). Deliverable: live UI shows opening name (and optional ECO code) during active games with stable naming across transpositions.","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-05T13:29:57.150803-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.990931-08:00","closed_at":"2026-02-06T17:49:34.035567-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-4kk","depends_on_id":"g-xc3","type":"blocks","created_at":"2026-02-05T13:30:45.879166-08:00","created_by":"miguel"},{"issue_id":"g-4kk","depends_on_id":"g-yfh","type":"blocks","created_at":"2026-02-05T13:30:48.409796-08:00","created_by":"miguel"},{"issue_id":"g-4kk","depends_on_id":"g-dyw","type":"blocks","created_at":"2026-02-05T13:30:51.453229-08:00","created_by":"miguel"},{"issue_id":"g-4kk","depends_on_id":"g-dp2","type":"blocks","created_at":"2026-02-05T13:30:54.28004-08:00","created_by":"miguel"}]}
{"id":"g-4mo","title":"Frontend: Build login page UI (optional, cross-device)","description":"Form with username/password fields. Call /api/auth/login. Store token. Redirect to dashboard on success.","notes":"Optional login page for users on new devices.\n\nSimple form:\n- Username field\n- Password field\n- Login button\n\nMost users won't need this - they'll auto-login from localStorage.\n\nThis is mainly for:\n- Accessing account from different device\n- After clearing browser data","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:37.623449-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.84888-08:00","closed_at":"2026-02-05T17:35:27.367785-08:00","close_reason":"Implemented together: shared AuthForm component with register/login modes, React Router, nav bar, claimAccount backend wiring","dependencies":[{"issue_id":"g-4mo","depends_on_id":"g-7kb","type":"blocks","created_at":"2026-02-02T14:01:31.061389-08:00","created_by":"miguel"},{"issue_id":"g-4mo","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:22.971293-08:00","created_by":"miguel"}]}
{"id":"g-4p7","title":"Backend: Add position lookup optimization","description":"Add index on positions(user_id, fen_hash). Consider query plan for recursive CTE. Document expected query time \u003c 100ms for graphs with 10k positions.","notes":"SPEC update: position lookup optimization should support filtering by active_color for player_color-scoped ghost queries.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:32.159223-08:00","created_by":"miguel","updated_at":"2026-02-06T22:13:14.633976-08:00","closed_at":"2026-02-06T22:13:14.633976-08:00","close_reason":"Added migration to optimize indexes (drop redundant idx_positions_fen_hash and low-selectivity idx_positions_active_color, add composite idx_positions_user_active_color and idx_blunders_position_user). Updated models.py. Added 10k-position benchmark test.","dependencies":[{"issue_id":"g-4p7","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:06.945169-08:00","created_by":"miguel"}]}
{"id":"g-4r3","title":"Frontend: Add post-game prompt routing to unified History+Analysis page","description":"After game ends, show modal with buttons: [View Analysis], [New Game], [History]. Both [View Analysis] and [History] navigate to the combined History+Analysis route. On [View Analysis], the latest completed game must be pre-selected in the history list so its analysis is shown immediately.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:19.67371-08:00","created_by":"miguel","updated_at":"2026-02-07T14:53:24.661597-08:00","closed_at":"2026-02-07T14:53:24.661597-08:00","close_reason":"Post-game prompt routing wired to /history placeholder page","dependencies":[{"issue_id":"g-4r3","depends_on_id":"g-kzb","type":"blocks","created_at":"2026-02-02T14:02:34.920107-08:00","created_by":"miguel"},{"issue_id":"g-4r3","depends_on_id":"g-817","type":"parent-child","created_at":"2026-02-02T14:06:34.221557-08:00","created_by":"miguel"},{"issue_id":"g-4r3","depends_on_id":"g-05i","type":"blocks","created_at":"2026-02-07T04:31:33.648656-08:00","created_by":"miguel"}]}
{"id":"g-4w1","title":"Define testing strategy","description":"No testing approach is mentioned in the spec.\n\n## Testing Pyramid\n\n### Unit Tests\n**Frontend:**\n- Chess logic utilities (FEN normalization, move validation)\n- SRS algorithm calculations\n- State store reducers\n- Component logic (not rendering)\n\n**Backend:**\n- Graph traversal algorithms\n- SRS update logic\n- FEN hashing/normalization\n- API input validation\n\n### Integration Tests\n**Frontend:**\n- Component rendering with mocked stores\n- Form submissions\n- Worker communication\n\n**Backend:**\n- API endpoint testing\n- Database queries\n- Auth flow\n\n### E2E Tests\n- Full game flow: start -\u003e play -\u003e blunder -\u003e review\n- Ghost mode activation\n- SRS scheduling verification\n\n## Tools\n\n### Frontend\n- **Vitest** - Unit tests (Vite-native, fast)\n- **React Testing Library** - Component tests\n- **Playwright** - E2E tests\n- **MSW** - API mocking\n\n### Backend\n- **pytest** - All Python tests\n- **pytest-asyncio** - Async test support\n- **httpx** - API testing\n- **factory_boy** - Test data factories\n\n## Test Organization\n```\nfrontend/\n  src/\n    utils/\n      fen.ts\n      fen.test.ts\n    components/\n      Board/\n        Board.tsx\n        Board.test.tsx\n  e2e/\n    game-flow.spec.ts\n\nbackend/\n  tests/\n    unit/\n      test_srs.py\n      test_graph.py\n    integration/\n      test_api.py\n    conftest.py\n```\n\n## Coverage Targets\n- Unit tests: 80%+\n- Integration: Key paths covered\n- E2E: Critical user journeys\n\n## CI Integration\n- Run tests on every PR\n- Block merge on failure\n- Coverage reporting","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:46.392465-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.04785-08:00","closed_at":"2026-02-01T17:37:08.704402-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-4wy","title":"[IMPL] Address graph scalability and pruning","description":"**Category: Implementation Task - Future Enhancement**\n\nMonitor before optimizing. May not be needed for MVP scale.\n\n## If Needed\n- Orphan position cleanup job\n- Index optimization\n- Position table partitioning\n- Query performance monitoring","status":"open","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:29.811017-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.105688-08:00"}
{"id":"g-558","title":"Add chessboard gameplay with react-chessboard + chess.js","description":"Install react-chessboard and chess.js, then build a ChessGame component that lets a single user play both sides locally. Use chess.js to drive game state, validate moves, and reject illegal drops. Show lightweight UI chrome (title, turn indicator, reset button) so QA can tell the app is alive. Update README with dependency install instructions plus a short verification checklist.","acceptance_criteria":"- Dependencies react-chessboard and chess.js are added and locked\n- Dropping a piece on the board mirrors real chess: illegal moves snap back, legal moves update state\n- Board orientation can be flipped or rotates automatically so both sides are playable\n- Reset/New Game control wipes history and returns to starting position\n- README documents how to launch the dev server and confirm a legal game can be completed","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T23:43:22.9549-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.039128-08:00","closed_at":"2026-02-02T00:06:49.724931-08:00","close_reason":"Closed","labels":["milestone-1"],"dependencies":[{"issue_id":"g-558","depends_on_id":"g-9fy","type":"parent-child","created_at":"2026-02-01T23:43:40.668944-08:00","created_by":"miguel"}]}
{"id":"g-56u","title":"Backend: Integration tests for /api/blunder graph insertion","description":"Test PGN replay, position deduplication, move edge creation. Verify blunder references pre-move position. Test first-blunder-only rule.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:36.704652-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.088509-08:00","closed_at":"2026-02-03T02:53:55.653465-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-56u","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:22:22.180583-08:00","created_by":"miguel"}]}
{"id":"g-5a8","title":"[IMPL] Add OAuth login (Lichess/Chess.com)","status":"open","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:53:25.627733-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.09517-08:00"}
{"id":"g-5bk","title":"[SPEC] Document complete API endpoint specification","description":"**Category: SPEC.md Update Required**\n\nOnly POST /blunder is mentioned. Need complete API design.\n\n## Proposed SPEC.md Addition\n\n### Section 7: API Specification\n\n#### Authentication\n- POST /api/auth/register - Create account\n- POST /api/auth/login - Get token\n- POST /api/auth/logout - Invalidate token\n\n#### Game Flow\n- POST /api/game/start - Start new game session\n  - Request: { engine_elo: number }\n  - Response: { session_id: uuid }\n\n- GET /api/game/ghost-move - Get ghost's next move\n  - Request: { session_id, fen }\n  - Response: { mode: 'ghost'|'engine', move?: string }\n\n- POST /api/game/end - End game session\n  - Request: { session_id, result }\n\n#### Blunders\n- POST /api/blunder - Record blunder\n  - Request: { session_id, fen, user_move, best_move, eval_delta }\n\n- GET /api/blunders - List user's blunders\n  - Query: ?due=true\u0026limit=50\n\n#### SRS\n- POST /api/srs/review - Record review result\n  - Request: { blunder_id, passed: boolean }\n  - Response: { next_due_date }\n\n## Design Decisions\n- REST vs GraphQL?\n- Pagination strategy?\n- Error response format?","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:59.572547-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.966822-08:00","closed_at":"2026-02-01T19:31:09.187172-08:00","close_reason":"Added complete API specification as Section 9 covering auth, game flow, blunders, and SRS endpoints","dependencies":[{"issue_id":"g-5bk","depends_on_id":"g-j0k","type":"blocks","created_at":"2026-02-01T17:40:52.160473-08:00","created_by":"miguel"}]}
{"id":"g-5f2","title":"Backend: Unit tests for SRS priority calculation","description":"Test pass_streak increments, reset on fail. Verify priority formula with various time/streak combinations. Test edge cases (pass_streak=0, long intervals).","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:36.191669-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.090822-08:00","dependencies":[{"issue_id":"g-5f2","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:22:23.138825-08:00","created_by":"miguel"}]}
{"id":"g-5fm","title":"[IMPL] Add adaptive difficulty based on win rate","description":"**Category: Implementation Task (Post-Spec)**\n\n## Goal\nEstimate and continuously update a **user Elo-like rating** while they play against different bot difficulties, then use that rating to recommend an appropriate next difficulty.\n\n## Requirements\n- Treat each bot difficulty as a rated opponent with a defined rating value (e.g., Elo anchor per level).\n- Maintain a calibration map: `bot_level -\u003e bot_rating` (versioned so updates do not silently rewrite history).\n- After each rated game, update user rating using a documented formula:\n  - Elo baseline: `R_new = R_old + K * (S - E)`\n  - `S` in {1, 0.5, 0}; `E = 1 / (1 + 10^((R_opp - R_user)/400))`\n- Support confidence/provisional handling (preferred: Glicko-style rating deviation or equivalent provisional state).\n- Persist per-user rating state:\n  - current rating\n  - confidence/provisional signal\n  - games counted for rating\n  - last updated time\n- Persist per-game rating event data for audit/recompute:\n  - user pre/post rating\n  - opponent bot level and opponent rating\n  - result (win/loss/draw)\n  - update parameters (K factor or RD inputs)\n  - calibration version\n- Drive adaptive difficulty recommendation from user rating plus confidence guardrails.\n- Preserve manual skill override behavior; adaptation is recommendation/auto-default, not lock-in.\n\n## Notes\n- Initial bot ratings can be seeded, then recalibrated from aggregate outcomes.\n- If calibration changes, apply the new mapping only to new games (or run explicit backfill migration with versioning).\n","acceptance_criteria":"1) System computes a user rating after each rated bot game using documented Elo/Glicko-style math. 2) Bot difficulty levels are mapped to explicit opponent ratings, and the mapping is versioned/calibratable. 3) User profile stores current rating and confidence (e.g., rating deviation / provisional flag). 4) Match records include enough data to recompute ratings offline (pre/post rating, opponent rating, K/RD inputs, result, timestamp). 5) Adaptive next-difficulty recommendation is derived from user rating and confidence, but users can still manually override difficulty. 6) Add tests covering rating updates across win/loss/draw and across multiple bot levels.","status":"open","priority":4,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-05T13:51:07.840384-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.104658-08:00","dependencies":[{"issue_id":"g-5fm","depends_on_id":"g-vmu","type":"blocks","created_at":"2026-02-05T13:51:10.954668-08:00","created_by":"miguel"}]}
{"id":"g-5gm","title":"Backend start-game endpoint lacks player_color persistence","description":"GameStartRequest/Response and GameSession model have no player_color, so backend cannot record which side user plays. Locations: backend/app/api/game.py:25-73, backend/app/models.py:66-82.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-02T20:42:04.605131-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.992115-08:00","closed_at":"2026-02-03T01:34:28.219734-08:00","close_reason":"Added player_color to GameStartResponse and updated tests to verify it's returned","dependencies":[{"issue_id":"g-5gm","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:42:29.506612-08:00","created_by":"miguel"},{"issue_id":"g-5gm","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:42:52.264953-08:00","created_by":"miguel"},{"issue_id":"g-5gm","depends_on_id":"g-hhh.2","type":"blocks","created_at":"2026-02-02T20:42:55.085525-08:00","created_by":"miguel"}]}
{"id":"g-5vd","title":"[SPEC] Define acceptable move criteria for SRS pass","description":"**Category: SPEC.md Update Required**\n\nSection 2.3 says 'engine's top move (or a specific safe alternative)' without defining what's acceptable.\n\n## Problem\nMultiple moves might be nearly equal. Should all count as 'passing'?\n\n## Options\n\n1. **Exact match only** - Only best move = pass\n2. **Eval threshold** - Any move within 30cp of best = pass  \n3. **Top N moves** - Any of top 3 engine moves = pass\n\n## Proposed SPEC.md Addition\n\n### Section 6.3.2: Pass Criteria\nA review is marked PASS if the user plays a move that:\n- Is the engine's #1 move, OR\n- Evaluates within [THRESHOLD] centipawns of the best move\n\nDefault threshold: 30cp (configurable)\n\n## Decision Needed\n- Which approach for MVP?\n- Should threshold vary by position type (tactical vs quiet)?","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:38.494642-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.046864-08:00","closed_at":"2026-02-01T21:54:27.460922-08:00","close_reason":"Updated SPEC.md with explicit thresholds: 50cp for SRS pass, 150cp for blunder detection"}
{"id":"g-608","title":"DevOps: Setup database backups","description":"Automated daily backups of PostgreSQL. Retention policy (keep 7 days). Document restore procedure.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:50.914128-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.062829-08:00","dependencies":[{"issue_id":"g-608","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:01.72639-08:00","created_by":"miguel"}]}
{"id":"g-6dj","title":"E2E: Test full game → blunder → ghost → SRS flow","description":"Register → play game → make blunder → see it recorded → new game → ghost steers back → pass/fail → verify SRS update.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:38.208687-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.081235-08:00","dependencies":[{"issue_id":"g-6dj","depends_on_id":"g-e9x","type":"blocks","created_at":"2026-02-02T14:22:40.175182-08:00","created_by":"miguel"},{"issue_id":"g-6dj","depends_on_id":"g-14w","type":"blocks","created_at":"2026-02-02T14:22:40.417335-08:00","created_by":"miguel"}]}
{"id":"g-6p1","title":"Set up FastAPI app skeleton","description":"Initialize FastAPI project structure, app entrypoint, and basic health route. Ensure configuration supports Postgres connection via env vars.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:28:54.853033-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.034655-08:00","closed_at":"2026-02-02T01:49:34.240023-08:00","close_reason":"Closed"}
{"id":"g-6qu","title":"DevOps: Setup docker-compose for local development","description":"Services: postgres, backend, frontend. Volume mounts for hot reload. Environment variable configuration.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:49.87966-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.076229-08:00","dependencies":[{"issue_id":"g-6qu","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:00.592442-08:00","created_by":"miguel"}]}
{"id":"g-72b","title":"Display cute ghost icon when in ghost mode","description":"Show a cute ghost icon or image in the UI when the user is in ghost mode to provide visual feedback.","status":"closed","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-06T01:23:16.503184-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.059319-08:00","closed_at":"2026-02-06T14:27:31.97906-08:00","close_reason":"Closed"}
{"id":"g-762","title":"Implement Worker B (Analyst)","description":"Create a second Web Worker that calculates evaluation delta between user's move and engine best move. Logic: if delta \u003e= 150cp, trigger a log to the console.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:31:16.231444-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.031688-08:00","closed_at":"2026-02-02T11:56:17.124784-08:00","close_reason":"Closed"}
{"id":"g-766","title":"Backend: POST /api/srs/review endpoint","description":"Accept session_id, blunder_id, passed, user_move, eval_delta. Insert into blunder_reviews. Update blunders: increment/reset pass_streak, set last_reviewed_at. Return updated priority.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:47.015777-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.922367-08:00","dependencies":[{"issue_id":"g-766","depends_on_id":"g-0id","type":"blocks","created_at":"2026-02-02T14:02:12.660405-08:00","created_by":"miguel"},{"issue_id":"g-766","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:14.961469-08:00","created_by":"miguel"}]}
{"id":"g-7c9","title":"DevOps: Setup environment variable configuration","description":"Document required env vars: DATABASE_URL, JWT_SECRET, CORS_ORIGINS. Create .env.example. Use dotenv for local dev.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:50.411528-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.064954-08:00","dependencies":[{"issue_id":"g-7c9","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:01.175186-08:00","created_by":"miguel"}]}
{"id":"g-7gl","title":"Epic: Post-game analysis view","notes":"Route decision sync (2026-02-07): analysis UI is rendered inside the unified History+Analysis page (shared route with history list), not a standalone analysis route. Analysis components in this epic should be embeddable in that page's selected-game pane and reusable for post-game entry.","status":"open","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:17.974026-08:00","created_by":"miguel","updated_at":"2026-02-07T04:31:12.715752-08:00","dependencies":[{"issue_id":"g-7gl","depends_on_id":"g-pk5","type":"blocks","created_at":"2026-02-02T14:01:08.812965-08:00","created_by":"miguel"}]}
{"id":"g-7kb","title":"Frontend: Create auth context with localStorage credentials","description":"React context for auth state. Store JWT in localStorage. Provide login/logout/register functions.","notes":"Auth context manages authentication state with localStorage-first approach.\n\nOn app load:\n1. Check localStorage for credentials\n2. If found, auto-login (call /api/auth/login)\n3. If not found, generate random credentials and register\n4. Store credentials in localStorage\n5. Store JWT token\n\nProvides:\n- Current user state\n- Login/logout functions\n- Account claim function","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:37.124889-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.853458-08:00","closed_at":"2026-02-02T22:02:01.764147-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-7kb","depends_on_id":"g-i37","type":"blocks","created_at":"2026-02-02T14:01:30.313268-08:00","created_by":"miguel"},{"issue_id":"g-7kb","depends_on_id":"g-82z","type":"blocks","created_at":"2026-02-02T14:01:30.567356-08:00","created_by":"miguel"},{"issue_id":"g-7kb","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:22.522483-08:00","created_by":"miguel"}]}
{"id":"g-7ov","title":"Frontend: Show fail feedback and pause game","description":"On fail: pause game, show modal 'You made this mistake again\\!'. Display position, bad move, best move. Button to continue game.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:47.75212-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.918394-08:00","dependencies":[{"issue_id":"g-7ov","depends_on_id":"g-1pl","type":"blocks","created_at":"2026-02-02T14:02:13.609958-08:00","created_by":"miguel"},{"issue_id":"g-7ov","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:15.688962-08:00","created_by":"miguel"}]}
{"id":"g-7u7","title":"Frontend: Configure Stockfish search parameters per spec 6.4.1","description":"analysisWorker.ts currently uses 'go movetime 1200'. Update to match spec 6.4.1:\n\n1. Set MultiPV: worker.postMessage('setoption name MultiPV value 1')\n2. Use depth+movetime: worker.postMessage('go depth 18 movetime 2000')\n\nStopping condition: Search terminates when EITHER depth 18 is reached OR 2000ms elapsed, whichever comes first.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-03T00:43:14.706498-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.893871-08:00","closed_at":"2026-02-03T00:52:57.565338-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-7u7","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-03T00:43:18.840068-08:00","created_by":"miguel"}]}
{"id":"g-7w1","title":"[IMPL] Define testing strategy","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until SPEC.md is finalized.\n\n## Approach\n- Unit: Vitest (frontend), pytest (backend)\n- Integration: React Testing Library, httpx\n- E2E: Playwright\n\n## Key Test Cases\n- SRS algorithm calculations\n- Graph traversal queries\n- Ghost mode transitions\n- Blunder detection accuracy","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:14.178531-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.097288-08:00","closed_at":"2026-02-02T01:21:57.17122-08:00","close_reason":"Closed"}
{"id":"g-816","title":"Display move analysis annotations in MoveList","description":"Add visual indicators (yellow, red, green) and chess annotations (?, !, etc.) next to each move in the MoveList component to reflect the analysis results.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T01:21:00.03855-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.984626-08:00","closed_at":"2026-02-06T12:09:04.356559-08:00","close_reason":"Added move analysis annotations with color-coded evals in MoveList. Per-move analysis accumulated in useMoveAnalysis hook for reuse by other features."}
{"id":"g-817","title":"Epic: Game history browser","notes":"UX decision (2026-02-07): Use one combined History + Analysis page (single route). Left side: game history list. Right side: analysis for selected game. Post-game CTA should navigate to this page with the latest completed game pre-selected.","status":"open","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:19.626925-08:00","created_by":"miguel","updated_at":"2026-02-07T04:30:58.088156-08:00","dependencies":[{"issue_id":"g-817","depends_on_id":"g-pk5","type":"blocks","created_at":"2026-02-02T14:01:09.055195-08:00","created_by":"miguel"}]}
{"id":"g-82o","title":"DevOps: Create Dockerfile for React frontend","description":"Build static assets with Vite. Use nginx to serve. Configure API proxy to backend.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:49.623844-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.078332-08:00","dependencies":[{"issue_id":"g-82o","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:00.295569-08:00","created_by":"miguel"}]}
{"id":"g-82z","title":"Backend: POST /api/auth/login endpoint (optional, cross-device)","description":"Validate credentials, check password hash, return JWT. Return 401 on invalid credentials.","notes":"Optional login endpoint for users accessing from new devices.\n\nRequest:\n- username\n- password\n\nReturns JWT token if credentials valid.\n\nNote: Most users won't use this - they'll auto-login from localStorage credentials.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:36.875526-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.855977-08:00","closed_at":"2026-02-02T21:08:09.582322-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-82z","depends_on_id":"g-m8t","type":"blocks","created_at":"2026-02-02T14:01:29.832616-08:00","created_by":"miguel"},{"issue_id":"g-82z","depends_on_id":"g-0vl","type":"blocks","created_at":"2026-02-02T14:01:30.071031-08:00","created_by":"miguel"},{"issue_id":"g-82z","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:22.295662-08:00","created_by":"miguel"}]}
{"id":"g-85q","title":"Epic: Testing coverage for critical paths","notes":"Polish: Unit + integration tests for SRS math, ghost logic, blunder detection, graph traversal.","status":"closed","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:20.918969-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.094232-08:00","closed_at":"2026-02-02T14:22:50.7317-08:00","close_reason":"Tests distributed into feature epics, not a separate phase"}
{"id":"g-86k","title":"Choose and document SRS algorithm (SM-2 vs Leitner)","description":"The spec mentions 'modified SM-2 or Leitner system' but doesn't specify which one will be used.\n\n## Algorithm Comparison\n\n### SM-2 (SuperMemo 2)\nUsed by Anki. More sophisticated.\n\n```python\n# After each review:\nif quality \u003e= 3:  # Pass\n    if repetitions == 0:\n        interval = 1\n    elif repetitions == 1:\n        interval = 6\n    else:\n        interval = round(interval * ease_factor)\n    repetitions += 1\n    ease_factor = ease_factor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))\nelse:  # Fail\n    repetitions = 0\n    interval = 1\n\n# ease_factor minimum = 1.3\n```\n\n- Pros: Adapts to item difficulty, well-researched\n- Cons: More complex, ease factor can spiral down\n\n### Leitner System\nSimpler box-based system.\n\n```python\nboxes = [1, 3, 7, 14, 30]  # days\n\nif pass:\n    box = min(box + 1, len(boxes) - 1)\nelse:\n    box = 0\n\ninterval = boxes[box]\n```\n\n- Pros: Simple, predictable\n- Cons: Less adaptive to individual items\n\n### FSRS (Free Spaced Repetition Scheduler)\nNewer algorithm, used by recent Anki versions.\n- Pros: More accurate predictions\n- Cons: More complex, less battle-tested\n\n## Recommendation\n**SM-2 for MVP** with these modifications:\n- Binary quality (pass=4, fail=1) instead of 0-5 scale\n- Minimum ease factor = 1.5 (prevent death spiral)\n- Cap interval at 180 days\n\n## Implementation\n```python\ndef update_srs(blunder: Blunder, passed: bool) -\u003e Blunder:\n    quality = 4 if passed else 1\n    \n    if quality \u003e= 3:\n        if blunder.repetitions == 0:\n            blunder.interval = 1\n        elif blunder.repetitions == 1:\n            blunder.interval = 6\n        else:\n            blunder.interval = min(round(blunder.interval * blunder.ease_factor), 180)\n        blunder.repetitions += 1\n        blunder.ease_factor = max(1.5, blunder.ease_factor + 0.1)\n    else:\n        blunder.repetitions = 0\n        blunder.interval = 1\n        blunder.ease_factor = max(1.5, blunder.ease_factor - 0.2)\n    \n    blunder.due_date = now() + timedelta(days=blunder.interval)\n    return blunder\n```","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:06.800059-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.051077-08:00","closed_at":"2026-02-01T17:37:08.688015-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-8c1","title":"DB: Create users table migration with anonymous support","description":"Create migration for users table with id, username, password_hash, created_at. Add unique constraint on username.","notes":"Users table needs to support both anonymous and claimed accounts.\n\nFields:\n- id (primary key)\n- username (unique)\n- password_hash\n- is_anonymous (boolean, default true)\n- created_at\n- updated_at\n\nAnonymous users can later be upgraded to claimed accounts.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:35.876105-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.865954-08:00","closed_at":"2026-02-02T17:58:42.935957-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-8c1","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:21.4434-08:00","created_by":"miguel"}]}
{"id":"g-8fl","title":"Backend: Implement FEN normalization and hashing","description":"normalize_fen(): strip move clocks, canonicalize EP square. fen_hash(): SHA256 of normalized FEN. Use python-chess for EP validation.","notes":"SPEC update: expose active_color (side-to-move) from FEN for positions.active_color field when hashing/inserting positions.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:14.216793-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.939961-08:00","closed_at":"2026-02-02T23:57:26.440838-08:00","close_reason":"Implemented normalize_fen(), fen_hash(), and active_color() in backend/app/fen.py with 13 tests","dependencies":[{"issue_id":"g-8fl","depends_on_id":"g-pqh","type":"blocks","created_at":"2026-02-02T14:01:51.325328-08:00","created_by":"miguel"},{"issue_id":"g-8fl","depends_on_id":"g-lr0","type":"blocks","created_at":"2026-02-02T14:01:51.565857-08:00","created_by":"miguel"},{"issue_id":"g-8fl","depends_on_id":"g-3ax","type":"blocks","created_at":"2026-02-02T14:01:51.840273-08:00","created_by":"miguel"},{"issue_id":"g-8fl","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:51.162114-08:00","created_by":"miguel"}]}
{"id":"g-8kof","title":"Re-show blunder alert with arrows when clicking blunder in MoveList","description":"When a user clicks on a move flagged as a blunder in the MoveList component, re-display the blunder alert toast and draw the blunder arrows on the board (showing the player's move vs the best move). This lets users revisit blunder feedback without replaying the entire game.","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-07T18:03:08.422684-08:00","created_by":"miguel","updated_at":"2026-02-07T18:06:58.926627-08:00","closed_at":"2026-02-07T18:06:58.926627-08:00","close_reason":"Recreating with proper custom ID per AGENTS.md"}
{"id":"g-92r","title":"Frontend: Implement legal move highlights","description":"Show legal move highlights when clicking a piece using react-chessboard's onSquareClick and customSquareStyles options.\n\nFeatures:\n- Clicking a piece shows legal move destinations as dots\n- Capture squares highlighted in red tint\n- Selected piece square highlighted in yellow\n- Highlights clear after move or clicking empty square","notes":"Sample implementation:\n\n```jsx\nimport { useState } from \"react\";\nimport { Chess } from \"chess.js\";\nimport { Chessboard } from \"react-chessboard\";\n\nexport default function MoveGuideBoard() {\n  const [game, setGame] = useState(new Chess());\n  const [optionSquares, setOptionSquares] = useState({});\n\n  function getMoveOptions(square) {\n    const moves = game.moves({\n      square,\n      verbose: true,\n    });\n\n    if (moves.length === 0) {\n      setOptionSquares({});\n      return false;\n    }\n\n    const newSquares = {};\n    moves.map((move) =\u003e {\n      newSquares[move.to] = {\n        background:\n          game.get(move.to) \u0026\u0026 game.get(move.to).color !== game.get(square).color\n            ? \"rgba(255, 0, 0, 0.4)\" // Red tint for captures\n            : \"radial-gradient(circle, rgba(0,0,0,.1) 25%, transparent 25%)\", // Dot for empty squares\n        borderRadius: \"50%\",\n      };\n      return move;\n    });\n\n    newSquares[square] = {\n      background: \"rgba(255, 255, 0, 0.4)\",\n    };\n\n    setOptionSquares(newSquares);\n    return true;\n  }\n\n  function onSquareClick(square) {\n    const hasOptions = getMoveOptions(square);\n    if (!hasOptions) setOptionSquares({});\n  }\n\n  function onPieceDrop(sourceSquare, targetSquare) {\n    const move = game.move({\n      from: sourceSquare,\n      to: targetSquare,\n      promotion: \"q\",\n    });\n\n    if (move === null) return false;\n\n    setGame(new Chess(game.fen()));\n    setOptionSquares({});\n    return true;\n  }\n\n  return (\n    \u003cdiv style={{ width: \"400px\" }}\u003e\n      \u003cChessboard\n        position={game.fen()}\n        onSquareClick={onSquareClick}\n        onPieceDrop={onPieceDrop}\n        customSquareStyles={{\n          ...optionSquares,\n        }}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```","status":"open","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T19:44:08.747615-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.996405-08:00"}
{"id":"g-9fx","title":"Epic: Scaffold Backend","description":"Scaffold backend: FastAPI + PostgreSQL with positions and blunders tables. Hardcode user_id=1 and skip auth/registration for now. Track sub-tasks under this epic.","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T01:28:10.495896-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.035677-08:00","closed_at":"2026-02-02T14:28:41.957393-08:00","close_reason":"Basic scaffolding already completed","dependencies":[{"issue_id":"g-9fx","depends_on_id":"g-6p1","type":"blocks","created_at":"2026-02-02T01:29:35.340386-08:00","created_by":"miguel"},{"issue_id":"g-9fx","depends_on_id":"g-hae","type":"blocks","created_at":"2026-02-02T01:29:48.500884-08:00","created_by":"miguel"},{"issue_id":"g-9fx","depends_on_id":"g-1wk","type":"blocks","created_at":"2026-02-02T01:30:01.072866-08:00","created_by":"miguel"}]}
{"id":"g-9fy","title":"Milestone 1: Self-play chessboard","description":"Track the first app milestone described in SPEC.md: prove the Ghost Replay UI stack is wired up by delivering a browser experience where a user can play a legal chess game against themselves. This milestone covers bootstrapping the React+Vite workspace plus wiring react-chessboard with chess.js so the board enforces legal moves. This epic coordinates that scope and stays open until a user can move pieces end-to-end on localhost.","acceptance_criteria":"- All Milestone 1 child tasks are complete and verified\n- `npm run dev` renders a chessboard backed by chess.js where both sides can play legal moves\n- README documents how to run and verify the experience\n- Demo clip or screenshots captured in issue notes for future reference","status":"closed","priority":1,"issue_type":"epic","owner":"unroar@gmail.com","created_at":"2026-02-01T23:43:12.021249-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.963484-08:00","closed_at":"2026-02-02T00:29:45.62223-08:00","close_reason":"Milestone 1 complete: chess game is fully functional with legal move validation, README documents usage, and all child tasks are closed. Demo clips/screenshots waived for this epic.","labels":["milestone-1"]}
{"id":"g-9gy","title":"[SPEC] Define game history view","description":"## Overview\nUsers need a way to view their past games and access the analysis for any completed game.\n\n## Entry Points\n- From dashboard/main menu\n- After completing a game (\"View History\" option)\n\n## Key Features\n- List of completed games with metadata (date, result, opponent Elo, blunders count)\n- Sortable/filterable by date, result, etc.\n- Click any game to open the analysis view (Section 10)\n\n## Questions to Answer\n- Pagination strategy for users with many games\n- What summary stats to show in the list view\n- Filter options (by date range, result, number of blunders)\n\n## Dependencies\n- Requires after-game analysis display (ghostreplay-d2d)","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T22:03:27.461469-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.041675-08:00","closed_at":"2026-02-01T22:11:30.729821-08:00","close_reason":"Added Section 11 to SPEC.md defining game history view with entry points, screen layout, game card data, interaction flow, API endpoint, and empty state. Kept MVP-simple: no sorting/filtering/pagination.","dependencies":[{"issue_id":"g-9gy","depends_on_id":"g-d2d","type":"blocks","created_at":"2026-02-01T22:03:33.794086-08:00","created_by":"miguel"}]}
{"id":"g-9lf","title":"Frontend checkmate result assumes user is White","description":"ChessGame handleGameEnd assumes user plays White when mapping checkmate to win/loss (chess.turn()==\"w\" =\u003e user lost). Needs to use player_color instead. Location: src/components/ChessGame.tsx:48-60.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-02T20:41:41.958103-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.994283-08:00","closed_at":"2026-02-03T02:25:07.210236-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-9lf","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:42:20.665287-08:00","created_by":"miguel"},{"issue_id":"g-9lf","depends_on_id":"g-hhh.3","type":"blocks","created_at":"2026-02-02T20:42:38.025144-08:00","created_by":"miguel"},{"issue_id":"g-9lf","depends_on_id":"g-hhh.2","type":"blocks","created_at":"2026-02-02T20:42:40.675436-08:00","created_by":"miguel"}]}
{"id":"g-9sp","title":"Frontend: Build position analysis panel","description":"Show: best move + eval, played move + eval, eval delta, classification. Update when navigating through moves.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:08.661011-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.005159-08:00","dependencies":[{"issue_id":"g-9sp","depends_on_id":"g-vp6","type":"blocks","created_at":"2026-02-02T14:02:24.761356-08:00","created_by":"miguel"},{"issue_id":"g-9sp","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:25.358631-08:00","created_by":"miguel"}]}
{"id":"g-9tw","title":"Frontend: Detect blunder (≥150cp loss) and call /api/blunder","description":"Calculate delta = eval_before - eval_after. If delta ≥ 150cp and first blunder this session, POST /api/blunder with full PGN up to blunder.","notes":"SPEC update: support user as White or Black. Blunder detection should only trigger on user's moves based on session.player_color.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:15.197657-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.934815-08:00","closed_at":"2026-02-03T01:15:43.22409-08:00","close_reason":"Implemented blunder detection: detects when delta \u003e= 150cp on user's move (first blunder only per session) and POSTs to /api/blunder with PGN up to the blunder move","dependencies":[{"issue_id":"g-9tw","depends_on_id":"g-jp0","type":"blocks","created_at":"2026-02-02T14:01:52.579277-08:00","created_by":"miguel"},{"issue_id":"g-9tw","depends_on_id":"g-33c","type":"blocks","created_at":"2026-02-02T14:01:52.812655-08:00","created_by":"miguel"},{"issue_id":"g-9tw","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:52.172032-08:00","created_by":"miguel"}]}
{"id":"g-9we","title":"Blunder alert","description":"show a big alert when a blunder occurs","design":"## Blunder Alert Design\n\nThree-layer feedback system:\n\n### Layer 1: Board Flash + Shake (visceral)\n- Brief red flash overlay on the chessboard (~300ms)\n- CSS animation: red tint fades in/out over the board wrapper\n- Provides immediate gut-punch feedback\n\n### Layer 2: Board Arrows (spatial)\n- Red arrow on the blundered move (from → to squares)\n- Green/cyan arrow for the best move\n- Uses react-chessboard's customArrows prop\n- Shows WHERE they went wrong and WHERE they should have gone\n\n### Layer 3: Toast Notification (informational)\n- Toast in bottom-right corner, auto-dismisses after ~4s or on click\n- Shows: classification icon, eval delta, played move (with ??), best move (with !)\n- Non-blocking, clean design matching dark theme\n- Example:\n  ⚠️ Blunder (-3.2)\n  You played: Qxd4??\n  Best was: Nf3!","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T17:28:10.131429-08:00","created_by":"miguel","updated_at":"2026-02-07T00:15:37.803117-08:00","closed_at":"2026-02-07T00:15:37.803117-08:00","close_reason":"Implemented three-layer blunder alert: (1) red board flash overlay with 400ms fade animation, (2) red/green arrows on board via react-chessboard arrows prop showing blundered move vs best move, (3) toast notification in bottom-right of board showing eval delta, played move SAN, and best move SAN. Only triggers for player blunders, auto-dismisses after 4s, clears on next move/new game/reset."}
{"id":"g-9zf","title":"Store full path to blunder positions in graph","description":"**Problem:** The spec describes Ghost traversing from the current position to downstream blunders, but the blunder capture logic only stores a single position + edge. Without intermediate positions, the scent query finds no paths.\n\n**Gap identified:**\n- Section 6.2 (Blunder Capture) only inserts the blunder node and one edge\n- POST /api/blunder lacks parent FEN, ply index, or PGN prefix\n- Section 6.1 (Scent Logic) assumes a connected graph from start to blunder\n\n**Impact:** Ghost mode would always return 'engine' because no paths exist.\n\n**Proposed fix:** Store positions incrementally during gameplay (option 2):\n- Add POST /api/position endpoint called after each move\n- Blunder capture then marks an existing node rather than creating isolated one\n- Supports re-hooking (transposition detection) which already needs mid-game position lookups","status":"closed","priority":1,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-01T22:48:57.351426-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.964749-08:00","closed_at":"2026-02-01T22:58:41.038621-08:00","close_reason":"Updated SPEC.md: Section 6.2 now stores full path via PGN replay, Section 9.4 API updated to accept pgn field"}
{"id":"g-9zt","title":"[IMPL] Add user stats dashboard","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until core features working.\n\n## Features\n- Blunders due today / overdue\n- Pass rate over time\n- Blunders by interval (mastered vs learning)\n- Review history\n\n## Depends On\n- User model\n- Blunder schema with SRS fields\n- API endpoints for stats","status":"closed","priority":4,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:18.748254-08:00","created_by":"miguel","updated_at":"2026-02-07T02:03:42.735094-08:00","closed_at":"2026-02-07T02:03:42.735094-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-9zt","depends_on_id":"g-j0k","type":"blocks","created_at":"2026-02-01T17:40:52.548445-08:00","created_by":"miguel"},{"issue_id":"g-9zt","depends_on_id":"g-o5b","type":"blocks","created_at":"2026-02-01T17:40:52.729303-08:00","created_by":"miguel"}]}
{"id":"g-a32","title":"Frontend: Worker A query ghost-move before Stockfish","description":"Modify Worker A flow to call GET /ghost-move before requesting Stockfish move; use API move if present.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:37:26.845432-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.025836-08:00","closed_at":"2026-02-05T12:27:12.252428-08:00","close_reason":"Already fully implemented in src/utils/api.ts, src/hooks/useOpponentMove.ts, and src/components/ChessGame.tsx with full test coverage"}
{"id":"g-a37","title":"Frontend: Add move list component during game","description":"Show moves played up until current position. Features:\n- Clicking a move navigates to that position\n- Keyboard left/right keys navigate moves and select positions\n- \u003c and \u003e buttons for navigation","notes":"If check should add +\nCheckmate should show #","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T19:35:39.427856-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.99724-08:00","closed_at":"2026-02-02T21:24:40.793561-08:00","close_reason":"Implemented MoveList component with move display, click navigation, keyboard left/right navigation, and navigation buttons"}
{"id":"g-a4a","title":"Frontend: Wire game card selection to analysis pane (same route)","description":"Within the unified History+Analysis page, clicking a game card updates selected session_id and loads GET /api/session/:id/analysis into the analysis pane. No separate analysis route.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:19.196332-08:00","created_by":"miguel","updated_at":"2026-02-07T20:35:32.770238-08:00","closed_at":"2026-02-07T20:35:32.770238-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-a4a","depends_on_id":"g-05i","type":"blocks","created_at":"2026-02-02T14:02:34.209896-08:00","created_by":"miguel"},{"issue_id":"g-a4a","depends_on_id":"g-vp6","type":"blocks","created_at":"2026-02-02T14:02:34.444413-08:00","created_by":"miguel"},{"issue_id":"g-a4a","depends_on_id":"g-817","type":"parent-child","created_at":"2026-02-02T14:06:33.6868-08:00","created_by":"miguel"}]}
{"id":"g-a6wi","title":"Add sounds","description":"Sounds for placing pieces, starting the game, end of game","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T22:07:44.530682-08:00","created_by":"miguel","updated_at":"2026-02-06T22:07:44.530682-08:00"}
{"id":"g-abl","title":"[SPEC] Choose and document SRS algorithm","description":"**Category: SPEC.md Update Required**\n\nSection 2.3 mentions 'modified SM-2 or Leitner system' but doesn't specify which.\n\n## Options\n\n### SM-2 (SuperMemo 2)\n- interval = interval * ease_factor\n- ease_factor adjusts per item\n- More adaptive, used by Anki\n\n### Leitner\n- Fixed box intervals: [1, 3, 7, 14, 30] days\n- Simpler, more predictable\n\n## Proposed SPEC.md Addition\n\n### Section 6.3.1: SRS Algorithm (SM-2 Modified)\n```\nOn PASS: interval = max(1, interval * ease_factor), ease_factor += 0.1\nOn FAIL: interval = 1, ease_factor = max(1.5, ease_factor - 0.2)\nInitial: interval=0, ease_factor=2.5\nCap: interval \u003c= 180 days\n```\n\n## Decision Needed\n- SM-2 vs Leitner for MVP?\n- Should pass/fail be binary or graded (easy/good/hard)?\n- Maximum interval cap?","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:33.257533-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.968939-08:00","closed_at":"2026-02-01T18:46:12.927273-08:00","close_reason":"Added probability-based SRS algorithm to SPEC.md with exponential backoff"}
{"id":"g-anoq","title":"Test blocker","status":"closed","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-07T01:07:02.834349-08:00","created_by":"miguel","updated_at":"2026-02-07T01:07:27.539864-08:00","closed_at":"2026-02-07T01:07:27.539864-08:00","close_reason":"test issue, removing","dependencies":[{"issue_id":"g-anoq","depends_on_id":"g-9we","type":"blocks","created_at":"2026-02-07T01:07:08.105975-08:00","created_by":"miguel"}]}
{"id":"g-ax1","title":"DevOps: Choose hosting platform and deploy","description":"Options: Railway, Render, Fly.io, or VPS. Setup PostgreSQL instance. Deploy backend + frontend. Configure domain/SSL.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:50.6636-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.063924-08:00","dependencies":[{"issue_id":"g-ax1","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:01.446138-08:00","created_by":"miguel"}]}
{"id":"g-axp","title":"Backend: Implement recursive CTE for downstream blunders","description":"Recursive query from current position: traverse moves table up to depth 15, track path_history for cycle detection, join blunders table, filter priority \u003e 1.0.","notes":"SPEC update: recursive CTE must join positions + game_sessions and filter to positions.active_color == session.player_color.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:30.860604-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.931156-08:00","closed_at":"2026-02-04T01:54:21.556544-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-axp","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:05.669931-08:00","created_by":"miguel"},{"issue_id":"g-axp","depends_on_id":"g-hhh.1","type":"blocks","created_at":"2026-02-02T20:35:35.138783-08:00","created_by":"miguel"},{"issue_id":"g-axp","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:35:38.038848-08:00","created_by":"miguel"}]}
{"id":"g-bafa","title":"add move to ghost library","description":"Goal\nAllow users to manually add a move from MoveList into the ghost library so Ghost Replay/SRS can practice that decision in future sessions.\n\nDecisions (locked)\n- Add is allowed during active games and ended games.\n- Manual threshold policy: any move can be added (not gated by \u003e=150cp).\n- Duplicate UX: show “already in library”.\n\nDefinition\n- Ghost library = the user-scoped position graph + practice targets that Ghost can route to.\n- It contains both:\n  - auto-identified blunders from engine detection\n  - manually selected moves from MoveList\n\nImplementation plan\n1) Backend API and domain shape\n- Add a dedicated manual-capture endpoint (recommended: POST /api/blunder/manual) rather than reusing POST /api/blunder.\n- Reason: existing /api/blunder enforces first-blunder-per-session via session.blunder_recorded.\n- Reuse shared graph upsert flow: replay PGN prefix, upsert positions and moves, resolve pre-move position, upsert practice target.\n- Validate auth/ownership and player-color turn alignment for selected decision point.\n- Return response that supports duplicate UX explicitly:\n  - blunder_id (or practice target id), position_id, positions_created, is_new\n\n2) Backend model/query behavior\n- Keep per-position uniqueness for target records; duplicate adds should return is_new=false.\n- Ensure manual adds do NOT mutate session.blunder_recorded.\n- Ensure ghost path query includes manual targets naturally (same table/query path) so no separate traversal logic is required.\n\n3) Frontend MoveList UX\n- Add “Add to Ghost Library” action from MoveList entries.\n- Action availability:\n  - enabled during active and ended games\n  - only on player decision moves\n- Provide optimistic/pending state and completion toast/message:\n  - success: “added to library”\n  - duplicate: “already in library”\n  - error: actionable API error\n\n4) Frontend data plumbing\n- Build payload from selected move index:\n  - PGN up to selected move,\n  - pre-move FEN,\n  - selected SAN,\n  - best/eval metadata when available from analysis map.\n- Add api client method for manual capture endpoint.\n- Keep existing automatic blunder flow unchanged.\n\n5) Testing\n- Backend integration tests:\n  - manual add success\n  - duplicate add returns is_new=false\n  - wrong user / missing auth / bad session\n  - wrong-side-to-move rejected\n  - manual add leaves session.blunder_recorded unchanged\n- Frontend tests:\n  - MoveList action visible/disabled correctly\n  - API payload generated from selected move\n  - duplicate path shows “already in library”\n  - action works in active and ended game states\n- Regression: manual-added target is discoverable by ghost-move traversal.\n\n6) Rollout and follow-ups\n- Keep endpoint backward-compatible with current /api/blunder contract.\n- Add telemetry: manual add attempts, success rate, duplicate rate.\n- Document ghost-library semantics and API in SPEC.\n\nAcceptance criteria\n- User can add any eligible move from MoveList during active or ended games.\n- Duplicate add does not create a second record and UI shows “already in library”.\n- Manual-added moves are used by Ghost pathing and can be practiced via SRS rules.\n- Existing auto blunder recording behavior continues to work.\n","notes":"Progress: implemented backend manual capture endpoint (/api/blunder/manual) with shared replay/upsert logic; added frontend MoveList Add-to-Ghost-Library action; added duplicate UX message; added backend/frontend tests and verified with pytest (test_blunder_api.py, test_game_api.py) and vitest (api + ChessGame).","status":"closed","priority":2,"issue_type":"task","assignee":"miguel","owner":"unroar@gmail.com","created_at":"2026-02-06T17:29:37.591522-08:00","created_by":"miguel","updated_at":"2026-02-06T23:59:28.266803-08:00","closed_at":"2026-02-06T23:59:28.266803-08:00","close_reason":"Implemented manual MoveList add-to-ghost-library flow with backend endpoint, frontend wiring, duplicate handling, and regression coverage."}
{"id":"g-bjo","title":"Epic: User authentication (register/login)","notes":"New approach: Anonymous-first authentication\n\nOn first visit:\n- React auto-generates random username/password\n- Credentials stored in localStorage\n- User can immediately use the app without registration\n- Auto-login with generated credentials\n\nAccount claiming (optional):\n- User can later upgrade from anonymous to permanent account\n- Allows choosing custom username and password\n- Preserves all user data and progress\n\nTechnical requirements:\n- Backend accepts anonymous account creation with auto-generated credentials\n- JWT tokens work for both anonymous and claimed accounts\n- Account upgrade endpoint to convert anonymous → claimed\n- Frontend auth context manages localStorage credentials\n- Optional login flow for returning users on new devices","status":"closed","priority":0,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:10.156273-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.870769-08:00","closed_at":"2026-02-05T17:48:29.854214-08:00","close_reason":"All child tasks complete: DB, backend auth endpoints, JWT, frontend auth context, register/login/logout UI"}
{"id":"g-bjo.1","title":"Backend: POST /api/auth/claim endpoint","notes":"Endpoint to upgrade anonymous account to claimed account.\n\nRequest:\n- new_username\n- new_password\n- Authorization header with current JWT\n\nProcess:\n1. Verify JWT token\n2. Check user is anonymous (is_anonymous=true)\n3. Validate new username is available\n4. Hash new password\n5. Update user record:\n   - username = new_username\n   - password_hash = hash(new_password)\n   - is_anonymous = false\n6. Return new JWT token with updated claims\n\nError cases:\n- User already claimed (is_anonymous=false)\n- Username taken\n- Invalid token","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T16:51:56.967833-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.821762-08:00","closed_at":"2026-02-05T17:13:06.977341-08:00","close_reason":"Implemented POST /api/auth/claim endpoint with full test coverage","dependencies":[{"issue_id":"g-bjo.1","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T16:51:56.970293-08:00","created_by":"miguel"}]}
{"id":"g-bp5","title":"Design error handling and recovery strategy","description":"No error handling strategy is specified for various failure modes.\n\n## Failure Scenarios\n\n### 1. Web Worker Crash\n- Stockfish WASM worker dies mid-game\n- **Detection**: Worker stops responding, timeout on postMessage\n- **Recovery**: \n  - Attempt worker restart\n  - Show 'Engine restarting...' message\n  - Resume game if possible\n  - If repeated failures, offer to save game state and retry later\n\n### 2. Network Disconnection\n- API calls fail mid-game\n- **Detection**: fetch() rejects, navigator.onLine\n- **Recovery**:\n  - Queue failed requests (blunder submissions)\n  - Show offline indicator\n  - Retry with exponential backoff\n  - Sync queued blunders when back online\n\n### 3. Database Unavailable\n- Postgres down or slow\n- **Detection**: API returns 503, timeouts\n- **Recovery**:\n  - API returns cached data where possible\n  - Ghost mode degrades to engine-only mode\n  - Blunder submissions queued for retry\n  - Health check endpoint for monitoring\n\n### 4. Invalid Game State\n- FEN becomes corrupted, impossible position\n- **Detection**: chess.js validation fails\n- **Recovery**:\n  - Log error with full context\n  - Offer to restart game\n  - Don't record blunders from corrupted state\n\n## Implementation Requirements\n\n1. **Frontend**\n   - Global error boundary (React)\n   - Toast/notification system for user feedback\n   - Offline detection and indicator\n   - Request retry logic with queue\n\n2. **Backend**\n   - Consistent error response format: { error: string, code: string, details?: any }\n   - Request logging for debugging\n   - Health check endpoint\n   - Graceful degradation patterns\n\n3. **Monitoring**\n   - Error tracking (Sentry or similar)\n   - API latency metrics\n   - Worker crash rate tracking","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:31.747809-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.053141-08:00","closed_at":"2026-02-01T17:37:08.67725-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-c41","title":"Bootstrap React+Vite workspace","description":"Create a new Vite + React (TypeScript) project that will host the Ghost Replay client. Keep the template lean (remove demo counter), set package metadata, and check in npm lockfiles so the rest of the milestone can install dependencies quickly. Document npm install/run steps in README so follow-on work knows how to boot the UI.","acceptance_criteria":"- Running `npm install` followed by `npm run dev` serves the starter page without runtime errors\n- README lists prerequisites plus dev/build commands\n- Default page renders Ghost Replay placeholder copy so we know the right app is running","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T23:41:05.250167-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.040474-08:00","closed_at":"2026-02-01T23:52:35.706382-08:00","close_reason":"Closed","labels":["milestone-1"],"dependencies":[{"issue_id":"g-c41","depends_on_id":"g-9fy","type":"parent-child","created_at":"2026-02-01T23:43:32.031433-08:00","created_by":"miguel"}]}
{"id":"g-cfy","title":"Play against Stockfish","description":"Implement the first playable loop where the local board hands moves to a Stockfish worker and applies the replies.","status":"closed","priority":2,"issue_type":"epic","owner":"unroar@gmail.com","created_at":"2026-02-02T00:12:58.662199-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.037979-08:00","closed_at":"2026-02-02T01:09:54.294758-08:00","close_reason":"Closed"}
{"id":"g-cfy.1","title":"Set up Stockfish worker runtime","description":"Add stockfish.js WASM to the client build, configure a dedicated Web Worker, and prove it accepts go commands and returns best moves via postMessage.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T00:13:05.692987-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.96212-08:00","closed_at":"2026-02-02T01:13:52.962577-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-cfy.1","depends_on_id":"g-cfy","type":"parent-child","created_at":"2026-02-02T00:13:05.69476-08:00","created_by":"miguel"}]}
{"id":"g-cfy.2","title":"Connect ChessGame to the worker","description":"After each player move, send the latest FEN to the worker, show thinking state, and apply the engine's reply move back onto the board with error handling.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T00:13:10.424533-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.036776-08:00","closed_at":"2026-02-02T01:13:52.967156-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-cfy.2","depends_on_id":"g-cfy","type":"parent-child","created_at":"2026-02-02T00:13:10.426069-08:00","created_by":"miguel"}]}
{"id":"g-crg","title":"Epic: Ghost Mechanics","description":"API suggests a ghost move based on history. Implement GET /ghost-move (dumb lookup: if FEN exists in blunders, return a connected blunder move; skip scent logic). Hook frontend Worker A to query API before Stockfish.","notes":"SPEC update: Ghost targeting must be color-scoped. Only consider blunders where position.active_color == session.player_color; requires session.player_color from /api/game/start.","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T01:36:58.663781-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.028399-08:00","closed_at":"2026-02-05T12:49:34.975198-08:00","close_reason":"All subtasks completed: ghost-move endpoint and frontend Worker A integration both implemented","dependencies":[{"issue_id":"g-crg","depends_on_id":"g-49g","type":"blocks","created_at":"2026-02-02T01:37:39.959888-08:00","created_by":"miguel"},{"issue_id":"g-crg","depends_on_id":"g-a32","type":"blocks","created_at":"2026-02-02T01:37:52.568778-08:00","created_by":"miguel"}]}
{"id":"g-csy","title":"[IMPL] Define deployment architecture","description":"**Category: Implementation Task (Post-Spec)**\n\nDefer until implementation begins.\n\n## MVP Recommendation\n- Frontend: Vercel (free tier)\n- Backend: Railway or Fly.io\n- Database: Neon or Supabase (managed Postgres)\n\n## Later Considerations\n- CI/CD pipeline (GitHub Actions)\n- Environment management\n- Secrets handling","status":"open","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:16.398251-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.109369-08:00"}
{"id":"g-d1x","title":"DB: Add player_color to game_sessions table","description":"Add game_sessions.player_color (white|black) with constraint. Backfill existing rows to 'white' for compatibility.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T20:33:16.235084-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.912165-08:00","closed_at":"2026-02-02T22:22:10.240108-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-d1x","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:35:06.234976-08:00","created_by":"miguel"},{"issue_id":"g-d1x","depends_on_id":"g-om9","type":"blocks","created_at":"2026-02-02T20:35:11.764016-08:00","created_by":"miguel"}]}
{"id":"g-d2d","title":"[SPEC] Define after-game analysis display","description":"## Overview\nAfter a game ends, users should be able to review the game with engine evaluations displayed for each position.\n\n## Key Points\n- **No extra computation needed**: Frontend already runs Worker B (Analyst) during the game at max strength\n- Analysis data is captured in real-time as the game progresses\n- After-game view displays this pre-computed analysis\n\n## Data to Display\n- Engine evaluation (centipawns) for each position\n- Visual eval bar/graph showing advantage over time\n- Highlight blunders, mistakes, inaccuracies (color-coded)\n- Best move suggestions at key moments\n\n## Questions to Answer\n- How is per-move analysis data stored? (In game_sessions or separate table?)\n- What evaluation thresholds for mistake/inaccuracy classification?\n- Should analysis be stored server-side or kept in browser memory until game end?\n\n## Dependencies\n- Requires game session PGN storage (ghostreplay-ujl adds this)","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T19:23:46.852134-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.042946-08:00","closed_at":"2026-02-01T22:05:18.079612-08:00","close_reason":"Added Section 10 to SPEC.md defining analysis screen layout, components (chessboard, eval graph, eval bar, navigation, move list, position panel), data source, API endpoint, and entry points (post-game + game history)","dependencies":[{"issue_id":"g-d2d","depends_on_id":"g-ujl","type":"blocks","created_at":"2026-02-01T19:24:16.058306-08:00","created_by":"miguel"}]}
{"id":"g-d3b","title":"Define FEN normalization strategy","description":"The schema uses `fen_hash = SHA256(Normalized FEN)` but doesn't define what normalization means.\n\n## Problem\nA standard FEN has 6 fields:\n`rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1`\n\n1. Piece placement\n2. Active color\n3. Castling availability\n4. En passant target square\n5. Halfmove clock (moves since pawn move/capture)\n6. Fullmove number\n\nFields 5 and 6 change every move but don't affect the position for blunder purposes.\n\n## Options\n\n### Option A: Strip fields 5 and 6\nNormalize to: `position color castling en_passant`\n- Pros: Same position = same hash\n- Cons: Loses move timing info\n\n### Option B: Keep all fields\n- Pros: Exact position match\n- Cons: Same position reached via different move order = different hash\n\n### Option C: Strip only field 6 (fullmove number)\n- Keep halfmove clock (relevant for 50-move rule)\n- Pros: Balanced approach\n- Cons: Still some duplication possible\n\n## Recommendation\nOption A for MVP. Chess positions are defined by pieces + castling rights + en passant. The move counters are metadata.\n\n## Implementation\n- Create a `normalize_fen()` utility function\n- Document the normalization clearly\n- Use consistently in both frontend and backend","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:07.921074-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.055511-08:00","closed_at":"2026-02-01T17:37:08.665226-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-d44p","title":"Add /stats route and empty StatsPage shell","description":"Create src/pages/StatsPage.tsx with an empty shell component and add a /stats route in App.tsx. This page will host the Elo-over-time graph (g-2qx) and other future user stats widgets.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-07T15:01:00.243756-08:00","created_by":"miguel","updated_at":"2026-02-07T15:02:58.924587-08:00","closed_at":"2026-02-07T15:02:58.924587-08:00","close_reason":"Added StatsPage shell and /stats route"}
{"id":"g-d86","title":"Update positions inserts to set active_color","description":"Find/create the positions insert path (likely in blunder/game ingestion) and populate active_color from fen_raw before insert. Ensure active_color is persisted for new rows.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T22:35:53.815083-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.906851-08:00"}
{"id":"g-dbq","title":"Frontend: Build evaluation graph component","description":"Line chart: X=move number, Y=eval (clamped ±5 pawns). Color-coded dots for blunders (red), mistakes (orange), inaccuracies (yellow). Click to jump to move. Vertical indicator for current move.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:08.158163-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.00715-08:00","dependencies":[{"issue_id":"g-dbq","depends_on_id":"g-vp6","type":"blocks","created_at":"2026-02-02T14:02:24.282093-08:00","created_by":"miguel"},{"issue_id":"g-dbq","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:24.844364-08:00","created_by":"miguel"}]}
{"id":"g-dgw","title":"Frontend: Fix game over popup obscuring board","description":"The game over popup and New Game button obscure the board, preventing the user from seeing the final move. Need to redesign the game over UI to show the result without blocking the board view.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-02T20:09:48.768439-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.995422-08:00","closed_at":"2026-02-02T20:12:27.700955-08:00","close_reason":"Replaced blocking modal with inline banner below the board"}
{"id":"g-dp2","title":"Add tests for opening detection and UI display","description":"Extend tests for opening lookup and ChessGame UI integration. Cover: (1) opening name from a known line, (2) transposition yields same opening, (3) unknown opening yields null/Unknown, (4) UI renders opening only during active game. Use lightweight fixtures to avoid loading the full dataset in test runs (mock loader if needed).","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-05T13:30:27.799656-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.060409-08:00","closed_at":"2026-02-06T17:34:42.423164-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-dp2","depends_on_id":"g-dyw","type":"blocks","created_at":"2026-02-05T13:30:43.003088-08:00","created_by":"miguel"}]}
{"id":"g-dyw","title":"Show opening name in live game UI","description":"Integrate opening lookup into ChessGame and display the opening name while a game is active. Use live position only (ignore viewIndex/history). Reset on new game/reset and hide when no active game. UI placement: chess status panel (e.g., under Opponent or Session). Acceptance: Opening line updates as moves are played and remains stable across transpositions; shows 'Unknown' or blank when no match.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-05T13:30:20.973124-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.987615-08:00","closed_at":"2026-02-05T18:13:35.649617-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-dyw","depends_on_id":"g-yfh","type":"blocks","created_at":"2026-02-05T13:30:39.801835-08:00","created_by":"miguel"}]}
{"id":"g-e62","title":"Store blunder context (wrong move, best move, eval delta)","description":"Currently the schema only marks `is_blunder=TRUE` on positions but doesn't store the context needed to explain the mistake to the user.\n\n## Problem\nWhen reviewing a blunder, we need to show:\n- 'You played Qxd4' (the mistake)\n- 'Nf3 was better' (the correction)\n- 'This lost 3.5 pawns of advantage' (the severity)\n\n## Schema Changes\n\n```sql\nCREATE TABLE blunders (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    position_id BIGINT REFERENCES positions(id),\n    \n    -- The mistake\n    user_move_san VARCHAR(10) NOT NULL,    -- e.g., 'Qxd4'\n    user_move_eval INTEGER,                 -- centipawns after user move\n    \n    -- The correction\n    best_move_san VARCHAR(10) NOT NULL,    -- e.g., 'Nf3'\n    best_move_eval INTEGER,                 -- centipawns after best move\n    \n    -- Derived\n    eval_delta INTEGER,                     -- best - user (positive = blunder)\n    \n    -- SRS (move from positions table)\n    srs_due_date TIMESTAMP,\n    srs_interval INTEGER DEFAULT 0,\n    srs_ease_factor FLOAT DEFAULT 2.5,\n    \n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n## Benefits\n- SRS data is now per-user (same position, different users)\n- Can show detailed feedback during review\n- Can track severity trends over time","status":"closed","priority":1,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:25.647445-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.973241-08:00","closed_at":"2026-02-01T17:37:08.645081-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"g-e62","depends_on_id":"g-ou7","type":"blocks","created_at":"2026-02-01T17:35:19.590381-08:00","created_by":"miguel"}]}
{"id":"g-e9x","title":"Epic: SRS review system (pass/fail updates)","notes":"Core feature: When user reaches blunder position, evaluate move. Update pass_streak, priority, record review history.\nSPEC update: SRS review logic must respect session.player_color; blunder positions are only eligible when side-to-move matches user's color.","status":"open","priority":1,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:16.506406-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.945299-08:00","dependencies":[{"issue_id":"g-e9x","depends_on_id":"g-bjo","type":"blocks","created_at":"2026-02-02T14:01:08.327554-08:00","created_by":"miguel"},{"issue_id":"g-e9x","depends_on_id":"g-pk5","type":"blocks","created_at":"2026-02-02T14:01:08.578925-08:00","created_by":"miguel"},{"issue_id":"g-e9x","depends_on_id":"g-hhh","type":"blocks","created_at":"2026-02-02T14:01:18.09929-08:00","created_by":"miguel"},{"issue_id":"g-e9x","depends_on_id":"g-g5w","type":"blocks","created_at":"2026-02-02T14:01:18.335755-08:00","created_by":"miguel"}]}
{"id":"g-e9x.1","title":"Frontend: Blunder review view with SRS status and detailed metadata","description":"Create a dedicated user view to review recorded blunders and SRS state. The view should optimize triage (what is due now), transparency (why a card is due), and deep position study from the same screen.","acceptance_criteria":"Blunder list is sorted in reverse chronological order using last_practiced_at, falling back to created_at when never practiced; SRS status panel shows counts for Due today, Overdue, Learning, Young, Mature, and Leeches, plus daily workload estimate and streak; Card-level metadata shows last reviewed, next due date, interval, ease factor, lapse count, success rate, and a short explanation of why the card is scheduled now; Detail panel integrates shared analysis chessboard to study each blunder in context","notes":"Use existing analysis board issue ghostreplay-zrs for board implementation and integration. This feature is UI orchestration plus SRS/status/metadata presentation.","status":"open","priority":1,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-05T16:51:34.590365-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.891807-08:00","dependencies":[{"issue_id":"g-e9x.1","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-05T16:51:34.592681-08:00","created_by":"miguel"},{"issue_id":"g-e9x.1","depends_on_id":"g-zrs","type":"blocks","created_at":"2026-02-05T16:51:39.492835-08:00","created_by":"miguel"},{"issue_id":"g-e9x.1","depends_on_id":"g-jxj","type":"blocks","created_at":"2026-02-05T16:51:39.523388-08:00","created_by":"miguel"}]}
{"id":"g-em8","title":"Handle concurrent sessions (multi-tab play)","description":"What happens if a user opens multiple browser tabs and plays simultaneous games?\n\n## Scenarios\n\n1. **Tab A and Tab B both playing**\n   - Both legitimate games\n   - Both should track blunders independently\n   - Each has own session_id\n\n2. **Tab A playing, Tab B opens same game**\n   - User refreshes or duplicates tab\n   - Should resume same session, not create new one\n\n3. **Ghost mode conflicts**\n   - Tab A triggers ghost mode for blunder X\n   - Tab B independently reaches blunder X\n   - Both valid, no conflict\n\n## Implementation Options\n\n### Option A: Allow freely\n- Each tab = independent session\n- No special handling needed\n- Pros: Simple\n- Cons: User could 'cheat' by practicing same blunder in parallel\n\n### Option B: Single active session\n- Only one game allowed at a time\n- New tab shows 'Game in progress in another tab'\n- Pros: Cleaner UX, no cheating\n- Cons: More complex, needs websocket or polling\n\n### Option C: Session recovery\n- Store session_id in localStorage\n- New tab checks for active session\n- Option to 'resume' or 'abandon and start new'\n\n## Recommendation\nOption A for MVP (simplest). Revisit if cheating becomes a concern.\n\n## Notes\n- Document expected behavior\n- Consider adding session metadata to blunder records for debugging","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:22.007657-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.102773-08:00","closed_at":"2026-02-01T17:37:08.673089-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-eo1","title":"Backend: Implement SRS priority calculation","description":"Calculate priority = hours_since_review / (BASE_INTERVAL * BACKOFF_FACTOR^pass_streak). Constants: BASE_INTERVAL=1hr, BACKOFF_FACTOR=2.0, MAX_INTERVAL=4320hrs.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:30.62296-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.932535-08:00","dependencies":[{"issue_id":"g-eo1","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:05.417772-08:00","created_by":"miguel"}]}
{"id":"g-f3a","title":"Define game lifecycle (start, end, persistence)","description":"The spec doesn't address how games are started, ended, or whether they're persisted.\n\n## Questions to Answer\n\n### Starting a Game\n- What UI initiates a new game?\n- What options are presented?\n  - Color (White only for MVP, but UI should exist)\n  - Engine strength (Elo 800-2500)\n  - Time control (if any)\n- Does the system show 'You have N blunders due for review' before starting?\n\n### During the Game\n- Can user resign?\n- Can user offer/accept draw?\n- Can user request takeback? (probably not, defeats purpose)\n- What happens on browser close/refresh mid-game?\n\n### Ending the Game\n- How is checkmate/stalemate detected and displayed?\n- Is the completed game stored?\n- Post-game analysis screen?\n\n## Schema Consideration\n\n```sql\nCREATE TABLE games (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    started_at TIMESTAMP DEFAULT NOW(),\n    ended_at TIMESTAMP,\n    result VARCHAR(10),  -- '1-0', '0-1', '1/2-1/2', 'abandoned'\n    pgn TEXT,            -- Full game record\n    engine_elo INTEGER,\n    blunders_encountered INTEGER DEFAULT 0,\n    blunders_passed INTEGER DEFAULT 0\n);\n```\n\n## Benefits of Storing Games\n- Can replay past games\n- Can see 'you faced this blunder in game X'\n- Analytics on performance vs engine level","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:50.771116-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.972113-08:00","closed_at":"2026-02-01T17:37:08.657342-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-f4a","title":"Frontend: Build account claim UI","description":"Form with username/password fields. Call /api/auth/register. Show validation errors. Redirect to dashboard on success.","notes":"UI for users to upgrade from anonymous to claimed account.\n\nForm fields:\n- New username (with validation/availability check)\n- New password\n- Confirm password\n\nOn submit:\n- Call /api/auth/claim endpoint\n- Update localStorage with new credentials\n- Show success message\n\nAccessible from user menu/settings.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:37.375496-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.851054-08:00","closed_at":"2026-02-05T17:35:27.323509-08:00","close_reason":"Implemented together: shared AuthForm component with register/login modes, React Router, nav bar, claimAccount backend wiring","dependencies":[{"issue_id":"g-f4a","depends_on_id":"g-7kb","type":"blocks","created_at":"2026-02-02T14:01:30.817703-08:00","created_by":"miguel"},{"issue_id":"g-f4a","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:22.743942-08:00","created_by":"miguel"}]}
{"id":"g-g5w","title":"Epic: Ghost steers user to recorded blunders","notes":"Core feature: Ghost mode queries downstream blunders, plays moves to steer user back. Switches to engine when no path found.\nSPEC update: Ghost search (CTE + priority) must filter blunders by session.player_color using positions.active_color. Do not mix White/Black blunders.","status":"open","priority":1,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:14.990987-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.946775-08:00","dependencies":[{"issue_id":"g-g5w","depends_on_id":"g-bjo","type":"blocks","created_at":"2026-02-02T14:01:07.831045-08:00","created_by":"miguel"},{"issue_id":"g-g5w","depends_on_id":"g-pk5","type":"blocks","created_at":"2026-02-02T14:01:08.078123-08:00","created_by":"miguel"},{"issue_id":"g-g5w","depends_on_id":"g-hhh","type":"blocks","created_at":"2026-02-02T14:01:17.851297-08:00","created_by":"miguel"}]}
{"id":"g-gbh","title":"Frontend: Query ghost-move after each user move","description":"After user plays move, call GET /api/game/ghost-move with current FEN. Store response (mode, move, target_blunder_id) in game state.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:31.405346-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.928182-08:00","closed_at":"2026-02-03T17:25:17.839355-08:00","close_reason":"Frontend implementation complete: added getGhostMove API and integrated query after user moves. Works with existing endpoint; backend enhancements in ghostreplay-26v are additive.","dependencies":[{"issue_id":"g-gbh","depends_on_id":"g-26v","type":"blocks","created_at":"2026-02-02T14:02:02.043306-08:00","created_by":"miguel"},{"issue_id":"g-gbh","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:06.169791-08:00","created_by":"miguel"},{"issue_id":"g-gbh","depends_on_id":"g-49g","type":"blocks","created_at":"2026-02-03T03:08:32.156763-08:00","created_by":"miguel"}]}
{"id":"g-gg2","title":"Frontend game flow assumes user is White (move input + engine move order)","description":"ChessGame only lets user move when chess.turn()==\"w\" and always calls applyEngineMove after a user drop. This hard-codes user=White; playing Black would require engine to move first and allowing user drops on Black turns. Locations: src/components/ChessGame.tsx:205-233, src/components/ChessGame.tsx:355-356.","status":"closed","priority":1,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-02T20:41:32.30145-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.907754-08:00","closed_at":"2026-02-03T01:06:24.117446-08:00","close_reason":"Fixed stale playerColor bug in handleNewGame - removed duplicate setBoardOrientation call that overwrote the correct resolvedPlayerColor with the stale playerColor state","dependencies":[{"issue_id":"g-gg2","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:42:18.605077-08:00","created_by":"miguel"},{"issue_id":"g-gg2","depends_on_id":"g-hhh.2","type":"blocks","created_at":"2026-02-02T20:42:32.447293-08:00","created_by":"miguel"},{"issue_id":"g-gg2","depends_on_id":"g-hhh.3","type":"blocks","created_at":"2026-02-02T20:42:35.242324-08:00","created_by":"miguel"}]}
{"id":"g-gm8","title":"Define acceptable move criteria for SRS pass/fail","description":"Section 2.3 mentions 'engine's top move (or a specific safe alternative)' but doesn't define what counts as acceptable.\n\n## Problem\nIf the engine's top 3 moves are all within 10cp of each other, should playing any of them count as 'passing' the review?\n\n## Options to Consider\n\n1. **Exact Match Only**\n   - Only the single best move counts as correct\n   - Pros: Simple, deterministic\n   - Cons: May be too strict; alternative winning moves rejected\n\n2. **Evaluation Threshold**\n   - Any move within N centipawns of best is acceptable\n   - e.g., if best=+150cp, accept moves \u003e= +130cp (20cp tolerance)\n   - Pros: More forgiving, recognizes alternative good moves\n   - Cons: Need to define threshold\n\n3. **Top N Moves**\n   - Accept any of engine's top 3 moves\n   - Pros: Simple to implement\n   - Cons: 3rd best might be significantly worse\n\n4. **Hybrid**\n   - Accept top N moves that are within X centipawns of best\n   - Most flexible but most complex\n\n## Decision Needed\n- Which approach for MVP?\n- Should this be configurable per user?\n- Different thresholds for different skill levels?\n\n## Implementation\n- Document the chosen algorithm in code comments\n- Make threshold a config constant for easy tuning","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:32.759354-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.057543-08:00","closed_at":"2026-02-01T17:37:08.648846-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-gms","title":"Add time control options for games","description":"The spec doesn't mention time controls for games.\n\n## Questions\n\n### Is Time Control Needed for MVP?\nArguments for:\n- More realistic game experience\n- Prevents endless thinking\n- Adds pressure (blunders more likely under time)\n\nArguments against:\n- Adds complexity\n- Training app, not competitive\n- Users might want unlimited time to think\n\n### Options\n\n1. **No time control (MVP)**\n   - Unlimited thinking time\n   - Simplest implementation\n   - Focus on learning, not speed\n\n2. **Optional time control**\n   - User chooses: None, 5+0, 10+0, 15+10, etc.\n   - Engine also plays on clock\n   - Clock UI component needed\n\n3. **Per-move time limit**\n   - Not a full clock, but max time per move\n   - e.g., 60 seconds per move\n   - Simpler than full clock\n\n## Implementation (if adding)\n\n### Frontend\n- Clock component (two clocks, user + engine)\n- Time selector in game setup\n- Visual/audio warning when low on time\n- Game ends on timeout\n\n### Backend\n- Store time control in game session\n- Track time used per move\n- Validate move timestamps\n\n### Engine Consideration\n- Stockfish needs time management\n- `go wtime X btime Y` command\n- Different from unlimited `go depth 20`\n\n## Recommendation\n**No time control for MVP**. Add as enhancement later if users request it.\n\n## Future Enhancement\n- Track 'thinking time' per move even without clock\n- Analytics: 'You blunder more when thinking \u003e 30 seconds'","status":"closed","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:16.192734-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.100963-08:00","closed_at":"2026-02-01T17:37:08.692643-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-gus","title":"Frontend: Integration tests for blunder detection flow","description":"Test Worker B analysis → delta calculation → /api/blunder call. Verify threshold (≥150cp). Test first-only rule.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:37.713458-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.083559-08:00","closed_at":"2026-02-05T17:00:01.68765-08:00","close_reason":"Added 77 new frontend tests covering blunder detection flow, mate score conversion, analysis worker utils, useMoveAnalysis hook, API utils, and ChessGame blunder recording integration","dependencies":[{"issue_id":"g-gus","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:22:22.648885-08:00","created_by":"miguel"}]}
{"id":"g-hae","title":"Provision PostgreSQL integration","description":"Add Postgres connection setup (driver, settings, session/engine factory). Wire into FastAPI lifespan or dependency injection.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:29:08.519278-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.033623-08:00","closed_at":"2026-02-02T01:54:07.214565-08:00","close_reason":"Closed"}
{"id":"g-hhh","title":"Epic: Detect and record first blunder per game","notes":"Core feature: Worker B analyzes moves, detects blunders (≥150cp loss), stores full path in graph. First blunder only per session.\nSPEC update: blunder capture must support user as White or Black per session (player_color). Only record blunders on user's turn; store positions.active_color.","status":"closed","priority":1,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:13.536666-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.948361-08:00","closed_at":"2026-02-05T17:55:36.434464-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-hhh","depends_on_id":"g-bjo","type":"blocks","created_at":"2026-02-02T14:01:07.342968-08:00","created_by":"miguel"},{"issue_id":"g-hhh","depends_on_id":"g-pk5","type":"blocks","created_at":"2026-02-02T14:01:07.592056-08:00","created_by":"miguel"}]}
{"id":"g-hhh.1","title":"DB: Add active_color to positions table","description":"Add positions.active_color (white|black) column + index. Backfill from fen_raw active color; set NOT NULL. Update inserts to populate active_color.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T20:33:12.373988-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.9138-08:00","closed_at":"2026-02-02T22:36:02.855821-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-hhh.1","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:34:55.835491-08:00","created_by":"miguel"},{"issue_id":"g-hhh.1","depends_on_id":"g-pqh","type":"blocks","created_at":"2026-02-02T20:35:08.642249-08:00","created_by":"miguel"}]}
{"id":"g-hhh.2","title":"Backend: Update /api/game/start to accept player_color","description":"Accept player_color (white|black), persist to game_sessions. Default to 'white' if omitted for backward compatibility.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T20:33:24.58627-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.910642-08:00","closed_at":"2026-02-02T22:41:29.462638-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-hhh.2","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:35:00.703572-08:00","created_by":"miguel"},{"issue_id":"g-hhh.2","depends_on_id":"g-d1x","type":"blocks","created_at":"2026-02-02T20:35:14.296198-08:00","created_by":"miguel"}]}
{"id":"g-hhh.3","title":"Frontend: Add player color selection + pass to /api/game/start","description":"Allow user to choose White/Black before starting game; pass player_color to start endpoint; set board orientation and user-side move handling accordingly.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T20:33:28.161759-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.909163-08:00","closed_at":"2026-02-02T23:56:21.832649-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-hhh.3","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:35:03.246268-08:00","created_by":"miguel"},{"issue_id":"g-hhh.3","depends_on_id":"g-hhh.2","type":"blocks","created_at":"2026-02-02T20:35:17.470982-08:00","created_by":"miguel"}]}
{"id":"g-i37","title":"Backend: POST /api/auth/register endpoint (anonymous accounts)","description":"Validate username (3-32 chars, alphanumeric+underscore), password (min 8 chars). Hash password, insert user, return JWT. Handle duplicate username (409).","notes":"Accept registration with auto-generated credentials from frontend.\n\nRequest:\n- username (auto-generated by frontend)\n- password (auto-generated by frontend)\n\nCreates anonymous user (is_anonymous=true) and returns JWT token.\n\nFrontend will call this automatically on first visit with random credentials.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:36.629412-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.858204-08:00","closed_at":"2026-02-02T19:32:07.89165-08:00","close_reason":"Implemented POST /api/auth/register endpoint with validation, password hashing, JWT token generation, and 409 for duplicates","dependencies":[{"issue_id":"g-i37","depends_on_id":"g-m8t","type":"blocks","created_at":"2026-02-02T14:01:29.345364-08:00","created_by":"miguel"},{"issue_id":"g-i37","depends_on_id":"g-0vl","type":"blocks","created_at":"2026-02-02T14:01:29.582398-08:00","created_by":"miguel"},{"issue_id":"g-i37","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:22.082821-08:00","created_by":"miguel"}]}
{"id":"g-i4f","title":"Address graph scalability and pruning strategy","description":"The position graph could grow very large. Common opening positions (e4, d4, Nf3) will be traversed constantly.\n\n## Scale Concerns\n\n### Position Growth\n- Every unique position = new row\n- Opening positions shared across all users (if not per-user)\n- Endgame positions less likely to repeat\n\n### Query Performance\n- Recursive CTE for path finding\n- Worse as graph grows\n- Need indexes on fen_hash, is_blunder, srs_due_date\n\n## Architecture Questions\n\n### Per-User vs Shared Positions?\n\n**Option A: Shared positions table**\n```sql\n-- positions table is global\n-- blunders table is per-user, references positions\n```\n- Pros: Deduplication, smaller DB\n- Cons: Queries need user filter\n\n**Option B: Per-user positions**\n```sql\n-- Each user has their own position nodes\n-- No sharing between users\n```\n- Pros: Simpler queries, user isolation\n- Cons: Massive duplication of common positions\n\n**Recommendation**: Shared positions, per-user blunders\n\n### Pruning Strategies\n\n1. **Orphan cleanup**\n   - Positions with no blunders and no edges = delete\n   - Run as scheduled job\n\n2. **Old position archival**\n   - Positions not accessed in 1 year -\u003e cold storage\n   - Unlikely for active blunders\n\n3. **Graph compaction**\n   - Merge linear chains of positions (no branches)\n   - Complex, maybe not worth it\n\n## Index Strategy\n```sql\nCREATE INDEX idx_positions_fen_hash ON positions(fen_hash);\nCREATE INDEX idx_blunders_user_due ON blunders(user_id, srs_due_date) WHERE srs_due_date IS NOT NULL;\nCREATE INDEX idx_moves_from ON moves(from_position_id);\n```\n\n## Monitoring\n- Track table sizes over time\n- Monitor query latency for path-finding\n- Alert if growth exceeds projections","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:42.226854-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.101865-08:00","closed_at":"2026-02-01T17:37:08.680932-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-iax","title":"Frontend: Implement game loop (user move → engine move)","description":"User plays → validate → update board → request engine move → apply → check game over. Handle turn management.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:54.233303-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.830671-08:00","closed_at":"2026-02-02T14:41:40.618362-08:00","close_reason":"Game loop fully implemented: user move validation, board updates, engine moves, game over detection, and turn management all working via chess.js and Stockfish Worker A. Session tracking (ghostreplay-2wb) not needed for basic game loop.","dependencies":[{"issue_id":"g-iax","depends_on_id":"g-mvc","type":"blocks","created_at":"2026-02-02T14:01:40.713169-08:00","created_by":"miguel"},{"issue_id":"g-iax","depends_on_id":"g-zwz","type":"blocks","created_at":"2026-02-02T14:01:40.950684-08:00","created_by":"miguel"},{"issue_id":"g-iax","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:33.260893-08:00","created_by":"miguel"}]}
{"id":"g-inn","title":"[IMPL] Add time control options","description":"**Category: Implementation Task - Future Enhancement**\n\nNot needed for MVP. Training app, unlimited thinking time is fine.\n\n## If Added Later\n- Clock component UI\n- Time presets (5+0, 10+0, etc.)\n- Engine time management\n- Timeout handling","status":"open","priority":4,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:26.548716-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.107314-08:00"}
{"id":"g-j0k","title":"[SPEC] Add user model and authentication design","description":"**Category: SPEC.md Update Required**\n\nAdd a new section to SPEC.md defining user identity.\n\n## Decisions Needed\n\n1. **Authentication method**: JWT tokens vs session cookies?\n2. **User schema fields**: What data do we store? (email, username, preferences)\n3. **Password requirements**: Minimum complexity?\n4. **OAuth support**: Lichess/Chess.com integration for MVP or later?\n\n## Proposed SPEC.md Addition\n\n### Section 5.3: `users` Table\n```sql\nCREATE TABLE users (\n    id BIGSERIAL PRIMARY KEY,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n### Schema Impact\n- Add `user_id` to positions or create separate user-scoped blunders table\n- Define whether positions are shared globally or per-user\n\n## Questions for Product Owner\n- Is email/password sufficient for MVP?\n- Should we support anonymous play (no account)?\n- Rate limiting requirements?","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:21.955657-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.873359-08:00","closed_at":"2026-02-01T17:54:56.46722-08:00","close_reason":"Added sections 5.3-5.5 to SPEC.md: users table, JWT auth, user-scoped data"}
{"id":"g-jbn","title":"Frontend: Build move list component","description":"Two-column format (white|black). Annotations (??/?/?!/!/!!). Background colors by classification. Clicking move navigates to position. Auto-scroll to current move.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:08.412818-08:00","created_by":"miguel","updated_at":"2026-02-07T18:24:23.017995-08:00","closed_at":"2026-02-07T18:24:23.017995-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-jbn","depends_on_id":"g-vp6","type":"blocks","created_at":"2026-02-02T14:02:24.521647-08:00","created_by":"miguel"},{"issue_id":"g-jbn","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:25.095272-08:00","created_by":"miguel"}]}
{"id":"g-jp0","title":"Frontend: Implement background move analysis","description":"After each user move, Worker B analyzes position. Get eval_before (best move) and eval_after (user move). Queue results for batch upload.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:14.952051-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.936023-08:00","closed_at":"2026-02-03T00:27:28.500635-08:00","close_reason":"Already implemented in useMoveAnalysis.ts and analysisWorker.ts","dependencies":[{"issue_id":"g-jp0","depends_on_id":"g-pus","type":"blocks","created_at":"2026-02-02T14:01:52.332961-08:00","created_by":"miguel"},{"issue_id":"g-jp0","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:51.907294-08:00","created_by":"miguel"}]}
{"id":"g-jwn","title":"Backend: Unit tests for FEN normalization","description":"Test move clock stripping, EP canonicalization. Verify same position via different move orders has same hash. Test edge cases.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:36.456491-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.089641-08:00","closed_at":"2026-02-03T02:49:32.45488-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-jwn","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:22:21.947473-08:00","created_by":"miguel"}]}
{"id":"g-jxj","title":"Backend: GET /api/blunders endpoint - list with due filter","description":"Return user's blunders with calculated priority. Support ?due=true filter (priority \u003e 1.0). Include fen, moves, eval_loss, pass_streak, last_reviewed_at.","notes":"SPEC update: include positions.active_color (or filter by player_color when requested) in blunders list so UI can scope by side.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:48.268195-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.915516-08:00","dependencies":[{"issue_id":"g-jxj","depends_on_id":"g-766","type":"blocks","created_at":"2026-02-02T14:02:14.116248-08:00","created_by":"miguel"},{"issue_id":"g-jxj","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:16.176547-08:00","created_by":"miguel"}]}
{"id":"g-k58","title":"Add engine skill level selection UI","description":"The spec mentions Elo 800-2500 range but no UI for selection.\n\n## Requirements\n\n### Skill Level Mapping\nStockfish uses 'Skill Level' 0-20, not Elo directly.\n\nApproximate mapping:\n| Skill Level | Approximate Elo |\n|-------------|-----------------|\n| 0           | 800             |\n| 5           | 1200            |\n| 10          | 1600            |\n| 15          | 2000            |\n| 20          | 2500+           |\n\n### UI Design\n\n**Option A: Elo Slider**\n```\nEngine Strength: [====|=====] 1400\n```\n- User-friendly, familiar concept\n- Map internally to Skill Level\n\n**Option B: Named Levels**\n```\n[ ] Beginner (800)\n[ ] Casual (1200)\n[x] Intermediate (1600)\n[ ] Advanced (2000)\n[ ] Expert (2500)\n```\n- Clearer for non-chess players\n- Less granularity\n\n**Option C: Both**\n- Presets + custom slider\n- Most flexible\n\n### Persistence\n- Store user's preferred level\n- Use as default for new games\n- Allow override per game\n\n### Implementation\n\n**Frontend:**\n```typescript\ninterface GameSettings {\n  engineElo: number;  // 800-2500\n}\n\nfunction eloToSkillLevel(elo: number): number {\n  // Linear interpolation\n  return Math.round((elo - 800) / 85);\n}\n```\n\n**Stockfish Configuration:**\n```\nsetoption name Skill Level value 10\nsetoption name UCI_LimitStrength value true\nsetoption name UCI_Elo value 1600\n```\n\nNote: UCI_Elo is more accurate if supported by the WASM build.\n\n### Considerations\n- Should blunders against weak engine count the same as against strong?\n- Maybe store engine Elo with blunder for context\n- Adaptive difficulty? (auto-adjust based on win rate)","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:27.195571-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.050056-08:00","closed_at":"2026-02-01T17:37:08.696753-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-k9g","title":"[IMPL] Handle multi-tab concurrent sessions","description":"**Category: Implementation Task - Future Enhancement**\n\nLow priority for MVP. Allow multiple tabs freely.\n\n## If Issues Arise\n- Single active session enforcement\n- Session recovery from localStorage\n- WebSocket for cross-tab communication","status":"open","priority":4,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:28.114364-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.106503-08:00"}
{"id":"g-kj5","title":"Backend: Integration tests for recursive CTE ghost query","description":"Test depth bounds, cycle detection, correct move selection. Verify performance \u003c 100ms for 10k position graphs.","notes":"SPEC update: include test coverage for color-scoped ghost query (player_color filter + positions.active_color).","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:36.954926-08:00","created_by":"miguel","updated_at":"2026-02-07T00:29:46.017992-08:00","closed_at":"2026-02-07T00:29:46.017992-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-kj5","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:22:22.886323-08:00","created_by":"miguel"}]}
{"id":"g-kt9","title":"Frontend: Detect when user reaches blunder position","description":"When ghost-move response includes target_blunder_id, mark position as 'under review'. Wait for user's next move to evaluate pass/fail.","notes":"SPEC update: detect blunder positions only when side-to-move matches session.player_color; avoid triggering on opponent turns.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:47.260895-08:00","created_by":"miguel","updated_at":"2026-02-07T04:13:43.773251-08:00","closed_at":"2026-02-07T04:13:43.773251-08:00","close_reason":"Propagated target_blunder_id from ghost-move API through useOpponentMove hook to ChessGame. Added blunderReviewId state that's set when ghost response targets a blunder and side-to-move matches playerColor. Reset on new game.","dependencies":[{"issue_id":"g-kt9","depends_on_id":"g-gbh","type":"blocks","created_at":"2026-02-02T14:02:12.894068-08:00","created_by":"miguel"},{"issue_id":"g-kt9","depends_on_id":"g-e9x","type":"parent-child","created_at":"2026-02-02T14:06:15.212436-08:00","created_by":"miguel"}]}
{"id":"g-kzb","title":"Frontend: Detect checkmate/stalemate and end game","description":"Use chess.js isCheckmate()/isStalemate(). Call /api/game/end with appropriate result. Show end game modal.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:54.718189-08:00","created_by":"miguel","updated_at":"2026-02-07T00:30:53.007952-08:00","closed_at":"2026-02-07T00:30:53.007952-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-kzb","depends_on_id":"g-iax","type":"blocks","created_at":"2026-02-02T14:01:41.651503-08:00","created_by":"miguel"},{"issue_id":"g-kzb","depends_on_id":"g-q8t","type":"blocks","created_at":"2026-02-02T14:01:41.890131-08:00","created_by":"miguel"},{"issue_id":"g-kzb","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:33.722339-08:00","created_by":"miguel"}]}
{"id":"g-lc6","title":"Add session/game tracking for first-blunder-only rule","description":"The spec says 'only the first blunder of any single game session is recorded' but there's no mechanism to track sessions.\n\n## Problem\nWithout session tracking, we can't enforce the first-blunder-only rule.\n\n## Requirements\n\n1. **Session Definition**\n   - A session = one game from start to finish\n   - Starts when user clicks 'New Game'\n   - Ends on checkmate, resignation, draw, or abandonment\n\n2. **Tracking Mechanism**\n   - Generate session_id when game starts\n   - Frontend includes session_id in POST /blunder requests\n   - Backend checks: 'Has this session already recorded a blunder?'\n   - If yes, reject/ignore new blunder submission\n\n3. **Schema**\n```sql\nCREATE TABLE game_sessions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id BIGINT REFERENCES users(id),\n    started_at TIMESTAMP DEFAULT NOW(),\n    ended_at TIMESTAMP,\n    blunder_recorded BOOLEAN DEFAULT FALSE\n);\n```\n\n4. **API Changes**\n   - POST /api/game/start returns session_id\n   - POST /api/blunder requires session_id\n   - Backend validates session_id and checks blunder_recorded flag\n\n## Edge Cases\n- Browser refresh mid-game: session_id in localStorage?\n- Multiple tabs: each tab = different session\n- Abandoned games: cleanup job to mark old sessions as ended?","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:14.84774-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.054101-08:00","closed_at":"2026-02-01T17:37:08.669036-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"g-lc6","depends_on_id":"g-f3a","type":"blocks","created_at":"2026-02-01T17:35:19.780974-08:00","created_by":"miguel"}]}
{"id":"g-lib-toast","title":"UI: Toast feedback for Ghost Move Library add action","description":"Add non-inline toast/snackbar feedback for manual MoveList adds to Ghost Move Library: success, duplicate (already in library), and error.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T23:59:22.9443-08:00","created_by":"miguel","updated_at":"2026-02-07T14:37:29.93663-08:00"}
{"id":"g-lk8","title":"Frontend: Build empty state for history","description":"On the unified History+Analysis page, when no games exist, show empty state ('No games played yet'), chess icon, and 'Start New Game' action. Analysis pane should not show stale/placeholder game analysis in this state.","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:19.435209-08:00","created_by":"miguel","updated_at":"2026-02-07T04:31:24.653466-08:00","dependencies":[{"issue_id":"g-lk8","depends_on_id":"g-05i","type":"blocks","created_at":"2026-02-02T14:02:34.67567-08:00","created_by":"miguel"},{"issue_id":"g-lk8","depends_on_id":"g-817","type":"parent-child","created_at":"2026-02-02T14:06:33.966412-08:00","created_by":"miguel"}]}
{"id":"g-lr0","title":"DB: Create moves table migration","description":"Migration for moves (edges): from_position_id, to_position_id, move_san. Primary key on (from_position_id, move_san).","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:13.70218-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.942544-08:00","closed_at":"2026-02-02T23:08:29.476469-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-lr0","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:50.679586-08:00","created_by":"miguel"}]}
{"id":"g-m8t","title":"Backend: Implement password hashing utilities","description":"Use bcrypt for password hashing. Create hash_password() and verify_password() functions.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:36.12866-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.863265-08:00","closed_at":"2026-02-02T18:33:33.220256-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-m8t","depends_on_id":"g-8c1","type":"blocks","created_at":"2026-02-02T14:01:28.861988-08:00","created_by":"miguel"},{"issue_id":"g-m8t","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:05:21.655251-08:00","created_by":"miguel"}]}
{"id":"g-mvc","title":"Frontend: Build chess board component","description":"Integrate react-chessboard. Handle piece drag/drop. Validate moves with chess.js. Show legal move highlights.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:53.967384-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.833184-08:00","closed_at":"2026-02-02T14:29:51.652294-08:00","close_reason":"Already implemented in initial scaffolding","dependencies":[{"issue_id":"g-mvc","depends_on_id":"g-uia","type":"blocks","created_at":"2026-02-02T14:01:40.247841-08:00","created_by":"miguel"},{"issue_id":"g-mvc","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:33.029017-08:00","created_by":"miguel"}]}
{"id":"g-n9j","title":"[SPEC] Clarify transposition detection and ghost re-hooking","description":"**Category: SPEC.md Update Required**\n\nSection 2.1 mentions 'Re-Hooking' when user transposes into a known position, but the mechanism isn't specified.\n\n## The Scenario\n1. Move 5: User deviates from ghost path\n2. Engine mode takes over\n3. Move 12: Position happens to match a blunder path\n4. Ghost should reactivate\n\n## Questions\n\n### When to Check?\n- Every move? (more API calls)\n- Only on 'significant' moves?\n\n### What Triggers Re-Hook?\n- Any position in the graph?\n- Only positions with due blunders downstream?\n\n## Proposed SPEC.md Addition\n\n### Section 6.1.1: Re-Hooking Logic\nAfter every user move, frontend calls GET /api/game/ghost-move with current FEN.\n\nBackend logic:\n1. Look up position by normalized FEN hash\n2. If not found → return { mode: 'engine' }\n3. If found, run downstream blunder query\n4. If due blunder reachable → return { mode: 'ghost', move: ... }\n5. Otherwise → return { mode: 'engine' }\n\n### Performance Note\nThis check happens every move. Response time target: \u003c100ms.\nConsider caching position lookups.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:07.039926-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.044502-08:00","closed_at":"2026-02-01T22:00:06.865097-08:00","close_reason":"Added section 6.1.1 Re-Hooking Logic to SPEC.md clarifying transposition detection mechanism"}
{"id":"g-npr","title":"Switch player-facing chess engine to Maia-2 while keeping Stockfish for analysis","description":"Update engine routing so games against the computer use Maia-2, while analysis features continue to use Stockfish. Ensure this split is explicit in configuration and documented in code/docs where engine selection is defined.","acceptance_criteria":"1) Player-vs-engine games use Maia-2 by default. 2) Analysis endpoints/tools continue to use Stockfish. 3) Add or update tests to verify engine selection for gameplay vs analysis paths. 4) Document engine-role split in relevant docs/config comments.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-05T13:47:02.16832-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.986491-08:00","closed_at":"2026-02-06T13:17:27.498855-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-npr","depends_on_id":"g-29c.1","type":"blocks","created_at":"2026-02-06T11:31:16.883504-08:00","created_by":"miguel"}],"comments":[{"id":1,"issue_id":"g-npr","author":"miguel","text":"Closed in favor of ghostreplay-29c.2, which is the canonical implementation epic for backend unified opponent-move routing (ghost + Maia). Dependencies were rewired so downstream work now depends on ghostreplay-29c.2 directly.","created_at":"2026-02-06T21:17:32Z"}]}
{"id":"g-nzk","title":"Choose frontend state management solution","description":"The spec says 'React + Vite' but doesn't specify state management.\n\n## State to Manage\n\n### Game State\n- Current FEN position\n- Move history\n- Game mode (ghost vs engine)\n- Clock times (if implemented)\n- Whose turn\n\n### UI State\n- Selected square\n- Legal moves highlighting\n- Promotion dialog\n- Analysis panel open/closed\n\n### User State\n- Auth token\n- User profile\n- Preferences (engine level, board theme)\n\n### Server State\n- Blunder list\n- Stats data\n- Due reviews count\n\n## Options\n\n### 1. React Context + useReducer\n- Built-in, no dependencies\n- Good for simple apps\n- Pros: No extra bundle size, familiar\n- Cons: Can get messy at scale, no devtools\n\n### 2. Zustand\n- Minimal, hooks-based\n- ~1KB bundle\n- Pros: Simple API, good devtools, no boilerplate\n- Cons: Less structure than Redux\n\n### 3. Redux Toolkit\n- Full-featured, battle-tested\n- ~10KB bundle\n- Pros: Great devtools, middleware, time-travel debugging\n- Cons: More boilerplate, overkill for MVP?\n\n### 4. Jotai / Recoil\n- Atomic state model\n- Good for granular updates\n- Pros: Fine-grained reactivity\n- Cons: Different mental model, smaller community\n\n### 5. TanStack Query (React Query)\n- Server state management\n- Not for local state\n- Pros: Caching, refetching, loading states\n- Cons: Only for async data\n\n## Recommendation\n\n**Zustand for local/game state + TanStack Query for server state**\n\n```typescript\n// Game store (Zustand)\nconst useGameStore = create((set) =\u003e ({\n  fen: STARTING_FEN,\n  mode: 'engine',\n  makeMove: (move) =\u003e set((state) =\u003e ({ fen: applyMove(state.fen, move) })),\n}));\n\n// Server data (TanStack Query)\nconst { data: stats } = useQuery({\n  queryKey: ['stats'],\n  queryFn: fetchStats,\n});\n```\n\n## Implementation\n- Create /src/stores/ directory\n- Separate stores by domain: gameStore, uiStore, authStore\n- Use TanStack Query for all API calls\n- Document state shape and actions","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:34:38.254065-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.048859-08:00","closed_at":"2026-02-01T17:37:08.700304-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-o5b","title":"[SPEC] Define blunder context storage schema","description":"**Category: SPEC.md Update Required**\n\nThe current schema marks positions as blunders but doesn't store what the mistake was.\n\n## Problem\nTo show 'You played Qxd4, but Nf3 was better' we need:\n- The user's move\n- The engine's best move  \n- The evaluation difference\n\n## Proposed SPEC.md Addition\n\n### Section 5.3: `blunders` Table\n```sql\nCREATE TABLE blunders (\n    id BIGSERIAL PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    position_id BIGINT REFERENCES positions(id),\n    user_move_san VARCHAR(10) NOT NULL,\n    best_move_san VARCHAR(10) NOT NULL,\n    eval_delta INTEGER NOT NULL,  -- centipawns lost\n    -- SRS fields (moved from positions)\n    srs_due_date TIMESTAMP,\n    srs_interval INTEGER DEFAULT 0,\n    srs_ease_factor FLOAT DEFAULT 2.5,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n```\n\n## Design Decision\nThis separates the graph structure (positions/moves) from user-specific blunder tracking. Same position can be a blunder for multiple users with different SRS schedules.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:28.002039-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.969926-08:00","closed_at":"2026-02-01T18:48:04.735117-08:00","close_reason":"Updated SPEC.md with blunder context storage: added blunder_move_san for display, clarified that pass/fail uses real-time eval (not stored moves), any blunder at position = fail","dependencies":[{"issue_id":"g-o5b","depends_on_id":"g-j0k","type":"blocks","created_at":"2026-02-01T17:40:52.351827-08:00","created_by":"miguel"}]}
{"id":"g-om9","title":"DB: Create game_sessions table migration","description":"Migration for game_sessions: id (uuid), user_id, started_at, ended_at, status, result, engine_elo, blunder_recorded, pgn. Add indexes.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:52.689465-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.846312-08:00","closed_at":"2026-02-02T16:18:03.82298-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-om9","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:31.869858-08:00","created_by":"miguel"}]}
{"id":"g-ou7","title":"Add user model and authentication","description":"The spec describes a 'personal Chess Graph' but lacks any user identity layer.\n\n## Required Components\n\n1. **Database Schema**\n   - Add `users` table with id, email, password_hash, created_at\n   - Add `user_id` foreign key to `positions` table\n   - Add `user_id` foreign key to any session/game tracking tables\n\n2. **Authentication Flow**\n   - Registration (email + password)\n   - Login with JWT or session tokens\n   - Password reset flow\n   - Optional: OAuth (Google, Lichess, Chess.com)\n\n3. **API Changes**\n   - All endpoints must be authenticated\n   - User context must be passed to all graph queries\n   - Rate limiting per user\n\n4. **Frontend**\n   - Login/Register pages\n   - Auth state management\n   - Protected routes\n\n## Security Considerations\n- Password hashing (bcrypt/argon2)\n- HTTPS only\n- Token expiration and refresh\n- CSRF protection","status":"closed","priority":0,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:25.16987-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.875517-08:00","closed_at":"2026-02-01T17:37:08.639304-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-p1j","title":"Frontend start-game API request lacks player_color","description":"startGame request body only sends engine_elo and response typing has no player_color, so UI cannot record which side user chose. Locations: src/utils/api.ts:21-60, src/components/ChessGame.tsx:238-248.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-02T20:41:51.858991-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.993244-08:00","closed_at":"2026-02-03T02:25:49.391787-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-p1j","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T20:42:23.383569-08:00","created_by":"miguel"},{"issue_id":"g-p1j","depends_on_id":"g-hhh.2","type":"blocks","created_at":"2026-02-02T20:42:43.780127-08:00","created_by":"miguel"}]}
{"id":"g-pk5","title":"Epic: Play basic game against Stockfish","notes":"Foundation: Complete game loop with board UI, move validation, and engine opponent. No blunders/ghost yet.","status":"closed","priority":0,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:11.637465-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.868085-08:00","closed_at":"2026-02-02T19:16:58.702717-08:00","close_reason":"Closed"}
{"id":"g-pq2","title":"Add user progress and statistics dashboard","description":"Users need visibility into their training progress. Currently no stats view is specified.\n\n## Required Metrics\n\n### Blunder Queue\n- Total blunders tracked\n- Due for review today\n- Overdue items\n- Upcoming (next 7 days)\n\n### Performance\n- Pass rate (% of reviews where user played correct move)\n- Average interval (mastery indicator)\n- Blunders 'graduated' (interval \u003e 30 days)\n- Blunders 'lapsed' (reset to 0 recently)\n\n### Trends\n- Blunders added per week\n- Pass rate over time\n- Most common blunder types (tactical themes if we tag them)\n\n## UI Components\n\n1. **Dashboard Page**\n   - Summary cards (due today, pass rate, streak)\n   - Chart: reviews over time\n   - Chart: pass rate trend\n\n2. **Blunder List View**\n   - Sortable/filterable table\n   - Click to see position + moves\n   - Manual 'practice now' button\n\n3. **Individual Blunder Detail**\n   - Board showing position\n   - Your move vs best move\n   - Review history (dates, pass/fail)\n\n## API Endpoints\n- GET /api/stats/summary\n- GET /api/stats/trends?range=30d\n- GET /api/blunders?status=due\u0026limit=50","status":"closed","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:41.988668-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.056494-08:00","closed_at":"2026-02-01T17:37:08.652821-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"g-pq2","depends_on_id":"g-ou7","type":"blocks","created_at":"2026-02-01T17:35:19.402711-08:00","created_by":"miguel"}]}
{"id":"g-pqh","title":"DB: Create positions table migration","description":"Migration for positions: id, user_id, fen_hash (SHA256 of normalized FEN), fen_raw, created_at. Unique constraint on (user_id, fen_hash). Add indexes.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:13.466414-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.943881-08:00","closed_at":"2026-02-02T14:29:51.695407-08:00","close_reason":"Already implemented in initial scaffolding","dependencies":[{"issue_id":"g-pqh","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:50.44056-08:00","created_by":"miguel"}]}
{"id":"g-ps7","title":"Frontend: send blunder payload","description":"Wire frontend to send PGN/FEN/move payload to POST /blunder endpoint.","notes":"SPEC update: include/ensure session_id + player_color context when sending blunder payload; only send when it's user's turn.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T01:34:56.78-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.02953-08:00","closed_at":"2026-02-05T12:25:04.282104-08:00","close_reason":"Already fully implemented across src/utils/api.ts, src/utils/blunder.ts, and src/components/ChessGame.tsx","dependencies":[{"issue_id":"g-ps7","depends_on_id":"g-2tl","type":"blocks","created_at":"2026-02-02T01:35:09.193345-08:00","created_by":"miguel"}]}
{"id":"g-pus","title":"Frontend: Initialize Stockfish Worker B (analyst)","description":"Load second Stockfish instance in Web Worker. Set to max strength (Skill 20). Configure depth 18, movetime 2000ms, MultiPV 1.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:14.707254-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.937281-08:00","closed_at":"2026-02-02T14:29:51.782407-08:00","close_reason":"Already implemented in initial scaffolding","dependencies":[{"issue_id":"g-pus","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:05:51.64522-08:00","created_by":"miguel"}]}
{"id":"g-q8t","title":"Backend: POST /api/game/end endpoint","description":"Update session status to ended, set result and ended_at. Accept result enum (checkmate_win/loss/resign/draw/abandon).","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:53.20643-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.840932-08:00","closed_at":"2026-02-02T17:13:44.90076-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-q8t","depends_on_id":"g-om9","type":"blocks","created_at":"2026-02-02T14:01:40.016673-08:00","created_by":"miguel"},{"issue_id":"g-q8t","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:32.321546-08:00","created_by":"miguel"}]}
{"id":"g-qbc","title":"Backend: Setup pytest framework and fixtures","description":"Configure pytest, create test database fixtures, auth helpers. Setup test user creation utilities.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:35.941775-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.092089-08:00","closed_at":"2026-02-03T03:36:35.04907-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-qbc","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-02T14:22:21.494386-08:00","created_by":"miguel"}]}
{"id":"g-qhml","title":"analysys for what-if","description":"When in what-if mode in the anlysys board calculate evals","status":"open","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-07T21:37:05.382808-08:00","created_by":"miguel","updated_at":"2026-02-07T21:37:05.382808-08:00"}
{"id":"g-r3p","title":"DevOps: Create database migration runner","description":"Script to run all migrations in order. Handle rollbacks. Add to backend startup.","status":"open","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:50.152955-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.074679-08:00","dependencies":[{"issue_id":"g-r3p","depends_on_id":"g-3lc","type":"parent-child","created_at":"2026-02-02T14:07:00.875914-08:00","created_by":"miguel"}]}
{"id":"g-random-default-color","title":"Make random the default color choice when starting a new game","status":"closed","priority":2,"issue_type":"task","assignee":"miguel","owner":"unroar@gmail.com","created_at":"2026-02-07T00:16:53.689534-08:00","created_by":"miguel","updated_at":"2026-02-07T00:22:56.656485-08:00","closed_at":"2026-02-07T00:22:56.656485-08:00","close_reason":"Closed"}
{"id":"g-reshow-blunder-on-click","title":"Re-show blunder alert with arrows when clicking blunder in MoveList","description":"When a user clicks on a move flagged as a blunder in the MoveList component, re-display the blunder alert toast and draw the blunder arrows on the board (showing the player's move vs the best move). This lets users revisit blunder feedback without replaying the entire game.","status":"open","priority":2,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-07T18:07:03.312509-08:00","created_by":"miguel","updated_at":"2026-02-07T18:07:03.312509-08:00"}
{"id":"g-sq8","title":"[IMPL] Design error handling and recovery strategy","description":"**Category: Implementation Task (Post-Spec)**\n\n## Scope (Current)\nImplement a practical, minimal error strategy for current Ghost Replay flows.\n\n### In Scope\n1. Standard API error format\n2. Frontend error normalization\n3. Minimal retry policy for safe idempotent calls\n\n### Out of Scope (for this ticket)\n- Full monitoring/alerting pipeline\n- Broad automatic retries for non-idempotent writes\n- Large UX redesign of all error surfaces\n\n## Scenarios to Handle\n- Web Worker crash (Stockfish dies)\n- Network disconnection mid-game\n- Database unavailable\n- Invalid game state\n\n## Deliverables\n- Error response format standard (backend)\n- Retry/recovery logic (frontend idempotent reads only)\n- User feedback patterns (normalized messages)\n- Follow-up issue(s) for observability/advanced recovery if needed\n\n## Acceptance Criteria\n- Backend returns a consistent JSON error envelope for API failures\n- Frontend normalizes backend/network errors into typed errors\n- `getGhostMove` uses bounded retry on network/5xx failures\n- Tests cover envelope shape, normalization, and retry behavior\n","notes":"Implemented v1: global backend error envelope (with backward-compatible detail), typed frontend ApiError normalization, bounded retry for getGhostMove, and tests (backend/test_error_envelope.py + src/utils/api.test.ts updates).","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:12.523447-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.098225-08:00","closed_at":"2026-02-05T17:13:16.380448-08:00","close_reason":"Closed"}
{"id":"g-stats-page-consumer","title":"Frontend: /stats page consume /api/stats/summary","description":"## Goal\nImplement the `/stats` page UI to fetch and render account-level stats from `GET /api/stats/summary`.\n\n## Scope\n- Replace current `/stats` placeholder with data-driven UI.\n- Consume backend endpoint from `g-stats-summary-api`.\n- Handle loading, empty, and error states.\n- Keep styling consistent with existing app shell/nav patterns.\n\n## Implementation plan\n1. API client\n- Add `getStatsSummary(windowDays?: 7|30|90|365|0)` in `src/utils/api.ts`\n- Add typed response interfaces for endpoint contract.\n\n2. Stats page state + fetch\n- Update `src/pages/StatsPage.tsx` to:\n  - fetch on mount (default `windowDays=30`)\n  - support window selector (`7d`, `30d`, `90d`, `365d`, `All`)\n  - refetch when window changes\n  - render loading skeleton/text while pending\n  - render retry affordance on failure\n\n3. Initial UI sections (MVP)\n- `Games` cards:\n  - played, completed, active\n  - win/loss/draw/resign/abandon counts\n  - avg duration, avg moves\n- `Move quality` cards:\n  - player moves\n  - avg CPL\n  - mistakes per 100\n  - blunders per 100\n  - quality distribution row/list\n- `By color` section:\n  - white and black mini-cards (games, avg CPL, blunders/100)\n- `Library` section:\n  - blunders total, positions total, edges total\n  - new blunders in window\n  - avg blunder eval loss\n  - top costly blunders list (up to 5)\n- `Data completeness` note and `sessions_with_uploaded_moves_pct`\n\n4. UX details\n- Format percentages to 1 decimal\n- Format durations to `Xm Ys`/`Hh Mm`\n- Avoid chart dependency for this ticket (cards/lists only)\n\n5. Tests\n- Add/extend tests for `StatsPage`:\n  - loads + renders values\n  - handles empty/zero data\n  - handles fetch failure + retry\n  - window selector triggers refetch with expected query param\n- Add API client tests for `getStatsSummary`\n\n## Out of scope\n- Complex charting/visualization library integration\n- Derived SRS mastery stats not in endpoint contract\n\n## Acceptance criteria\n- `/stats` no longer shows placeholder; it renders endpoint data.\n- Window filter works and updates displayed metrics.\n- Loading/error/empty states are covered.\n- Frontend tests pass for stats fetch/render flow.\n- No regressions to nav/auth behavior on stats route.\n","status":"in_progress","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-07T18:58:11.038395-08:00","created_by":"miguel","updated_at":"2026-02-07T21:06:54.720339-08:00","dependencies":[{"issue_id":"g-stats-page-consumer","depends_on_id":"g-stats-summary-api","type":"blocks","created_at":"2026-02-07T18:58:14.056004-08:00","created_by":"miguel"}]}
{"id":"g-stats-summary-api","title":"Backend: GET /api/stats/summary endpoint","description":"## Goal\nAdd a dedicated stats aggregation endpoint that serves account-level metrics for `/stats` from currently captured data.\n\n## Scope\n- Implement `GET /api/stats/summary`\n- Auth-scoped to current user\n- No schema migrations in this ticket\n- Use existing persisted data only (`game_sessions`, `session_moves`, `blunders`, `positions`, `moves`)\n\n## Why\n`/api/history` helps for per-game cards, but it is ended-only and limited (`limit\u003c=100`), so it cannot provide complete all-time account stats.\n\n## Request\n`GET /api/stats/summary?window_days=30`\n\nQuery params:\n- `window_days` optional int, default `30`, allowed: `7|30|90|365|0`\n- `0` means all-time window for session-based metrics\n\n## Response contract\n```json\n{\n  \"window_days\": 30,\n  \"generated_at\": \"2026-02-08T12:00:00Z\",\n  \"games\": {\n    \"played\": 42,\n    \"completed\": 40,\n    \"active\": 2,\n    \"record\": {\n      \"wins\": 12,\n      \"losses\": 16,\n      \"draws\": 5,\n      \"resigns\": 4,\n      \"abandons\": 3\n    },\n    \"avg_duration_seconds\": 721,\n    \"avg_moves\": 58.4\n  },\n  \"colors\": {\n    \"white\": {\n      \"games\": 24,\n      \"completed\": 23,\n      \"wins\": 8,\n      \"losses\": 9,\n      \"draws\": 3,\n      \"avg_cpl\": 34.2,\n      \"blunders_per_100_moves\": 3.8\n    },\n    \"black\": {\n      \"games\": 18,\n      \"completed\": 17,\n      \"wins\": 4,\n      \"losses\": 7,\n      \"draws\": 2,\n      \"avg_cpl\": 41.9,\n      \"blunders_per_100_moves\": 5.1\n    }\n  },\n  \"moves\": {\n    \"player_moves\": 1218,\n    \"avg_cpl\": 37.6,\n    \"mistakes_per_100_moves\": 6.7,\n    \"blunders_per_100_moves\": 4.4,\n    \"quality_distribution\": {\n      \"best\": 21.3,\n      \"excellent\": 18.1,\n      \"good\": 27.0,\n      \"inaccuracy\": 16.2,\n      \"mistake\": 10.7,\n      \"blunder\": 6.7\n    }\n  },\n  \"library\": {\n    \"blunders_total\": 116,\n    \"positions_total\": 950,\n    \"edges_total\": 1412,\n    \"new_blunders_in_window\": 9,\n    \"avg_blunder_eval_loss_cp\": 212,\n    \"top_costly_blunders\": [\n      { \"blunder_id\": 103, \"eval_loss_cp\": 512, \"bad_move_san\": \"Qxh7+\", \"best_move_san\": \"Re1\", \"created_at\": \"2026-02-03T09:12:00Z\" }\n    ]\n  },\n  \"data_completeness\": {\n    \"sessions_with_uploaded_moves_pct\": 92.5,\n    \"notes\": [\n      \"Per-move metrics use player moves only.\",\n      \"SRS review stats are excluded until review outcomes are persisted.\"\n    ]\n  }\n}\n```\n\n## Metric definitions\n- `games.played`: count of `game_sessions`\n- `games.completed`: `status='ended'`\n- `games.active`: `status='active'`\n- `record.wins/losses/draws/resigns/abandons`: from `game_sessions.result`\n- `games.avg_duration_seconds`: avg(`ended_at - started_at`) on ended sessions\n- `games.avg_moves`: avg move rows per session\n- `moves.player_moves`: count `session_moves` where `session_moves.color = game_sessions.player_color`\n- `moves.avg_cpl`: avg(`GREATEST(eval_delta,0)`) on player moves\n- `moves.mistakes_per_100_moves`: mistake count / player moves * 100\n- `moves.blunders_per_100_moves`: blunder count / player moves * 100\n- `moves.quality_distribution`: percentage split by `classification` over player moves with non-null classification\n- `library.blunders_total`: total rows in `blunders` (all-time)\n- `library.positions_total`: total rows in `positions` (all-time)\n- `library.edges_total`: total user-scoped edges in `moves` via `positions.from_position_id` (all-time)\n- `library.new_blunders_in_window`: rows in `blunders` created within window\n- `library.avg_blunder_eval_loss_cp`: avg `eval_loss_cp`\n- `library.top_costly_blunders`: top N by `eval_loss_cp DESC` (N=5)\n- `data_completeness.sessions_with_uploaded_moves_pct`: % sessions with \u003e=1 `session_moves` row\n\n## SQL approach (PostgreSQL)\nUse CTEs with shared filtered session/blunder sets and separate aggregate selects:\n- CTE `filtered_sessions` (window by `started_at` unless `window_days=0`)\n- CTE `filtered_blunders` (window by `created_at` unless `window_days=0`)\n- CTE `player_moves` joining session moves on same-side-to-move as player color\n- Aggregate blocks for:\n  - games summary\n  - average moves per game\n  - move quality + rates\n  - by-color split\n  - library counts + severity\n  - top costly blunders (json_agg)\n  - data completeness\n\n## Implementation notes\n- Return `0`/`[]` instead of `null` for empty datasets.\n- Round percentages to 1 decimal in API layer.\n- Keep library size counters all-time (not windowed) to reflect current memory size.\n- Keep `new_blunders_in_window` windowed.\n- Do not rely on `/api/history` for this endpoint.\n\n## Out of scope / follow-up\n- Ghost effectiveness metrics (requires persisted ghost-vs-engine events)\n- SRS mastery metrics from `pass_streak`/`last_reviewed_at` (requires review outcome persistence/update)\n\n## Acceptance criteria\n- New authenticated endpoint `GET /api/stats/summary` exists.\n- Supports `window_days` (`7|30|90|365|0`) with validation.\n- Response includes all sections above with stable defaults.\n- Tests cover:\n  - empty dataset\n  - mixed dataset\n  - by-color correctness\n  - zero-denominator behavior\n  - window filtering correctness\n","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-07T18:53:51.792894-08:00","created_by":"miguel","updated_at":"2026-02-07T20:08:25.187133-08:00","closed_at":"2026-02-07T20:08:25.187133-08:00","close_reason":"Implemented /api/stats/summary endpoint, added router wiring, and added passing backend tests for empty/mixed/window/validation cases"}
{"id":"g-szo","title":"Delay starting a game","description":"A multiple second delay occurs when starting a game. When playing as black this shows up as a long delay before white makes it's first move. When playing as white it shows up as the inability to make the first move on the chessboard.  Suspicion: it might be related to loading the chess openings database.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-06T13:37:16.073189-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.977504-08:00","closed_at":"2026-02-06T14:33:34.49457-08:00","close_reason":"Closed"}
{"id":"g-td6","title":"DB: Create session_moves table migration","description":"Migration for session_moves: id, session_id, move_number, color, move_san, fen_after, eval_cp, eval_mate, best_move_san, best_move_eval_cp, eval_delta, classification. Unique (session_id, move_number, color).","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:06.898842-08:00","created_by":"miguel","updated_at":"2026-02-07T01:12:02.132968-08:00","closed_at":"2026-02-07T01:12:02.132968-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-td6","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:23.550507-08:00","created_by":"miguel"}]}
{"id":"g-u14","title":"Frontend: Handle ghost re-hooking (transposition)","description":"When mode switches from engine → ghost, show notification 'Ghost reactivated: steering to past mistake'. Update UI mode indicator.","status":"open","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:53:31.911027-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.925716-08:00","dependencies":[{"issue_id":"g-u14","depends_on_id":"g-0v6","type":"blocks","created_at":"2026-02-02T14:02:02.528087-08:00","created_by":"miguel"},{"issue_id":"g-u14","depends_on_id":"g-g5w","type":"parent-child","created_at":"2026-02-02T14:06:06.664667-08:00","created_by":"miguel"}]}
{"id":"g-u1b","title":"Design complete API endpoint specification","description":"Only POST /blunder is mentioned in the spec. A complete API is needed.\n\n## Required Endpoints\n\n### Authentication\n- POST /api/auth/register\n- POST /api/auth/login\n- POST /api/auth/logout\n- POST /api/auth/refresh\n- POST /api/auth/forgot-password\n- POST /api/auth/reset-password\n\n### Game Flow\n- POST /api/game/start - Initialize new game, returns game_id\n- GET /api/game/:id/ghost-move - Get next ghost move for position\n  - Input: { fen: string }\n  - Output: { mode: 'ghost'|'engine', move?: string, blunder_id?: number }\n- POST /api/game/:id/end - Record game completion\n\n### Blunder Management\n- POST /api/blunder - Record new blunder (existing)\n  - Input: { fen, user_move, best_move, eval_delta, game_id }\n- GET /api/blunders - List user's blunders\n  - Query params: status, due_before, limit, offset\n- GET /api/blunder/:id - Get blunder details\n\n### SRS\n- POST /api/srs/review - Record review result\n  - Input: { blunder_id, result: 'pass'|'fail' }\n  - Output: { next_due_date, new_interval }\n\n### Stats\n- GET /api/stats/summary - Dashboard summary\n- GET /api/stats/trends - Historical data\n\n## Design Considerations\n- RESTful conventions\n- Consistent error response format\n- Pagination for list endpoints\n- OpenAPI/Swagger documentation","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:32:58.027171-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.971062-08:00","closed_at":"2026-02-01T17:37:08.661595-08:00","close_reason":"Reorganizing into spec vs implementation categories","dependencies":[{"issue_id":"g-u1b","depends_on_id":"g-ou7","type":"blocks","created_at":"2026-02-01T17:35:19.208918-08:00","created_by":"miguel"}]}
{"id":"g-uia","title":"Frontend: Install chess.js and react-chessboard","description":"Add npm packages for chess logic and board UI component.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:53.470113-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.838395-08:00","closed_at":"2026-02-02T14:29:51.566111-08:00","close_reason":"Already implemented in initial scaffolding","dependencies":[{"issue_id":"g-uia","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:32.559522-08:00","created_by":"miguel"}]}
{"id":"g-ujl","title":"[SPEC] Define game lifecycle and session tracking","description":"**Category: SPEC.md Update Required**\n\nThe spec says 'first blunder only per session' but doesn't define sessions or game lifecycle.\n\n## Questions to Answer\n\n### What is a Session?\n- One game from 'New Game' to termination\n- Needs unique identifier\n\n### Game States\n- Starting (user clicks New Game)\n- In Progress (playing)\n- Ended (checkmate, resign, draw, abandon)\n\n## Proposed SPEC.md Addition\n\n### Section 2.4: Game Sessions\n```sql\nCREATE TABLE game_sessions (\n    id UUID PRIMARY KEY,\n    user_id BIGINT REFERENCES users(id),\n    started_at TIMESTAMP DEFAULT NOW(),\n    ended_at TIMESTAMP,\n    result VARCHAR(20),  -- 'checkmate', 'resign', 'draw', 'abandon'\n    engine_elo INTEGER,\n    blunder_recorded BOOLEAN DEFAULT FALSE\n);\n```\n\n### First-Blunder Rule\nWhen POST /blunder is called:\n1. Check session's blunder_recorded flag\n2. If FALSE, record blunder and set flag TRUE\n3. If TRUE, ignore (already recorded one this game)\n\n## Also Define\n- How does resignation work?\n- Are games persisted (PGN storage) or ephemeral?\n- Browser refresh mid-game recovery?","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:37:50.743959-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.967908-08:00","closed_at":"2026-02-01T19:25:31.080232-08:00","close_reason":"Added Section 7 to SPEC.md defining game sessions, lifecycle states, session schema with PGN, move analysis storage with classification thresholds, and first-blunder rule enforcement"}
{"id":"g-ulk","title":"Frontend: Batch upload move analysis on game end","description":"When game ends, send all queued Worker B analysis results to POST /api/session/:id/moves. Include move classification based on eval_delta thresholds.","notes":"Important: Worker B must analyze ALL moves in the game (both user and engine moves) to satisfy the /api/session/:id/moves endpoint requirements. Currently only user moves are analyzed in handleDrop. Need to also call analyzeMove() in applyEngineMove() to capture engine move analysis. This ensures complete game analysis data for post-game review (see SPEC section 7.4 and 10).","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:07.660507-08:00","created_by":"miguel","updated_at":"2026-02-07T03:49:42.409453-08:00","closed_at":"2026-02-07T03:49:42.409453-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-ulk","depends_on_id":"g-z5y","type":"blocks","created_at":"2026-02-02T14:02:23.819649-08:00","created_by":"miguel"},{"issue_id":"g-ulk","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:24.327519-08:00","created_by":"miguel"}]}
{"id":"g-utg","title":"Frontend: Queue analysis results for batch upload","description":"useMoveAnalysis hook currently only stores lastAnalysis (overwrites each time). Need to accumulate all analysis results (bestEval, playedEval, delta, blunder) during the game so they can be sent via POST /api/session/{id}/move at game end.","status":"closed","priority":1,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-03T00:37:36.315322-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.905419-08:00","closed_at":"2026-02-03T00:40:43.953342-08:00","close_reason":"Duplicate of ghostreplay-ulk which covers batch upload","dependencies":[{"issue_id":"g-utg","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-03T00:37:46.306891-08:00","created_by":"miguel"}]}
{"id":"g-v0u","title":"Fix baseline frontend lint/typecheck failures","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-06T14:33:29.804359-08:00","created_by":"miguel","updated_at":"2026-02-06T18:12:31.277626-08:00","closed_at":"2026-02-06T18:12:31.277626-08:00","close_reason":"Closed"}
{"id":"g-v26","title":"Frontend: Unit tests for mate score conversion","description":"Test conversion formula (MATE_BASE - N*MATE_DECAY). Verify threshold comparisons work correctly with mate scores.","status":"closed","priority":3,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:37.467971-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.084749-08:00","closed_at":"2026-02-05T17:00:01.724451-08:00","close_reason":"Added 77 new frontend tests covering blunder detection flow, mate score conversion, analysis worker utils, useMoveAnalysis hook, API utils, and ChessGame blunder recording integration","dependencies":[{"issue_id":"g-v26","depends_on_id":"g-hhh","type":"parent-child","created_at":"2026-02-02T14:22:22.405317-08:00","created_by":"miguel"}]}
{"id":"g-vmu","title":"[IMPL] Add engine skill level selection","description":"**Category: Implementation Task (Post-Spec)**\n\n## Requirements\n- UI to select Elo 800-2500\n- Map to Stockfish Skill Level 0-20\n- Persist user preference\n- Pass to Stockfish worker\n\n## Nice to Have\n- Named presets (Beginner, Intermediate, etc.)","status":"open","priority":3,"issue_type":"feature","owner":"unroar@gmail.com","created_at":"2026-02-01T17:38:21.206938-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.096043-08:00","dependencies":[{"issue_id":"g-vmu","depends_on_id":"g-npr","type":"blocks","created_at":"2026-02-05T13:51:07.390522-08:00","created_by":"miguel"},{"issue_id":"g-vmu","depends_on_id":"g-29c.2","type":"blocks","created_at":"2026-02-06T13:17:15.97807-08:00","created_by":"miguel"}]}
{"id":"g-vp6","title":"Backend: GET /api/session/:id/analysis endpoint","description":"Return session metadata + all session_moves + summary stats (blunders count, mistakes count, avg CP loss). Join game_sessions and session_moves.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:07.409774-08:00","created_by":"miguel","updated_at":"2026-02-07T04:15:59.689886-08:00","closed_at":"2026-02-07T04:15:59.689886-08:00","close_reason":"Implemented endpoint and tests","dependencies":[{"issue_id":"g-vp6","depends_on_id":"g-td6","type":"blocks","created_at":"2026-02-02T14:02:23.584588-08:00","created_by":"miguel"},{"issue_id":"g-vp6","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:24.053901-08:00","created_by":"miguel"}]}
{"id":"g-w0h","title":"Clarify transposition detection and ghost re-hooking","description":"The spec mentions 'Re-Hooking' when a user transposes into a known blunder path, but the mechanism isn't clear.\n\n## The Scenario\n1. User deviates from ghost path at move 5\n2. Engine mode takes over\n3. At move 12, position happens to match a known blunder path\n4. Ghost should 'reactivate'\n\n## Questions\n\n### When to Check for Re-Hook?\n- After every user move? (frequent API calls)\n- Only after significant position changes?\n- Only when entering certain position types?\n\n### What Defines a 'Known Position'?\n- Any position in the graph? (too broad)\n- Only positions that are N moves from a due blunder?\n- Only positions on the direct path to a due blunder?\n\n## Proposed Implementation\n\n### Frontend Flow\n1. User makes move\n2. Frontend sends FEN to GET /api/ghost/check\n3. API response:\n   - `{ mode: 'ghost', next_move: 'Nf3', blunder_distance: 3 }`\n   - `{ mode: 'engine' }` (no blunder path found)\n4. Frontend switches mode accordingly\n\n### Backend Logic\n```python\ndef check_ghost_path(user_id: int, fen: str) -\u003e GhostCheck:\n    # Normalize FEN\n    fen_hash = hash_fen(normalize(fen))\n    \n    # Check if this position exists in graph\n    position = get_position_by_hash(fen_hash)\n    if not position:\n        return GhostCheck(mode='engine')\n    \n    # Check for downstream due blunders\n    path = find_path_to_nearest_due_blunder(position.id, user_id)\n    if not path:\n        return GhostCheck(mode='engine')\n    \n    return GhostCheck(\n        mode='ghost',\n        next_move=path[0].move_san,\n        blunder_distance=len(path)\n    )\n```\n\n### Performance Consideration\n- This check happens every move\n- Must be fast (\u003c 100ms)\n- Cache position lookups\n- Optimize recursive CTE with proper indexes","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-01T17:33:52.187308-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:21.052129-08:00","closed_at":"2026-02-01T17:37:08.684346-08:00","close_reason":"Reorganizing into spec vs implementation categories"}
{"id":"g-wcc","title":"Frontend: Add logout button for claimed users","description":"Add a logout option in the nav bar for claimed (non-anonymous) users. On click, call the existing logout() from AuthContext which clears credentials and auto-registers a new anonymous account. After logout, redirect to /.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-05T17:40:59.787839-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.985478-08:00","closed_at":"2026-02-05T17:44:38.1253-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-wcc","depends_on_id":"g-bjo","type":"parent-child","created_at":"2026-02-05T17:41:50.265165-08:00","created_by":"miguel"}]}
{"id":"g-xc3","title":"Ingest full ECO dataset for client","description":"Select and vendor a full ECO opening book suitable for frontend use (no runtime network dependency). Evaluate source (e.g., eco.json or standard eco.pgn), confirm license, and choose storage format (JSON/PGN). Ensure dataset is accessible to the Vite build, with a loader or import strategy that doesn't explode bundle size. Acceptance: dataset stored in repo with clear provenance; minimal loader API documented (e.g., getOpeningBook()).","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-05T13:30:07.837557-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.989867-08:00","closed_at":"2026-02-05T17:37:28.53078-08:00","close_reason":"Vendored full ECO dataset (CC0) under public/data/openings/eco.json with provenance docs and added cached getOpeningBook() loader + tests."}
{"id":"g-y8y","title":"eval is wrong when playing as black","description":"When playing as black the evals are wrong. My suspicion is that the negative signal is flipped. For example, in a recent game when I commited a blunder as black the eval went from -3.6 to -5.6.","status":"closed","priority":2,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-06T12:59:47.033504-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.982454-08:00","closed_at":"2026-02-06T13:47:51.389651-08:00","close_reason":"Closed"}
{"id":"g-yfh","title":"Implement transposition-aware opening lookup","description":"Build a utility that returns opening info for a given position using transposition-aware matching. Input: FEN (current live position). Output: { name, eco, variation?, source } | null. Use the full ECO dataset from ghostreplay-xc3. Implement a deterministic tie-break rule (prefer deepest line or highest ply). Provide caching to avoid recomputation each move. Acceptance: unit tests cover common openings + transpositions; returns null/Unknown when not matched.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-05T13:30:14.681059-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.988701-08:00","closed_at":"2026-02-05T17:51:46.540914-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-yfh","depends_on_id":"g-xc3","type":"blocks","created_at":"2026-02-05T13:30:36.51725-08:00","created_by":"miguel"}]}
{"id":"g-z5y","title":"Backend: POST /api/session/:id/moves endpoint","description":"Bulk insert move analysis data. Accept array of {move_number, color, move_san, fen_after, evals, classification}. Upsert for idempotency. Return moves_inserted count.","status":"closed","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:07.134422-08:00","created_by":"miguel","updated_at":"2026-02-07T01:48:46.873811-08:00","closed_at":"2026-02-07T01:48:46.873811-08:00","close_reason":"Closed","dependencies":[{"issue_id":"g-z5y","depends_on_id":"g-td6","type":"blocks","created_at":"2026-02-02T14:02:23.351376-08:00","created_by":"miguel"},{"issue_id":"g-z5y","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:23.807597-08:00","created_by":"miguel"}]}
{"id":"g-znp","title":"Frontend: Build game control UI (resign, offer draw, new game)","description":"Buttons for resign (calls /game/end), new game (calls /game/start). Show game status (check, checkmate, stalemate).","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:54.480249-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.828304-08:00","closed_at":"2026-02-02T17:34:39.702092-08:00","close_reason":"Added New game and Resign buttons with API integration. Created src/utils/api.ts for API calls, updated ChessGame.tsx with handleNewGame/handleResign handlers, added danger button CSS, and created .env.example for VITE_API_URL.","dependencies":[{"issue_id":"g-znp","depends_on_id":"g-iax","type":"blocks","created_at":"2026-02-02T14:01:41.421097-08:00","created_by":"miguel"},{"issue_id":"g-znp","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:33.495156-08:00","created_by":"miguel"}]}
{"id":"g-zrs","title":"Frontend: Build analysis board component","description":"Shared analysis chessboard for post-game analysis and blunder review flows. Must support timeline navigation to any prior position and interactive what-if exploration.","acceptance_criteria":"Loads full move timeline and initializes on target blunder move while allowing backward/forward navigation; Draws arrows for engine best move and user's played move at selected position; Allows user to play alternate lines (what-if) from any position without mutating saved game data; Shows Stockfish evaluation for each selected position in the board context","notes":"Rendered inside the unified History+Analysis page for selected-game analysis, and reused by blunder review flows.","status":"in_progress","priority":2,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:54:07.914534-08:00","created_by":"miguel","updated_at":"2026-02-07T21:00:11.451558-08:00","dependencies":[{"issue_id":"g-zrs","depends_on_id":"g-vp6","type":"blocks","created_at":"2026-02-02T14:02:24.051054-08:00","created_by":"miguel"},{"issue_id":"g-zrs","depends_on_id":"g-7gl","type":"parent-child","created_at":"2026-02-02T14:06:24.575621-08:00","created_by":"miguel"}]}
{"id":"g-zwv","title":"Graph model claimed as DAG but chess graphs have cycles","description":"## Problem\n\nThe spec explicitly calls the graph model a **Directed Acyclic Graph (DAG)**, but chess graphs naturally have cycles.\n\nIn real chess, repetition is common (threefolds, perpetual checks, transpositions that revisit positions), so cycles can appear as soon as the same normalized FEN is re-reached.\n\nWhile a standard chess game moves forward in time (making it seem acyclic), the database stores **Positions (FENs)**. In chess, it is perfectly valid to reach the same position twice (e.g., 1. Nf3 Nf6 2. Ng1 Ng8). If a user has ever practiced a \"draw by repetition\" line, the graph will contain a physical loop (Node A → Node B → Node A).\n\n## Spec Correction Needed\n\nUpdate SPEC.md to:\n1. Clarify the graph is a **directed graph with potential cycles**, not a true DAG\n2. Document that recursive queries require depth bounds and cycle detection\n3. Include the recommended query pattern below\n\n## Recommended Query Pattern (for spec)\n\nPostgreSQL 14+ has a built-in CYCLE detection feature. For older versions, use depth counter + path tracking:\n\n```sql\nWITH RECURSIVE scent_path AS (\n    -- BASE CASE: Starting moves from current position\n    SELECT \n        m.from_position_id,\n        m.to_position_id,\n        m.move_san AS root_move,\n        1 AS depth,\n        ARRAY[m.from_position_id] as path_history\n    FROM moves m\n    JOIN positions p ON p.id = m.from_position_id\n    WHERE p.fen_hash = :current_fen_hash\n\n    UNION ALL\n\n    -- RECURSIVE STEP\n    SELECT \n        child.from_position_id,\n        child.to_position_id,\n        parent.root_move,\n        parent.depth + 1,\n        parent.path_history || child.from_position_id\n    FROM moves child\n    JOIN scent_path parent ON parent.to_position_id = child.from_position_id\n    WHERE \n        parent.depth \u003c 15                                          -- Depth limit\n        AND NOT (child.to_position_id = ANY(parent.path_history))  -- Cycle detection\n)\nSELECT \n    root_move, \n    COUNT(*) as distinct_blunders,\n    MIN(depth) as closest_blunder_distance,\n    SUM(CASE WHEN p.srs_due_date \u003c= NOW() THEN 10 ELSE 1 END) as urgency_score\nFROM scent_path sp\nJOIN positions p ON p.id = sp.to_position_id\nWHERE p.is_blunder = TRUE\nGROUP BY root_move\nORDER BY urgency_score DESC, closest_blunder_distance ASC\nLIMIT 1;\n```\n\n**Key safeguards:**\n- `depth \u003c 15`: Hard cap prevents runaway recursion (blunders 20+ moves away have \"faint scent\" anyway)\n- `path_history` array + `NOT ... = ANY(...)`: Prevents infinite loops from 3-fold repetition patterns","status":"closed","priority":1,"issue_type":"bug","owner":"unroar@gmail.com","created_at":"2026-02-01T22:37:13.44046-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.965702-08:00","closed_at":"2026-02-01T22:42:22.823168-08:00","close_reason":"Updated SPEC.md: corrected DAG terminology to 'directed graph with potential cycles', added cycle detection and depth bound requirements, included reference SQL implementation with safeguards"}
{"id":"g-zwz","title":"Frontend: Initialize Stockfish Worker A (opponent)","description":"Load stockfish.js in Web Worker. Configure skill level based on engine_elo. Handle UCI communication.","status":"closed","priority":0,"issue_type":"task","owner":"unroar@gmail.com","created_at":"2026-02-02T13:52:53.720642-08:00","created_by":"miguel","updated_at":"2026-02-06T17:59:20.835816-08:00","closed_at":"2026-02-02T14:29:51.609504-08:00","close_reason":"Already implemented in initial scaffolding","dependencies":[{"issue_id":"g-zwz","depends_on_id":"g-uia","type":"blocks","created_at":"2026-02-02T14:01:40.482282-08:00","created_by":"miguel"},{"issue_id":"g-zwz","depends_on_id":"g-pk5","type":"parent-child","created_at":"2026-02-02T14:05:32.798122-08:00","created_by":"miguel"}]}
